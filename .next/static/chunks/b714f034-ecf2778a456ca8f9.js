"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{26347:function(e,t,i){let n,s,a,r;i.d(t,{Bl:function(){return B},Dt:function(){return n2},GR:function(){return aX},I4:function(){return n3},JM:function(){return sr},Jq:function(){return tn},Mz:function(){return n6},OX:function(){return sh},Oy:function(){return n9},PP:function(){return eS},Uq:function(){return F},VJ:function(){return n$},WV:function(){return ai},Wt:function(){return so},_J:function(){return nm},go:function(){return n0},jl:function(){return nc},sy:function(){return s5},u2:function(){return si},wf:function(){return n1},xp:function(){return sl},zE:function(){return nY}}),i(98394);var o,l,c,d,h,u,p,g,m,y,f,b,v,k,w,T,S,C,E,R,I,D,_,N,P,U,O,A,L,B,j,F,W,V=i(92807),M=i(32701),x=i(85424),H=i(35614),z=i(94863),q=i(3406),K=i(5279),J=i(88967),G=i(38472),$=i(86623),Q=i(48646),X=i(99080),Y=i(26088),Z=i(25575),ee=i(78521),et=i(45715),ei=i(65690),en=i(57324),es=i(39864),ea=i(76913),er=i(12531),eo=i(3999),el=i(92660),ec=i(5730),ed=i(43182),eh=i(50722),eu=i(28264),ep=i(29809),eg=i(37369),em=i(8450),ey=i(2127),ef=i(12270),eb=i(48793),ev=i(74811),ek=i(48738),ew=i(20357);let eT={DISABLED:"disabled",AUTO_ON:"auto-on"},eS={BLOCK_USERS:"block-users",CHANGE_MAX_DURATION:"change-max-duration",CREATE_CALL:"create-call",CREATE_REACTION:"create-reaction",ENABLE_NOISE_CANCELLATION:"enable-noise-cancellation",END_CALL:"end-call",JOIN_BACKSTAGE:"join-backstage",JOIN_CALL:"join-call",JOIN_ENDED_CALL:"join-ended-call",MUTE_USERS:"mute-users",PIN_FOR_EVERYONE:"pin-for-everyone",READ_CALL:"read-call",REMOVE_CALL_MEMBER:"remove-call-member",SCREENSHARE:"screenshare",SEND_AUDIO:"send-audio",SEND_VIDEO:"send-video",START_BROADCAST_CALL:"start-broadcast-call",START_RECORD_CALL:"start-record-call",START_TRANSCRIPTION_CALL:"start-transcription-call",STOP_BROADCAST_CALL:"stop-broadcast-call",STOP_RECORD_CALL:"stop-record-call",STOP_TRANSCRIPTION_CALL:"stop-transcription-call",UPDATE_CALL:"update-call",UPDATE_CALL_MEMBER:"update-call-member",UPDATE_CALL_PERMISSIONS:"update-call-permissions",UPDATE_CALL_SETTINGS:"update-call-settings"};class eC extends Error{}(o=C||(C={}))[o.NULL_VALUE=0]="NULL_VALUE";class eE extends V.C{internalJsonWrite(e,t){let i={};for(let[t,n]of Object.entries(e.fields))i[t]=eD.toJson(n);return i}internalJsonRead(e,t,i){if(!(0,M.b)(e))throw new globalThis.Error("Unable to parse message "+this.typeName+" from JSON "+(0,M.Z)(e)+".");for(let[t,n]of(i||(i=this.create()),globalThis.Object.entries(e)))i.fields[t]=eD.fromJson(n);return i}create(e){let t=globalThis.Object.create(this.messagePrototype);return t.fields={},void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)this.binaryReadMap1(s.fields,e,i);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}binaryReadMap1(e,t,i){let n=t.uint32(),s=t.pos+n,a,r;for(;t.pos<s;){let[e,n]=t.tag();switch(e){case 1:a=t.string();break;case 2:r=eD.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for field google.protobuf.Struct.fields")}}e[null!=a?a:""]=null!=r?r:eD.create()}internalBinaryWrite(e,t,i){for(let n of globalThis.Object.keys(e.fields))t.tag(1,H.TD.LengthDelimited).fork().tag(1,H.TD.LengthDelimited).string(n),t.tag(2,H.TD.LengthDelimited).fork(),eD.internalBinaryWrite(e.fields[n],t,i),t.join().join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("google.protobuf.Struct",[{no:1,name:"fields",kind:"map",K:9,V:{kind:"message",T:()=>eD}}])}}let eR=new eE;class eI extends V.C{internalJsonWrite(e,t){if(void 0===e.kind.oneofKind)throw new globalThis.Error;switch(e.kind.oneofKind){case void 0:throw new globalThis.Error;case"boolValue":return e.kind.boolValue;case"nullValue":return null;case"numberValue":let i=e.kind.numberValue;if("number"==typeof i&&!Number.isFinite(i))throw new globalThis.Error;return i;case"stringValue":return e.kind.stringValue;case"listValue":let n=this.fields.find(e=>6===e.no);if((null==n?void 0:n.kind)!=="message")throw new globalThis.Error;return n.T().toJson(e.kind.listValue);case"structValue":let s=this.fields.find(e=>5===e.no);if((null==s?void 0:s.kind)!=="message")throw new globalThis.Error;return s.T().toJson(e.kind.structValue)}}internalJsonRead(e,t,i){switch(i||(i=this.create()),typeof e){case"number":i.kind={oneofKind:"numberValue",numberValue:e};break;case"string":i.kind={oneofKind:"stringValue",stringValue:e};break;case"boolean":i.kind={oneofKind:"boolValue",boolValue:e};break;case"object":null===e?i.kind={oneofKind:"nullValue",nullValue:C.NULL_VALUE}:globalThis.Array.isArray(e)?i.kind={oneofKind:"listValue",listValue:eN.fromJson(e)}:i.kind={oneofKind:"structValue",structValue:eR.fromJson(e)};break;default:throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+(0,M.Z)(e))}return i}create(e){let t=globalThis.Object.create(this.messagePrototype);return t.kind={oneofKind:void 0},void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.kind={oneofKind:"nullValue",nullValue:e.int32()};break;case 2:s.kind={oneofKind:"numberValue",numberValue:e.double()};break;case 3:s.kind={oneofKind:"stringValue",stringValue:e.string()};break;case 4:s.kind={oneofKind:"boolValue",boolValue:e.bool()};break;case 5:s.kind={oneofKind:"structValue",structValue:eR.internalBinaryRead(e,e.uint32(),i,s.kind.structValue)};break;case 6:s.kind={oneofKind:"listValue",listValue:eN.internalBinaryRead(e,e.uint32(),i,s.kind.listValue)};break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){"nullValue"===e.kind.oneofKind&&t.tag(1,H.TD.Varint).int32(e.kind.nullValue),"numberValue"===e.kind.oneofKind&&t.tag(2,H.TD.Bit64).double(e.kind.numberValue),"stringValue"===e.kind.oneofKind&&t.tag(3,H.TD.LengthDelimited).string(e.kind.stringValue),"boolValue"===e.kind.oneofKind&&t.tag(4,H.TD.Varint).bool(e.kind.boolValue),"structValue"===e.kind.oneofKind&&eR.internalBinaryWrite(e.kind.structValue,t.tag(5,H.TD.LengthDelimited).fork(),i).join(),"listValue"===e.kind.oneofKind&&eN.internalBinaryWrite(e.kind.listValue,t.tag(6,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("google.protobuf.Value",[{no:1,name:"null_value",kind:"enum",oneof:"kind",T:()=>["google.protobuf.NullValue",C]},{no:2,name:"number_value",kind:"scalar",oneof:"kind",T:1},{no:3,name:"string_value",kind:"scalar",oneof:"kind",T:9},{no:4,name:"bool_value",kind:"scalar",oneof:"kind",T:8},{no:5,name:"struct_value",kind:"message",oneof:"kind",T:()=>eR},{no:6,name:"list_value",kind:"message",oneof:"kind",T:()=>eN}])}}let eD=new eI;class e_ extends V.C{internalJsonWrite(e,t){return e.values.map(e=>eD.toJson(e))}internalJsonRead(e,t,i){if(!globalThis.Array.isArray(e))throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+(0,M.Z)(e));i||(i=this.create());let n=e.map(e=>eD.fromJson(e));return i.values.push(...n),i}create(e){let t=globalThis.Object.create(this.messagePrototype);return t.values=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.values.push(eD.internalBinaryRead(e,e.uint32(),i));else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.values.length;n++)eD.internalBinaryWrite(e.values[n],t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("google.protobuf.ListValue",[{no:1,name:"values",kind:"message",repeat:1,T:()=>eD}])}}let eN=new e_;class eP extends V.C{now(){let e=this.create(),t=Date.now();return e.seconds=z.MJ.from(Math.floor(t/1e3)).toString(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(1e3*z.MJ.from(e.seconds).toNumber()+Math.ceil(e.nanos/1e6))}fromDate(e){let t=this.create(),i=e.getTime();return t.seconds=z.MJ.from(Math.floor(i/1e3)).toString(),t.nanos=i%1e3*1e6,t}internalJsonWrite(e,t){let i=1e3*z.MJ.from(e.seconds).toNumber();if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(e.nanos>0){let t=(e.nanos+1e9).toString().substring(1);n="000000"===t.substring(3)?"."+t.substring(0,3)+"Z":"000"===t.substring(6)?"."+t.substring(0,6)+"Z":"."+t+"Z"}return new Date(i).toISOString().replace(".000Z",n)}internalJsonRead(e,t,i){if("string"!=typeof e)throw Error("Unable to parse Timestamp from JSON "+(0,M.Z)(e)+".");let n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw Error("Unable to parse Timestamp from JSON. Invalid format.");let s=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(s))throw Error("Unable to parse Timestamp from JSON. Invalid value.");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return i||(i=this.create()),i.seconds=z.MJ.from(s/1e3).toString(),i.nanos=0,n[7]&&(i.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),i}create(e){let t=globalThis.Object.create(this.messagePrototype);return t.seconds="0",t.nanos=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.seconds=e.int64().toString();break;case 2:s.nanos=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){"0"!==e.seconds&&t.tag(1,H.TD.Varint).int64(e.seconds),0!==e.nanos&&t.tag(2,H.TD.Varint).int32(e.nanos);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}])}}let eU=new eP;(l=E||(E={}))[l.PUBLISHER_UNSPECIFIED=0]="PUBLISHER_UNSPECIFIED",l[l.SUBSCRIBER=1]="SUBSCRIBER",(c=R||(R={}))[c.UNSPECIFIED=0]="UNSPECIFIED",c[c.POOR=1]="POOR",c[c.GOOD=2]="GOOD",c[c.EXCELLENT=3]="EXCELLENT",(d=I||(I={}))[d.LOW_UNSPECIFIED=0]="LOW_UNSPECIFIED",d[d.MID=1]="MID",d[d.HIGH=2]="HIGH",d[d.OFF=3]="OFF",(h=D||(D={}))[h.UNSPECIFIED=0]="UNSPECIFIED",h[h.AUDIO=1]="AUDIO",h[h.VIDEO=2]="VIDEO",h[h.SCREEN_SHARE=3]="SCREEN_SHARE",h[h.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO",(u=_||(_={}))[u.UNSPECIFIED=0]="UNSPECIFIED",u[u.PUBLISH_TRACK_NOT_FOUND=100]="PUBLISH_TRACK_NOT_FOUND",u[u.PUBLISH_TRACKS_MISMATCH=101]="PUBLISH_TRACKS_MISMATCH",u[u.PUBLISH_TRACK_OUT_OF_ORDER=102]="PUBLISH_TRACK_OUT_OF_ORDER",u[u.PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND=103]="PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND",u[u.LIVE_ENDED=104]="LIVE_ENDED",u[u.PARTICIPANT_NOT_FOUND=200]="PARTICIPANT_NOT_FOUND",u[u.PARTICIPANT_MIGRATING_OUT=201]="PARTICIPANT_MIGRATING_OUT",u[u.PARTICIPANT_MIGRATION_FAILED=202]="PARTICIPANT_MIGRATION_FAILED",u[u.PARTICIPANT_MIGRATING=203]="PARTICIPANT_MIGRATING",u[u.PARTICIPANT_RECONNECT_FAILED=204]="PARTICIPANT_RECONNECT_FAILED",u[u.PARTICIPANT_MEDIA_TRANSPORT_FAILURE=205]="PARTICIPANT_MEDIA_TRANSPORT_FAILURE",u[u.CALL_NOT_FOUND=300]="CALL_NOT_FOUND",u[u.REQUEST_VALIDATION_FAILED=400]="REQUEST_VALIDATION_FAILED",u[u.UNAUTHENTICATED=401]="UNAUTHENTICATED",u[u.PERMISSION_DENIED=403]="PERMISSION_DENIED",u[u.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",u[u.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",u[u.SFU_SHUTTING_DOWN=600]="SFU_SHUTTING_DOWN",u[u.SFU_FULL=700]="SFU_FULL",(p=N||(N={}))[p.UNSPECIFIED=0]="UNSPECIFIED",p[p.REACT=1]="REACT",p[p.ANGULAR=2]="ANGULAR",p[p.ANDROID=3]="ANDROID",p[p.IOS=4]="IOS",p[p.FLUTTER=5]="FLUTTER",p[p.REACT_NATIVE=6]="REACT_NATIVE",p[p.UNITY=7]="UNITY",p[p.GO=8]="GO",p[p.PLAIN_JAVASCRIPT=9]="PLAIN_JAVASCRIPT",(g=P||(P={}))[g.UNSPECIFIED=0]="UNSPECIFIED",g[g.USER_MUTED=1]="USER_MUTED",g[g.PERMISSION_REVOKED=2]="PERMISSION_REVOKED",g[g.MODERATION=3]="MODERATION",(m=U||(U={}))[m.UNSPECIFIED=0]="UNSPECIFIED",m[m.SHUTTING_DOWN=1]="SHUTTING_DOWN",m[m.REBALANCE=2]="REBALANCE",(y=O||(O={}))[y.UNSPECIFIED=0]="UNSPECIFIED",y[y.ENDED=1]="ENDED",y[y.LIVE_ENDED=2]="LIVE_ENDED",y[y.KICKED=3]="KICKED",y[y.SESSION_ENDED=4]="SESSION_ENDED",(f=A||(A={}))[f.UNSPECIFIED=0]="UNSPECIFIED",f[f.DISCONNECT=1]="DISCONNECT",f[f.FAST=2]="FAST",f[f.REJOIN=3]="REJOIN",f[f.MIGRATE=4]="MIGRATE";class eO extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.participants=[],t.pins=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.participants.push(eV.internalBinaryRead(e,e.uint32(),i));break;case 2:s.startedAt=eU.internalBinaryRead(e,e.uint32(),i,s.startedAt);break;case 3:s.participantCount=eB.internalBinaryRead(e,e.uint32(),i,s.participantCount);break;case 4:s.pins.push(eF.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.participants.length;n++)eV.internalBinaryWrite(e.participants[n],t.tag(1,H.TD.LengthDelimited).fork(),i).join();e.startedAt&&eU.internalBinaryWrite(e.startedAt,t.tag(2,H.TD.LengthDelimited).fork(),i).join(),e.participantCount&&eB.internalBinaryWrite(e.participantCount,t.tag(3,H.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.pins.length;n++)eF.internalBinaryWrite(e.pins[n],t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.CallState",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>eV},{no:2,name:"started_at",kind:"message",T:()=>eU},{no:3,name:"participant_count",kind:"message",T:()=>eB},{no:4,name:"pins",kind:"message",repeat:1,T:()=>eF}])}}let eA=new eO;class eL extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.total=0,t.anonymous=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.total=e.uint32();break;case 2:s.anonymous=e.uint32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.total&&t.tag(1,H.TD.Varint).uint32(e.total),0!==e.anonymous&&t.tag(2,H.TD.Varint).uint32(e.anonymous);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.ParticipantCount",[{no:1,name:"total",kind:"scalar",T:13},{no:2,name:"anonymous",kind:"scalar",T:13}])}}let eB=new eL;class ej extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.userId="",t.sessionId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,H.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Pin",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}let eF=new ej;class eW extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.userId="",t.sessionId="",t.publishedTracks=[],t.trackLookupPrefix="",t.connectionQuality=0,t.isSpeaking=!1,t.isDominantSpeaker=!1,t.audioLevel=0,t.name="",t.image="",t.roles=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:if(n===H.TD.LengthDelimited)for(let t=e.int32()+e.pos;e.pos<t;)s.publishedTracks.push(e.int32());else s.publishedTracks.push(e.int32());break;case 4:s.joinedAt=eU.internalBinaryRead(e,e.uint32(),i,s.joinedAt);break;case 5:s.trackLookupPrefix=e.string();break;case 6:s.connectionQuality=e.int32();break;case 7:s.isSpeaking=e.bool();break;case 8:s.isDominantSpeaker=e.bool();break;case 9:s.audioLevel=e.float();break;case 10:s.name=e.string();break;case 11:s.image=e.string();break;case 12:s.custom=eR.internalBinaryRead(e,e.uint32(),i,s.custom);break;case 13:s.roles.push(e.string());break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){if(""!==e.userId&&t.tag(1,H.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId),e.publishedTracks.length){t.tag(3,H.TD.LengthDelimited).fork();for(let i=0;i<e.publishedTracks.length;i++)t.int32(e.publishedTracks[i]);t.join()}e.joinedAt&&eU.internalBinaryWrite(e.joinedAt,t.tag(4,H.TD.LengthDelimited).fork(),i).join(),""!==e.trackLookupPrefix&&t.tag(5,H.TD.LengthDelimited).string(e.trackLookupPrefix),0!==e.connectionQuality&&t.tag(6,H.TD.Varint).int32(e.connectionQuality),!1!==e.isSpeaking&&t.tag(7,H.TD.Varint).bool(e.isSpeaking),!1!==e.isDominantSpeaker&&t.tag(8,H.TD.Varint).bool(e.isDominantSpeaker),0!==e.audioLevel&&t.tag(9,H.TD.Bit32).float(e.audioLevel),""!==e.name&&t.tag(10,H.TD.LengthDelimited).string(e.name),""!==e.image&&t.tag(11,H.TD.LengthDelimited).string(e.image),e.custom&&eR.internalBinaryWrite(e.custom,t.tag(12,H.TD.LengthDelimited).fork(),i).join();for(let i=0;i<e.roles.length;i++)t.tag(13,H.TD.LengthDelimited).string(e.roles[i]);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Participant",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"published_tracks",kind:"enum",repeat:1,T:()=>["stream.video.sfu.models.TrackType",D,"TRACK_TYPE_"]},{no:4,name:"joined_at",kind:"message",T:()=>eU},{no:5,name:"track_lookup_prefix",kind:"scalar",T:9},{no:6,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",R,"CONNECTION_QUALITY_"]},{no:7,name:"is_speaking",kind:"scalar",T:8},{no:8,name:"is_dominant_speaker",kind:"scalar",T:8},{no:9,name:"audio_level",kind:"scalar",T:2},{no:10,name:"name",kind:"scalar",T:9},{no:11,name:"image",kind:"scalar",T:9},{no:12,name:"custom",kind:"message",T:()=>eR},{no:13,name:"roles",kind:"scalar",repeat:2,T:9}])}}let eV=new eW;class eM extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.videoQuality=0,t.userId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.videoQuality=e.int32();break;case 2:s.userId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.videoQuality&&t.tag(1,H.TD.Varint).int32(e.videoQuality),""!==e.userId&&t.tag(2,H.TD.LengthDelimited).string(e.userId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.StreamQuality",[{no:1,name:"video_quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",I,"VIDEO_QUALITY_"]},{no:2,name:"user_id",kind:"scalar",T:9}])}}let ex=new eM;class eH extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.width=0,t.height=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.width=e.uint32();break;case 2:s.height=e.uint32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.width&&t.tag(1,H.TD.Varint).uint32(e.width),0!==e.height&&t.tag(2,H.TD.Varint).uint32(e.height);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.VideoDimension",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13}])}}let ez=new eH;class eq extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.rid="",t.bitrate=0,t.fps=0,t.quality=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.rid=e.string();break;case 2:s.videoDimension=ez.internalBinaryRead(e,e.uint32(),i,s.videoDimension);break;case 4:s.bitrate=e.uint32();break;case 5:s.fps=e.uint32();break;case 6:s.quality=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.rid&&t.tag(1,H.TD.LengthDelimited).string(e.rid),e.videoDimension&&ez.internalBinaryWrite(e.videoDimension,t.tag(2,H.TD.LengthDelimited).fork(),i).join(),0!==e.bitrate&&t.tag(4,H.TD.Varint).uint32(e.bitrate),0!==e.fps&&t.tag(5,H.TD.Varint).uint32(e.fps),0!==e.quality&&t.tag(6,H.TD.Varint).int32(e.quality);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.VideoLayer",[{no:1,name:"rid",kind:"scalar",T:9},{no:2,name:"video_dimension",kind:"message",T:()=>ez},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"fps",kind:"scalar",T:13},{no:6,name:"quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",I,"VIDEO_QUALITY_"]}])}}let eK=new eq;class eJ extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.payloadType=0,t.name="",t.fmtpLine="",t.clockRate=0,t.encodingParameters="",t.feedbacks=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.payloadType=e.uint32();break;case 2:s.name=e.string();break;case 3:s.fmtpLine=e.string();break;case 4:s.clockRate=e.uint32();break;case 5:s.encodingParameters=e.string();break;case 6:s.feedbacks.push(e.string());break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.payloadType&&t.tag(1,H.TD.Varint).uint32(e.payloadType),""!==e.name&&t.tag(2,H.TD.LengthDelimited).string(e.name),""!==e.fmtpLine&&t.tag(3,H.TD.LengthDelimited).string(e.fmtpLine),0!==e.clockRate&&t.tag(4,H.TD.Varint).uint32(e.clockRate),""!==e.encodingParameters&&t.tag(5,H.TD.LengthDelimited).string(e.encodingParameters);for(let i=0;i<e.feedbacks.length;i++)t.tag(6,H.TD.LengthDelimited).string(e.feedbacks[i]);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Codec",[{no:1,name:"payload_type",kind:"scalar",T:13},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"fmtp_line",kind:"scalar",T:9},{no:4,name:"clock_rate",kind:"scalar",T:13},{no:5,name:"encoding_parameters",kind:"scalar",T:9},{no:6,name:"feedbacks",kind:"scalar",repeat:2,T:9}])}}let eG=new eJ,e$=new class extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.peerType=0,t.iceCandidate="",t.sessionId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.peerType=e.int32();break;case 2:s.iceCandidate=e.string();break;case 3:s.sessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.peerType&&t.tag(1,H.TD.Varint).int32(e.peerType),""!==e.iceCandidate&&t.tag(2,H.TD.LengthDelimited).string(e.iceCandidate),""!==e.sessionId&&t.tag(3,H.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",E,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}};class eQ extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.trackId="",t.trackType=0,t.layers=[],t.mid="",t.dtx=!1,t.stereo=!1,t.red=!1,t.muted=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.trackId=e.string();break;case 2:s.trackType=e.int32();break;case 5:s.layers.push(eK.internalBinaryRead(e,e.uint32(),i));break;case 6:s.mid=e.string();break;case 7:s.dtx=e.bool();break;case 8:s.stereo=e.bool();break;case 9:s.red=e.bool();break;case 10:s.muted=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.trackId&&t.tag(1,H.TD.LengthDelimited).string(e.trackId),0!==e.trackType&&t.tag(2,H.TD.Varint).int32(e.trackType);for(let n=0;n<e.layers.length;n++)eK.internalBinaryWrite(e.layers[n],t.tag(5,H.TD.LengthDelimited).fork(),i).join();""!==e.mid&&t.tag(6,H.TD.LengthDelimited).string(e.mid),!1!==e.dtx&&t.tag(7,H.TD.Varint).bool(e.dtx),!1!==e.stereo&&t.tag(8,H.TD.Varint).bool(e.stereo),!1!==e.red&&t.tag(9,H.TD.Varint).bool(e.red),!1!==e.muted&&t.tag(10,H.TD.Varint).bool(e.muted);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.TrackInfo",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",D,"TRACK_TYPE_"]},{no:5,name:"layers",kind:"message",repeat:1,T:()=>eK},{no:6,name:"mid",kind:"scalar",T:9},{no:7,name:"dtx",kind:"scalar",T:8},{no:8,name:"stereo",kind:"scalar",T:8},{no:9,name:"red",kind:"scalar",T:8},{no:10,name:"muted",kind:"scalar",T:8}])}}let eX=new eQ,eY=new class extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.code=0,t.message="",t.shouldRetry=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.code=e.int32();break;case 2:s.message=e.string();break;case 3:s.shouldRetry=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.code&&t.tag(1,H.TD.Varint).int32(e.code),""!==e.message&&t.tag(2,H.TD.LengthDelimited).string(e.message),!1!==e.shouldRetry&&t.tag(3,H.TD.Varint).bool(e.shouldRetry);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Error",[{no:1,name:"code",kind:"enum",T:()=>["stream.video.sfu.models.ErrorCode",_,"ERROR_CODE_"]},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"should_retry",kind:"scalar",T:8}])}};class eZ extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sdk=e2.internalBinaryRead(e,e.uint32(),i,s.sdk);break;case 2:s.os=e9.internalBinaryRead(e,e.uint32(),i,s.os);break;case 3:s.browser=e5.internalBinaryRead(e,e.uint32(),i,s.browser);break;case 4:s.device=e8.internalBinaryRead(e,e.uint32(),i,s.device);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.sdk&&e2.internalBinaryWrite(e.sdk,t.tag(1,H.TD.LengthDelimited).fork(),i).join(),e.os&&e9.internalBinaryWrite(e.os,t.tag(2,H.TD.LengthDelimited).fork(),i).join(),e.browser&&e5.internalBinaryWrite(e.browser,t.tag(3,H.TD.LengthDelimited).fork(),i).join(),e.device&&e8.internalBinaryWrite(e.device,t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.ClientDetails",[{no:1,name:"sdk",kind:"message",T:()=>e2},{no:2,name:"os",kind:"message",T:()=>e9},{no:3,name:"browser",kind:"message",T:()=>e5},{no:4,name:"device",kind:"message",T:()=>e8}])}}let e0=new eZ;class e1 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.type=0,t.major="",t.minor="",t.patch="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.type=e.int32();break;case 2:s.major=e.string();break;case 3:s.minor=e.string();break;case 4:s.patch=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.type&&t.tag(1,H.TD.Varint).int32(e.type),""!==e.major&&t.tag(2,H.TD.LengthDelimited).string(e.major),""!==e.minor&&t.tag(3,H.TD.LengthDelimited).string(e.minor),""!==e.patch&&t.tag(4,H.TD.LengthDelimited).string(e.patch);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Sdk",[{no:1,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.SdkType",N,"SDK_TYPE_"]},{no:2,name:"major",kind:"scalar",T:9},{no:3,name:"minor",kind:"scalar",T:9},{no:4,name:"patch",kind:"scalar",T:9}])}}let e2=new e1;class e3 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.name="",t.version="",t.architecture="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.name=e.string();break;case 2:s.version=e.string();break;case 3:s.architecture=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.name&&t.tag(1,H.TD.LengthDelimited).string(e.name),""!==e.version&&t.tag(2,H.TD.LengthDelimited).string(e.version),""!==e.architecture&&t.tag(3,H.TD.LengthDelimited).string(e.architecture);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.OS",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"architecture",kind:"scalar",T:9}])}}let e9=new e3;class e4 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.name="",t.version="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.name=e.string();break;case 2:s.version=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.name&&t.tag(1,H.TD.LengthDelimited).string(e.name),""!==e.version&&t.tag(2,H.TD.LengthDelimited).string(e.version);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Browser",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}let e5=new e4;class e6 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.name="",t.version="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.name=e.string();break;case 2:s.version=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.name&&t.tag(1,H.TD.LengthDelimited).string(e.name),""!==e.version&&t.tag(2,H.TD.LengthDelimited).string(e.version);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Device",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}let e8=new e6;class e7 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.type="",t.id="",t.createdByUserId="",t.hostUserId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.id=e.string();break;case 3:s.createdByUserId=e.string();break;case 4:s.hostUserId=e.string();break;case 5:s.custom=eR.internalBinaryRead(e,e.uint32(),i,s.custom);break;case 6:s.createdAt=eU.internalBinaryRead(e,e.uint32(),i,s.createdAt);break;case 7:s.updatedAt=eU.internalBinaryRead(e,e.uint32(),i,s.updatedAt);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.type&&t.tag(1,H.TD.LengthDelimited).string(e.type),""!==e.id&&t.tag(2,H.TD.LengthDelimited).string(e.id),""!==e.createdByUserId&&t.tag(3,H.TD.LengthDelimited).string(e.createdByUserId),""!==e.hostUserId&&t.tag(4,H.TD.LengthDelimited).string(e.hostUserId),e.custom&&eR.internalBinaryWrite(e.custom,t.tag(5,H.TD.LengthDelimited).fork(),i).join(),e.createdAt&&eU.internalBinaryWrite(e.createdAt,t.tag(6,H.TD.LengthDelimited).fork(),i).join(),e.updatedAt&&eU.internalBinaryWrite(e.updatedAt,t.tag(7,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Call",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"host_user_id",kind:"scalar",T:9},{no:5,name:"custom",kind:"message",T:()=>eR},{no:6,name:"created_at",kind:"message",T:()=>eU},{no:7,name:"updated_at",kind:"message",T:()=>eU}])}}let te=new e7;class tt extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.canPublishAudio=!1,t.canPublishVideo=!1,t.canScreenshare=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.canPublishAudio=e.bool();break;case 2:s.canPublishVideo=e.bool();break;case 3:s.canScreenshare=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){!1!==e.canPublishAudio&&t.tag(1,H.TD.Varint).bool(e.canPublishAudio),!1!==e.canPublishVideo&&t.tag(2,H.TD.Varint).bool(e.canPublishVideo),!1!==e.canScreenshare&&t.tag(3,H.TD.Varint).bool(e.canScreenshare);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.CallGrants",[{no:1,name:"can_publish_audio",kind:"scalar",T:8},{no:2,name:"can_publish_video",kind:"scalar",T:8},{no:3,name:"can_screenshare",kind:"scalar",T:8}])}}let ti=new tt;var tn=Object.freeze({__proto__:null,Browser:e5,Call:te,get CallEndedReason(){return O},CallGrants:ti,CallState:eA,ClientDetails:e0,Codec:eG,get ConnectionQuality(){return R},Device:e8,Error:eY,get ErrorCode(){return _},get GoAwayReason(){return U},ICETrickle:e$,OS:e9,Participant:eV,ParticipantCount:eB,get PeerType(){return E},Pin:eF,Sdk:e2,get SdkType(){return N},StreamQuality:ex,TrackInfo:eX,get TrackType(){return D},get TrackUnpublishReason(){return P},VideoDimension:ez,VideoLayer:eK,get VideoQuality(){return I},get WebsocketReconnectStrategy(){return A}});class ts extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sessionId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.sessionId=e.string();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(1,H.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.StartNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}let ta=new ts;class tr extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.StartNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>eY}])}}let to=new tr;class tl extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sessionId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.sessionId=e.string();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(1,H.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.StopNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}let tc=new tl;class td extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.StopNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>eY}])}}let th=new td;class tu extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sessionId="",t.subscriberStats="",t.publisherStats="",t.webrtcVersion="",t.sdk="",t.sdkVersion="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sessionId=e.string();break;case 2:s.subscriberStats=e.string();break;case 3:s.publisherStats=e.string();break;case 4:s.webrtcVersion=e.string();break;case 5:s.sdk=e.string();break;case 6:s.sdkVersion=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(1,H.TD.LengthDelimited).string(e.sessionId),""!==e.subscriberStats&&t.tag(2,H.TD.LengthDelimited).string(e.subscriberStats),""!==e.publisherStats&&t.tag(3,H.TD.LengthDelimited).string(e.publisherStats),""!==e.webrtcVersion&&t.tag(4,H.TD.LengthDelimited).string(e.webrtcVersion),""!==e.sdk&&t.tag(5,H.TD.LengthDelimited).string(e.sdk),""!==e.sdkVersion&&t.tag(6,H.TD.LengthDelimited).string(e.sdkVersion);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SendStatsRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"subscriber_stats",kind:"scalar",T:9},{no:3,name:"publisher_stats",kind:"scalar",T:9},{no:4,name:"webrtc_version",kind:"scalar",T:9},{no:5,name:"sdk",kind:"scalar",T:9},{no:6,name:"sdk_version",kind:"scalar",T:9}])}}let tp=new tu;class tg extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SendStatsResponse",[{no:1,name:"error",kind:"message",T:()=>eY}])}}let tm=new tg;class ty extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sessionId="",t.peerType=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sessionId=e.string();break;case 2:s.peerType=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(1,H.TD.LengthDelimited).string(e.sessionId),0!==e.peerType&&t.tag(2,H.TD.Varint).int32(e.peerType);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.ICERestartRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",E,"PEER_TYPE_"]}])}}let tf=new ty;class tb extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.ICERestartResponse",[{no:1,name:"error",kind:"message",T:()=>eY}])}}let tv=new tb;class tk extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sessionId="",t.muteStates=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sessionId=e.string();break;case 3:s.muteStates.push(tE.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(1,H.TD.LengthDelimited).string(e.sessionId);for(let n=0;n<e.muteStates.length;n++)tE.internalBinaryWrite(e.muteStates[n],t.tag(3,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.UpdateMuteStatesRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:3,name:"mute_states",kind:"message",repeat:1,T:()=>tE}])}}let tw=new tk;class tT extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.UpdateMuteStatesResponse",[{no:4,name:"error",kind:"message",T:()=>eY}])}}let tS=new tT;class tC extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.trackType=0,t.muted=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.trackType=e.int32();break;case 2:s.muted=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.trackType&&t.tag(1,H.TD.Varint).int32(e.trackType),!1!==e.muted&&t.tag(2,H.TD.Varint).bool(e.muted);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.TrackMuteState",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",D,"TRACK_TYPE_"]},{no:2,name:"muted",kind:"scalar",T:8}])}}let tE=new tC;class tR extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.muted=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.muted=e.bool();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){!1!==e.muted&&t.tag(1,H.TD.Varint).bool(e.muted);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.AudioMuteChanged",[{no:1,name:"muted",kind:"scalar",T:8}])}}new tR;class tI extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.muted=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(2===t)s.muted=e.bool();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){!1!==e.muted&&t.tag(2,H.TD.Varint).bool(e.muted);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.VideoMuteChanged",[{no:2,name:"muted",kind:"scalar",T:8}])}}new tI;class tD extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sessionId="",t.tracks=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 2:s.sessionId=e.string();break;case 3:s.tracks.push(tO.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId);for(let n=0;n<e.tracks.length;n++)tO.internalBinaryWrite(e.tracks[n],t.tag(3,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsRequest",[{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>tO}])}}let t_=new tD;class tN extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsResponse",[{no:4,name:"error",kind:"message",T:()=>eY}])}}let tP=new tN;class tU extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.userId="",t.sessionId="",t.trackType=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.trackType=e.int32();break;case 4:s.dimension=ez.internalBinaryRead(e,e.uint32(),i,s.dimension);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,H.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId),0!==e.trackType&&t.tag(3,H.TD.Varint).int32(e.trackType),e.dimension&&ez.internalBinaryWrite(e.dimension,t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.TrackSubscriptionDetails",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",D,"TRACK_TYPE_"]},{no:4,name:"dimension",kind:"message",T:()=>ez}])}}let tO=new tU;class tA extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.peerType=0,t.sdp="",t.sessionId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.peerType=e.int32();break;case 2:s.sdp=e.string();break;case 3:s.sessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.peerType&&t.tag(1,H.TD.Varint).int32(e.peerType),""!==e.sdp&&t.tag(2,H.TD.LengthDelimited).string(e.sdp),""!==e.sessionId&&t.tag(3,H.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SendAnswerRequest",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",E,"PEER_TYPE_"]},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}}let tL=new tA;class tB extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SendAnswerResponse",[{no:4,name:"error",kind:"message",T:()=>eY}])}}let tj=new tB;class tF extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.ICETrickleResponse",[{no:4,name:"error",kind:"message",T:()=>eY}])}}let tW=new tF;class tV extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sdp="",t.sessionId="",t.tracks=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sdp=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.tracks.push(eX.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sdp&&t.tag(1,H.TD.LengthDelimited).string(e.sdp),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId);for(let n=0;n<e.tracks.length;n++)eX.internalBinaryWrite(e.tracks[n],t.tag(3,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SetPublisherRequest",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>eX}])}}let tM=new tV;class tx extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sdp="",t.sessionId="",t.iceRestart=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sdp=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.iceRestart=e.bool();break;case 4:s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sdp&&t.tag(1,H.TD.LengthDelimited).string(e.sdp),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId),!1!==e.iceRestart&&t.tag(3,H.TD.Varint).bool(e.iceRestart),e.error&&eY.internalBinaryWrite(e.error,t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SetPublisherResponse",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"ice_restart",kind:"scalar",T:8},{no:4,name:"error",kind:"message",T:()=>eY}])}}let tH=new tx,tz=new q.U("stream.video.sfu.signal.SignalServer",[{name:"SetPublisher",options:{},I:tM,O:tH},{name:"SendAnswer",options:{},I:tL,O:tj},{name:"IceTrickle",options:{},I:e$,O:tW},{name:"UpdateSubscriptions",options:{},I:t_,O:tP},{name:"UpdateMuteStates",options:{},I:tw,O:tS},{name:"IceRestart",options:{},I:tf,O:tv},{name:"SendStats",options:{},I:tp,O:tm},{name:"StartNoiseCancellation",options:{},I:ta,O:to},{name:"StopNoiseCancellation",options:{},I:tc,O:th}]);(b=L||(L={}))[b.HIGH_UNSPECIFIED=0]="HIGH_UNSPECIFIED",b[b.LOW=1]="LOW",b[b.MEDIUM=2]="MEDIUM",b[b.VERY_LOW=3]="VERY_LOW";class tq extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.eventPayload={oneofKind:void 0},void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.eventPayload={oneofKind:"subscriberOffer",subscriberOffer:iw.internalBinaryRead(e,e.uint32(),i,s.eventPayload.subscriberOffer)};break;case 2:s.eventPayload={oneofKind:"publisherAnswer",publisherAnswer:iS.internalBinaryRead(e,e.uint32(),i,s.eventPayload.publisherAnswer)};break;case 3:s.eventPayload={oneofKind:"connectionQualityChanged",connectionQualityChanged:iE.internalBinaryRead(e,e.uint32(),i,s.eventPayload.connectionQualityChanged)};break;case 4:s.eventPayload={oneofKind:"audioLevelChanged",audioLevelChanged:iO.internalBinaryRead(e,e.uint32(),i,s.eventPayload.audioLevelChanged)};break;case 5:s.eventPayload={oneofKind:"iceTrickle",iceTrickle:e$.internalBinaryRead(e,e.uint32(),i,s.eventPayload.iceTrickle)};break;case 6:s.eventPayload={oneofKind:"changePublishQuality",changePublishQuality:iq.internalBinaryRead(e,e.uint32(),i,s.eventPayload.changePublishQuality)};break;case 10:s.eventPayload={oneofKind:"participantJoined",participantJoined:ig.internalBinaryRead(e,e.uint32(),i,s.eventPayload.participantJoined)};break;case 11:s.eventPayload={oneofKind:"participantLeft",participantLeft:iy.internalBinaryRead(e,e.uint32(),i,s.eventPayload.participantLeft)};break;case 12:s.eventPayload={oneofKind:"dominantSpeakerChanged",dominantSpeakerChanged:i_.internalBinaryRead(e,e.uint32(),i,s.eventPayload.dominantSpeakerChanged)};break;case 13:s.eventPayload={oneofKind:"joinResponse",joinResponse:iu.internalBinaryRead(e,e.uint32(),i,s.eventPayload.joinResponse)};break;case 14:s.eventPayload={oneofKind:"healthCheckResponse",healthCheckResponse:t7.internalBinaryRead(e,e.uint32(),i,s.eventPayload.healthCheckResponse)};break;case 16:s.eventPayload={oneofKind:"trackPublished",trackPublished:it.internalBinaryRead(e,e.uint32(),i,s.eventPayload.trackPublished)};break;case 17:s.eventPayload={oneofKind:"trackUnpublished",trackUnpublished:is.internalBinaryRead(e,e.uint32(),i,s.eventPayload.trackUnpublished)};break;case 18:s.eventPayload={oneofKind:"error",error:tY.internalBinaryRead(e,e.uint32(),i,s.eventPayload.error)};break;case 19:s.eventPayload={oneofKind:"callGrantsUpdated",callGrantsUpdated:iJ.internalBinaryRead(e,e.uint32(),i,s.eventPayload.callGrantsUpdated)};break;case 20:s.eventPayload={oneofKind:"goAway",goAway:i$.internalBinaryRead(e,e.uint32(),i,s.eventPayload.goAway)};break;case 21:s.eventPayload={oneofKind:"iceRestart",iceRestart:t1.internalBinaryRead(e,e.uint32(),i,s.eventPayload.iceRestart)};break;case 22:s.eventPayload={oneofKind:"pinsUpdated",pinsUpdated:tQ.internalBinaryRead(e,e.uint32(),i,s.eventPayload.pinsUpdated)};break;case 23:s.eventPayload={oneofKind:"callEnded",callEnded:iX.internalBinaryRead(e,e.uint32(),i,s.eventPayload.callEnded)};break;case 24:s.eventPayload={oneofKind:"participantUpdated",participantUpdated:iv.internalBinaryRead(e,e.uint32(),i,s.eventPayload.participantUpdated)};break;case 25:s.eventPayload={oneofKind:"participantMigrationComplete",participantMigrationComplete:tG.internalBinaryRead(e,e.uint32(),i,s.eventPayload.participantMigrationComplete)};break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){"subscriberOffer"===e.eventPayload.oneofKind&&iw.internalBinaryWrite(e.eventPayload.subscriberOffer,t.tag(1,H.TD.LengthDelimited).fork(),i).join(),"publisherAnswer"===e.eventPayload.oneofKind&&iS.internalBinaryWrite(e.eventPayload.publisherAnswer,t.tag(2,H.TD.LengthDelimited).fork(),i).join(),"connectionQualityChanged"===e.eventPayload.oneofKind&&iE.internalBinaryWrite(e.eventPayload.connectionQualityChanged,t.tag(3,H.TD.LengthDelimited).fork(),i).join(),"audioLevelChanged"===e.eventPayload.oneofKind&&iO.internalBinaryWrite(e.eventPayload.audioLevelChanged,t.tag(4,H.TD.LengthDelimited).fork(),i).join(),"iceTrickle"===e.eventPayload.oneofKind&&e$.internalBinaryWrite(e.eventPayload.iceTrickle,t.tag(5,H.TD.LengthDelimited).fork(),i).join(),"changePublishQuality"===e.eventPayload.oneofKind&&iq.internalBinaryWrite(e.eventPayload.changePublishQuality,t.tag(6,H.TD.LengthDelimited).fork(),i).join(),"participantJoined"===e.eventPayload.oneofKind&&ig.internalBinaryWrite(e.eventPayload.participantJoined,t.tag(10,H.TD.LengthDelimited).fork(),i).join(),"participantLeft"===e.eventPayload.oneofKind&&iy.internalBinaryWrite(e.eventPayload.participantLeft,t.tag(11,H.TD.LengthDelimited).fork(),i).join(),"dominantSpeakerChanged"===e.eventPayload.oneofKind&&i_.internalBinaryWrite(e.eventPayload.dominantSpeakerChanged,t.tag(12,H.TD.LengthDelimited).fork(),i).join(),"joinResponse"===e.eventPayload.oneofKind&&iu.internalBinaryWrite(e.eventPayload.joinResponse,t.tag(13,H.TD.LengthDelimited).fork(),i).join(),"healthCheckResponse"===e.eventPayload.oneofKind&&t7.internalBinaryWrite(e.eventPayload.healthCheckResponse,t.tag(14,H.TD.LengthDelimited).fork(),i).join(),"trackPublished"===e.eventPayload.oneofKind&&it.internalBinaryWrite(e.eventPayload.trackPublished,t.tag(16,H.TD.LengthDelimited).fork(),i).join(),"trackUnpublished"===e.eventPayload.oneofKind&&is.internalBinaryWrite(e.eventPayload.trackUnpublished,t.tag(17,H.TD.LengthDelimited).fork(),i).join(),"error"===e.eventPayload.oneofKind&&tY.internalBinaryWrite(e.eventPayload.error,t.tag(18,H.TD.LengthDelimited).fork(),i).join(),"callGrantsUpdated"===e.eventPayload.oneofKind&&iJ.internalBinaryWrite(e.eventPayload.callGrantsUpdated,t.tag(19,H.TD.LengthDelimited).fork(),i).join(),"goAway"===e.eventPayload.oneofKind&&i$.internalBinaryWrite(e.eventPayload.goAway,t.tag(20,H.TD.LengthDelimited).fork(),i).join(),"iceRestart"===e.eventPayload.oneofKind&&t1.internalBinaryWrite(e.eventPayload.iceRestart,t.tag(21,H.TD.LengthDelimited).fork(),i).join(),"pinsUpdated"===e.eventPayload.oneofKind&&tQ.internalBinaryWrite(e.eventPayload.pinsUpdated,t.tag(22,H.TD.LengthDelimited).fork(),i).join(),"callEnded"===e.eventPayload.oneofKind&&iX.internalBinaryWrite(e.eventPayload.callEnded,t.tag(23,H.TD.LengthDelimited).fork(),i).join(),"participantUpdated"===e.eventPayload.oneofKind&&iv.internalBinaryWrite(e.eventPayload.participantUpdated,t.tag(24,H.TD.LengthDelimited).fork(),i).join(),"participantMigrationComplete"===e.eventPayload.oneofKind&&tG.internalBinaryWrite(e.eventPayload.participantMigrationComplete,t.tag(25,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.SfuEvent",[{no:1,name:"subscriber_offer",kind:"message",oneof:"eventPayload",T:()=>iw},{no:2,name:"publisher_answer",kind:"message",oneof:"eventPayload",T:()=>iS},{no:3,name:"connection_quality_changed",kind:"message",oneof:"eventPayload",T:()=>iE},{no:4,name:"audio_level_changed",kind:"message",oneof:"eventPayload",T:()=>iO},{no:5,name:"ice_trickle",kind:"message",oneof:"eventPayload",T:()=>e$},{no:6,name:"change_publish_quality",kind:"message",oneof:"eventPayload",T:()=>iq},{no:10,name:"participant_joined",kind:"message",oneof:"eventPayload",T:()=>ig},{no:11,name:"participant_left",kind:"message",oneof:"eventPayload",T:()=>iy},{no:12,name:"dominant_speaker_changed",kind:"message",oneof:"eventPayload",T:()=>i_},{no:13,name:"join_response",kind:"message",oneof:"eventPayload",T:()=>iu},{no:14,name:"health_check_response",kind:"message",oneof:"eventPayload",T:()=>t7},{no:16,name:"track_published",kind:"message",oneof:"eventPayload",T:()=>it},{no:17,name:"track_unpublished",kind:"message",oneof:"eventPayload",T:()=>is},{no:18,name:"error",kind:"message",oneof:"eventPayload",T:()=>tY},{no:19,name:"call_grants_updated",kind:"message",oneof:"eventPayload",T:()=>iJ},{no:20,name:"go_away",kind:"message",oneof:"eventPayload",T:()=>i$},{no:21,name:"ice_restart",kind:"message",oneof:"eventPayload",T:()=>t1},{no:22,name:"pins_updated",kind:"message",oneof:"eventPayload",T:()=>tQ},{no:23,name:"call_ended",kind:"message",oneof:"eventPayload",T:()=>iX},{no:24,name:"participant_updated",kind:"message",oneof:"eventPayload",T:()=>iv},{no:25,name:"participant_migration_complete",kind:"message",oneof:"eventPayload",T:()=>tG}])}}let tK=new tq;class tJ extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){return null!=n?n:this.create()}internalBinaryWrite(e,t,i){let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ParticipantMigrationComplete",[])}}let tG=new tJ;class t$ extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.pins=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.pins.push(eF.internalBinaryRead(e,e.uint32(),i));else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.pins.length;n++)eF.internalBinaryWrite(e.pins[n],t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.PinsChanged",[{no:1,name:"pins",kind:"message",repeat:1,T:()=>eF}])}}let tQ=new t$;class tX extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.reconnectStrategy=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 4:s.error=eY.internalBinaryRead(e,e.uint32(),i,s.error);break;case 5:s.reconnectStrategy=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eY.internalBinaryWrite(e.error,t.tag(4,H.TD.LengthDelimited).fork(),i).join(),0!==e.reconnectStrategy&&t.tag(5,H.TD.Varint).int32(e.reconnectStrategy);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.Error",[{no:4,name:"error",kind:"message",T:()=>eY},{no:5,name:"reconnect_strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",A,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}let tY=new tX;class tZ extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.peerType=0,t.iceCandidate="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.peerType=e.int32();break;case 2:s.iceCandidate=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.peerType&&t.tag(1,H.TD.Varint).int32(e.peerType),""!==e.iceCandidate&&t.tag(2,H.TD.LengthDelimited).string(e.iceCandidate);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",E,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9}])}}new tZ;class t0 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.peerType=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.peerType=e.int32();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.peerType&&t.tag(1,H.TD.Varint).int32(e.peerType);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ICERestart",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",E,"PEER_TYPE_"]}])}}let t1=new t0;class t2 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.requestPayload={oneofKind:void 0},void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.requestPayload={oneofKind:"joinRequest",joinRequest:ir.internalBinaryRead(e,e.uint32(),i,s.requestPayload.joinRequest)};break;case 2:s.requestPayload={oneofKind:"healthCheckRequest",healthCheckRequest:t6.internalBinaryRead(e,e.uint32(),i,s.requestPayload.healthCheckRequest)};break;case 3:s.requestPayload={oneofKind:"leaveCallRequest",leaveCallRequest:t4.internalBinaryRead(e,e.uint32(),i,s.requestPayload.leaveCallRequest)};break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){"joinRequest"===e.requestPayload.oneofKind&&ir.internalBinaryWrite(e.requestPayload.joinRequest,t.tag(1,H.TD.LengthDelimited).fork(),i).join(),"healthCheckRequest"===e.requestPayload.oneofKind&&t6.internalBinaryWrite(e.requestPayload.healthCheckRequest,t.tag(2,H.TD.LengthDelimited).fork(),i).join(),"leaveCallRequest"===e.requestPayload.oneofKind&&t4.internalBinaryWrite(e.requestPayload.leaveCallRequest,t.tag(3,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.SfuRequest",[{no:1,name:"join_request",kind:"message",oneof:"requestPayload",T:()=>ir},{no:2,name:"health_check_request",kind:"message",oneof:"requestPayload",T:()=>t6},{no:3,name:"leave_call_request",kind:"message",oneof:"requestPayload",T:()=>t4}])}}let t3=new t2;class t9 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sessionId="",t.reason="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sessionId=e.string();break;case 2:s.reason=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(1,H.TD.LengthDelimited).string(e.sessionId),""!==e.reason&&t.tag(2,H.TD.LengthDelimited).string(e.reason);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.LeaveCallRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9}])}}let t4=new t9;class t5 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){return null!=n?n:this.create()}internalBinaryWrite(e,t,i){let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.HealthCheckRequest",[])}}let t6=new t5;class t8 extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.participantCount=eB.internalBinaryRead(e,e.uint32(),i,s.participantCount);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.participantCount&&eB.internalBinaryWrite(e.participantCount,t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.HealthCheckResponse",[{no:1,name:"participant_count",kind:"message",T:()=>eB}])}}let t7=new t8;class ie extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.userId="",t.sessionId="",t.type=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.type=e.int32();break;case 4:s.participant=eV.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,H.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId),0!==e.type&&t.tag(3,H.TD.Varint).int32(e.type),e.participant&&eV.internalBinaryWrite(e.participant,t.tag(4,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.TrackPublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",D,"TRACK_TYPE_"]},{no:4,name:"participant",kind:"message",T:()=>eV}])}}let it=new ie;class ii extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.userId="",t.sessionId="",t.type=0,t.cause=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.type=e.int32();break;case 4:s.cause=e.int32();break;case 5:s.participant=eV.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,H.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId),0!==e.type&&t.tag(3,H.TD.Varint).int32(e.type),0!==e.cause&&t.tag(4,H.TD.Varint).int32(e.cause),e.participant&&eV.internalBinaryWrite(e.participant,t.tag(5,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.TrackUnpublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",D,"TRACK_TYPE_"]},{no:4,name:"cause",kind:"enum",T:()=>["stream.video.sfu.models.TrackUnpublishReason",P,"TRACK_UNPUBLISH_REASON_"]},{no:5,name:"participant",kind:"message",T:()=>eV}])}}let is=new ii;class ia extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.token="",t.sessionId="",t.subscriberSdp="",t.fastReconnect=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.token=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.subscriberSdp=e.string();break;case 4:s.clientDetails=e0.internalBinaryRead(e,e.uint32(),i,s.clientDetails);break;case 5:s.migration=id.internalBinaryRead(e,e.uint32(),i,s.migration);break;case 6:s.fastReconnect=e.bool();break;case 7:s.reconnectDetails=il.internalBinaryRead(e,e.uint32(),i,s.reconnectDetails);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.token&&t.tag(1,H.TD.LengthDelimited).string(e.token),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId),""!==e.subscriberSdp&&t.tag(3,H.TD.LengthDelimited).string(e.subscriberSdp),e.clientDetails&&e0.internalBinaryWrite(e.clientDetails,t.tag(4,H.TD.LengthDelimited).fork(),i).join(),e.migration&&id.internalBinaryWrite(e.migration,t.tag(5,H.TD.LengthDelimited).fork(),i).join(),!1!==e.fastReconnect&&t.tag(6,H.TD.Varint).bool(e.fastReconnect),e.reconnectDetails&&il.internalBinaryWrite(e.reconnectDetails,t.tag(7,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.JoinRequest",[{no:1,name:"token",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"subscriber_sdp",kind:"scalar",T:9},{no:4,name:"client_details",kind:"message",T:()=>e0},{no:5,name:"migration",kind:"message",T:()=>id},{no:6,name:"fast_reconnect",kind:"scalar",T:8},{no:7,name:"reconnect_details",kind:"message",T:()=>il}])}}let ir=new ia;class io extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.strategy=0,t.announcedTracks=[],t.subscriptions=[],t.reconnectAttempt=0,t.fromSfuId="",t.previousSessionId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.strategy=e.int32();break;case 3:s.announcedTracks.push(eX.internalBinaryRead(e,e.uint32(),i));break;case 4:s.subscriptions.push(tO.internalBinaryRead(e,e.uint32(),i));break;case 5:s.reconnectAttempt=e.uint32();break;case 6:s.fromSfuId=e.string();break;case 7:s.previousSessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.strategy&&t.tag(1,H.TD.Varint).int32(e.strategy);for(let n=0;n<e.announcedTracks.length;n++)eX.internalBinaryWrite(e.announcedTracks[n],t.tag(3,H.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.subscriptions.length;n++)tO.internalBinaryWrite(e.subscriptions[n],t.tag(4,H.TD.LengthDelimited).fork(),i).join();0!==e.reconnectAttempt&&t.tag(5,H.TD.Varint).uint32(e.reconnectAttempt),""!==e.fromSfuId&&t.tag(6,H.TD.LengthDelimited).string(e.fromSfuId),""!==e.previousSessionId&&t.tag(7,H.TD.LengthDelimited).string(e.previousSessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ReconnectDetails",[{no:1,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",A,"WEBSOCKET_RECONNECT_STRATEGY_"]},{no:3,name:"announced_tracks",kind:"message",repeat:1,T:()=>eX},{no:4,name:"subscriptions",kind:"message",repeat:1,T:()=>tO},{no:5,name:"reconnect_attempt",kind:"scalar",T:13},{no:6,name:"from_sfu_id",kind:"scalar",T:9},{no:7,name:"previous_session_id",kind:"scalar",T:9}])}}let il=new io;class ic extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.fromSfuId="",t.announcedTracks=[],t.subscriptions=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.fromSfuId=e.string();break;case 2:s.announcedTracks.push(eX.internalBinaryRead(e,e.uint32(),i));break;case 3:s.subscriptions.push(tO.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.fromSfuId&&t.tag(1,H.TD.LengthDelimited).string(e.fromSfuId);for(let n=0;n<e.announcedTracks.length;n++)eX.internalBinaryWrite(e.announcedTracks[n],t.tag(2,H.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.subscriptions.length;n++)tO.internalBinaryWrite(e.subscriptions[n],t.tag(3,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.Migration",[{no:1,name:"from_sfu_id",kind:"scalar",T:9},{no:2,name:"announced_tracks",kind:"message",repeat:1,T:()=>eX},{no:3,name:"subscriptions",kind:"message",repeat:1,T:()=>tO}])}}let id=new ic;class ih extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.reconnected=!1,t.fastReconnectDeadlineSeconds=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.callState=eA.internalBinaryRead(e,e.uint32(),i,s.callState);break;case 2:s.reconnected=e.bool();break;case 3:s.fastReconnectDeadlineSeconds=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.callState&&eA.internalBinaryWrite(e.callState,t.tag(1,H.TD.LengthDelimited).fork(),i).join(),!1!==e.reconnected&&t.tag(2,H.TD.Varint).bool(e.reconnected),0!==e.fastReconnectDeadlineSeconds&&t.tag(3,H.TD.Varint).int32(e.fastReconnectDeadlineSeconds);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.JoinResponse",[{no:1,name:"call_state",kind:"message",T:()=>eA},{no:2,name:"reconnected",kind:"scalar",T:8},{no:3,name:"fast_reconnect_deadline_seconds",kind:"scalar",T:5}])}}let iu=new ih;class ip extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.callCid="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.callCid=e.string();break;case 2:s.participant=eV.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.callCid&&t.tag(1,H.TD.LengthDelimited).string(e.callCid),e.participant&&eV.internalBinaryWrite(e.participant,t.tag(2,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ParticipantJoined",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>eV}])}}let ig=new ip;class im extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.callCid="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.callCid=e.string();break;case 2:s.participant=eV.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.callCid&&t.tag(1,H.TD.LengthDelimited).string(e.callCid),e.participant&&eV.internalBinaryWrite(e.participant,t.tag(2,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ParticipantLeft",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>eV}])}}let iy=new im;class ib extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.callCid="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.callCid=e.string();break;case 2:s.participant=eV.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.callCid&&t.tag(1,H.TD.LengthDelimited).string(e.callCid),e.participant&&eV.internalBinaryWrite(e.participant,t.tag(2,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ParticipantUpdated",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>eV}])}}let iv=new ib;class ik extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.iceRestart=!1,t.sdp="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.iceRestart=e.bool();break;case 2:s.sdp=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){!1!==e.iceRestart&&t.tag(1,H.TD.Varint).bool(e.iceRestart),""!==e.sdp&&t.tag(2,H.TD.LengthDelimited).string(e.sdp);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.SubscriberOffer",[{no:1,name:"ice_restart",kind:"scalar",T:8},{no:2,name:"sdp",kind:"scalar",T:9}])}}let iw=new ik;class iT extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.sdp="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.sdp=e.string();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sdp&&t.tag(1,H.TD.LengthDelimited).string(e.sdp);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.PublisherAnswer",[{no:1,name:"sdp",kind:"scalar",T:9}])}}let iS=new iT;class iC extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.connectionQualityUpdates=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.connectionQualityUpdates.push(iI.internalBinaryRead(e,e.uint32(),i));else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.connectionQualityUpdates.length;n++)iI.internalBinaryWrite(e.connectionQualityUpdates[n],t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ConnectionQualityChanged",[{no:1,name:"connection_quality_updates",kind:"message",repeat:1,T:()=>iI}])}}let iE=new iC;class iR extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.userId="",t.sessionId="",t.connectionQuality=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.connectionQuality=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,H.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId),0!==e.connectionQuality&&t.tag(3,H.TD.Varint).int32(e.connectionQuality);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ConnectionQualityInfo",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",R,"CONNECTION_QUALITY_"]}])}}let iI=new iR;class iD extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.userId="",t.sessionId="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,H.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.DominantSpeakerChanged",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}let i_=new iD;class iN extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.userId="",t.sessionId="",t.level=0,t.isSpeaking=!1,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.level=e.float();break;case 4:s.isSpeaking=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,H.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,H.TD.LengthDelimited).string(e.sessionId),0!==e.level&&t.tag(3,H.TD.Bit32).float(e.level),!1!==e.isSpeaking&&t.tag(4,H.TD.Varint).bool(e.isSpeaking);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.AudioLevel",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"level",kind:"scalar",T:2},{no:4,name:"is_speaking",kind:"scalar",T:8}])}}let iP=new iN;class iU extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.audioLevels=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.audioLevels.push(iP.internalBinaryRead(e,e.uint32(),i));else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.audioLevels.length;n++)iP.internalBinaryWrite(e.audioLevels[n],t.tag(1,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.AudioLevelChanged",[{no:1,name:"audio_levels",kind:"message",repeat:1,T:()=>iP}])}}let iO=new iU;class iA extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.channelCount=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.channelCount=e.int32();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.channelCount&&t.tag(1,H.TD.Varint).int32(e.channelCount);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.AudioMediaRequest",[{no:1,name:"channel_count",kind:"scalar",T:5}])}}let iL=new iA;class iB extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.mediaRequest=iL.internalBinaryRead(e,e.uint32(),i,s.mediaRequest);break;case 2:s.codec=eG.internalBinaryRead(e,e.uint32(),i,s.codec);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.mediaRequest&&iL.internalBinaryWrite(e.mediaRequest,t.tag(1,H.TD.LengthDelimited).fork(),i).join(),e.codec&&eG.internalBinaryWrite(e.codec,t.tag(2,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.AudioSender",[{no:1,name:"media_request",kind:"message",T:()=>iL},{no:2,name:"codec",kind:"message",T:()=>eG}])}}let ij=new iB;class iF extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.idealHeight=0,t.idealWidth=0,t.idealFrameRate=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.idealHeight=e.int32();break;case 2:s.idealWidth=e.int32();break;case 3:s.idealFrameRate=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.idealHeight&&t.tag(1,H.TD.Varint).int32(e.idealHeight),0!==e.idealWidth&&t.tag(2,H.TD.Varint).int32(e.idealWidth),0!==e.idealFrameRate&&t.tag(3,H.TD.Varint).int32(e.idealFrameRate);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.VideoMediaRequest",[{no:1,name:"ideal_height",kind:"scalar",T:5},{no:2,name:"ideal_width",kind:"scalar",T:5},{no:3,name:"ideal_frame_rate",kind:"scalar",T:5}])}}let iW=new iF;class iV extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.name="",t.active=!1,t.maxBitrate=0,t.scaleResolutionDownBy=0,t.priority=0,t.maxFramerate=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.name=e.string();break;case 2:s.active=e.bool();break;case 3:s.maxBitrate=e.int32();break;case 4:s.scaleResolutionDownBy=e.float();break;case 5:s.priority=e.int32();break;case 6:s.codec=eG.internalBinaryRead(e,e.uint32(),i,s.codec);break;case 7:s.maxFramerate=e.uint32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.name&&t.tag(1,H.TD.LengthDelimited).string(e.name),!1!==e.active&&t.tag(2,H.TD.Varint).bool(e.active),0!==e.maxBitrate&&t.tag(3,H.TD.Varint).int32(e.maxBitrate),0!==e.scaleResolutionDownBy&&t.tag(4,H.TD.Bit32).float(e.scaleResolutionDownBy),0!==e.priority&&t.tag(5,H.TD.Varint).int32(e.priority),e.codec&&eG.internalBinaryWrite(e.codec,t.tag(6,H.TD.LengthDelimited).fork(),i).join(),0!==e.maxFramerate&&t.tag(7,H.TD.Varint).uint32(e.maxFramerate);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.VideoLayerSetting",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"active",kind:"scalar",T:8},{no:3,name:"max_bitrate",kind:"scalar",T:5},{no:4,name:"scale_resolution_down_by",kind:"scalar",T:2},{no:5,name:"priority",kind:"enum",T:()=>["stream.video.sfu.event.VideoLayerSetting.Priority",L,"PRIORITY_"]},{no:6,name:"codec",kind:"message",T:()=>eG},{no:7,name:"max_framerate",kind:"scalar",T:13}])}}let iM=new iV;class ix extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.layers=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.mediaRequest=iW.internalBinaryRead(e,e.uint32(),i,s.mediaRequest);break;case 2:s.codec=eG.internalBinaryRead(e,e.uint32(),i,s.codec);break;case 3:s.layers.push(iM.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.mediaRequest&&iW.internalBinaryWrite(e.mediaRequest,t.tag(1,H.TD.LengthDelimited).fork(),i).join(),e.codec&&eG.internalBinaryWrite(e.codec,t.tag(2,H.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.layers.length;n++)iM.internalBinaryWrite(e.layers[n],t.tag(3,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.VideoSender",[{no:1,name:"media_request",kind:"message",T:()=>iW},{no:2,name:"codec",kind:"message",T:()=>eG},{no:3,name:"layers",kind:"message",repeat:1,T:()=>iM}])}}let iH=new ix;class iz extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.audioSenders=[],t.videoSenders=[],void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.audioSenders.push(ij.internalBinaryRead(e,e.uint32(),i));break;case 2:s.videoSenders.push(iH.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.audioSenders.length;n++)ij.internalBinaryWrite(e.audioSenders[n],t.tag(1,H.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.videoSenders.length;n++)iH.internalBinaryWrite(e.videoSenders[n],t.tag(2,H.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ChangePublishQuality",[{no:1,name:"audio_senders",kind:"message",repeat:1,T:()=>ij},{no:2,name:"video_senders",kind:"message",repeat:1,T:()=>iH}])}}let iq=new iz;class iK extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.message="",void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.currentGrants=ti.internalBinaryRead(e,e.uint32(),i,s.currentGrants);break;case 2:s.message=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.currentGrants&&ti.internalBinaryWrite(e.currentGrants,t.tag(1,H.TD.LengthDelimited).fork(),i).join(),""!==e.message&&t.tag(2,H.TD.LengthDelimited).string(e.message);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.CallGrantsUpdated",[{no:1,name:"current_grants",kind:"message",T:()=>ti},{no:2,name:"message",kind:"scalar",T:9}])}}let iJ=new iK;class iG extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.reason=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.reason=e.int32();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.reason&&t.tag(1,H.TD.Varint).int32(e.reason);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.GoAway",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.GoAwayReason",U,"GO_AWAY_REASON_"]}])}}let i$=new iG;class iQ extends V.C{create(e){let t=globalThis.Object.create(this.messagePrototype);return t.reason=0,void 0!==e&&(0,x.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.reason=e.int32();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?H.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.reason&&t.tag(1,H.TD.Varint).int32(e.reason);let n=i.writeUnknownFields;return!1!==n&&(!0==n?H.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.CallEnded",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.CallEndedReason",O,"CALL_ENDED_REASON_"]}])}}let iX=new iQ;(v=B||(B={})).UNKNOWN="UNKNOWN",v.VISIBLE="VISIBLE",v.INVISIBLE="INVISIBLE",(k=j||(j={}))[k.IMMEDIATE=20]="IMMEDIATE",k[k.FAST=100]="FAST",k[k.MEDIUM=600]="MEDIUM",k[k.SLOW=1200]="SLOW";class iY{setPublisher(e,t){let i=this.methods[0],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}sendAnswer(e,t){let i=this.methods[1],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}iceTrickle(e,t){let i=this.methods[2],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}updateSubscriptions(e,t){let i=this.methods[3],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}updateMuteStates(e,t){let i=this.methods[4],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}iceRestart(e,t){let i=this.methods[5],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}sendStats(e,t){let i=this.methods[6],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}startNoiseCancellation(e,t){let i=this.methods[7],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}stopNoiseCancellation(e,t){let i=this.methods[8],n=this._transport.mergeOptions(t);return(0,K.xA)("unary",this._transport,i,n,e)}constructor(e){this._transport=e,this.typeName=tz.typeName,this.methods=tz.methods,this.options=tz.options}}let iZ={baseUrl:"",sendJson:!0,timeout:5e3,jsonOptions:{ignoreUnknownFields:!0}},i0=e=>({interceptUnary:(t,i,n,s)=>(s.meta={...s.meta,...e},t(i,n,s))}),i1=(e,t)=>({interceptUnary:(i,n,s,a)=>(e(t,"Calling SFU RPC method ".concat(n.name),{input:s,options:a}),i(n,s,a))}),i2=e=>new iY(new Q.M({...iZ,...e})),i3=e=>new Promise(t=>setTimeout(t,e));function i9(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}let i4={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function i5(e){let t=Math.min(Math.max(250,(e-1)*2e3),5e3);return Math.floor(Math.random()*(Math.min(500+2e3*e,5e3)-t)+t)}function i6(e){let t="";for(let i=0;i<e.length;i++)t+=e[i].toString(16).padStart(2,"0");return t}function i8(){let e=function(e){let t=new Uint8Array(16);return i7(t),t}(0);return e[6]=15&e[6]|64,e[8]=191&e[8]|128,i6(e.subarray(0,4))+"-"+i6(e.subarray(4,6))+"-"+i6(e.subarray(6,8))+"-"+i6(e.subarray(8,10))+"-"+i6(e.subarray(10,16))}let i7="undefined"!=typeof crypto&&void 0!==(null===(w=crypto)||void 0===w?void 0:w.getRandomValues)?crypto.getRandomValues.bind(crypto):"undefined"!=typeof msCrypto?msCrypto.getRandomValues.bind(msCrypto):function(e){let t=Math.pow(2,8*e.byteLength/e.length);for(let i=0;i<e.length;i++)e[i]=Math.random()*t};function ne(e){"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("offline",e),window.addEventListener("online",e))}function nt(e){"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("offline",e),window.removeEventListener("online",e))}let ni=()=>{var e;return"undefined"!=typeof navigator&&(null===(e=navigator.product)||void 0===e?void 0:e.toLowerCase())==="reactnative"},nn=Object.freeze({trace:0,debug:1,info:2,warn:3,error:4}),ns="info",na=function(e,t){let i;for(var n=arguments.length,s=Array(n>2?n-2:0),a=2;a<n;a++)s[a-2]=arguments[a];switch(e){case"error":if(ni()){t="ERROR: ".concat(t),i=console.info;break}i=console.error;break;case"warn":if(ni()){t="WARN: ".concat(t),i=console.info;break}i=console.warn;break;case"info":i=console.info;break;case"trace":i=console.trace;break;default:i=console.log}i(t,...s)},nr=(e,t)=>{n=e,t&&no(t)},no=e=>{ns=e},nl=()=>ns,nc=e=>{let t=n||na,i=(e||[]).filter(Boolean).join(":");return function(e,n){for(var s=arguments.length,a=Array(s>2?s-2:0),r=2;r<s;r++)a[r-2]=arguments[r];nn[e]>=nn[ns]&&t(e,"[".concat(i,"]: ").concat(n),...a)}},nd=async(e,t)=>{var i,n;let s;let a=0;do{a>0&&await i3(i5(a));try{s=await e()}catch(s){let e=s instanceof J.l&&s.code===X.b[X.b.cancelled],i=null!==(n=null==t?void 0:t.aborted)&&void 0!==n&&n;if(e||i)throw s;nc(["sfu-client","rpc"])("debug","rpc failed (".concat(a,")"),s),a++}}while(!s||(null===(i=s.response.error)||void 0===i?void 0:i.shouldRetry));return s},[nh,nu,np]="1.6.4".split("."),ng={type:N.PLAIN_JAVASCRIPT,major:nh,minor:nu,patch:np},nm=e=>{ng=e},ny=()=>ng,nf=()=>s,nb=()=>a,nv=()=>r,nk=()=>{if(ni())return{sdk:ny(),os:nf(),device:nb()};let{browser:e,os:t,device:i,cpu:n}=new Y.UAParser(navigator.userAgent).getResult();return{sdk:ny(),browser:{name:e.name||navigator.userAgent,version:e.version||""},os:{name:t.name||"",version:t.version||"",architecture:n.architecture||""},device:{name:[i.vendor,i.model,i.type].filter(Boolean).join(" "),version:""}}},nw=(e,t,i)=>{if(!("getCapabilities"in RTCRtpReceiver))return;let n=RTCRtpReceiver.getCapabilities(e);if(!n)return;let s=[],a=[],r=[],o="".concat(e,"/").concat(t.toLowerCase()),l=i&&"".concat(e,"/").concat(i.toLowerCase());for(let e of n.codecs){let t=e.mimeType.toLowerCase();if(t===l)continue;if(t!==o){r.push(e);continue}if("video/h264"!==t){s.push(e);continue}let i=e.sdpFmtpLine;if(!i||!i.includes("profile-level-id=42e01f")){a.push(e);continue}i.includes("packetization-mode=0")||!i.includes("packetization-mode")?s.unshift(e):s.push(e)}return[...s,...a,...r]},nT=async e=>{var t;let i=new RTCPeerConnection;i.addTransceiver("video",{direction:e}),i.addTransceiver("audio",{direction:e});let n=null!==(t=(await i.createOffer()).sdp)&&void 0!==t?t:"";return i.getTransceivers().forEach(e=>{var t;null===(t=e.stop)||void 0===t||t.call(e)}),i.close(),n},nS=()=>{var e;let t=null===(e=nf())||void 0===e?void 0:e.name.toLowerCase();return"ipados"===t?"h264":"android"===t?"vp8":void 0},nC={subscriberOffer:void 0,publisherAnswer:void 0,connectionQualityChanged:void 0,audioLevelChanged:void 0,iceTrickle:void 0,changePublishQuality:void 0,participantJoined:void 0,participantLeft:void 0,dominantSpeakerChanged:void 0,joinResponse:void 0,healthCheckResponse:void 0,trackPublished:void 0,trackUnpublished:void 0,error:void 0,callGrantsUpdated:void 0,goAway:void 0,iceRestart:void 0,pinsUpdated:void 0,callEnded:void 0,participantUpdated:void 0,participantMigrationComplete:void 0},nE=e=>Object.prototype.hasOwnProperty.call(nC,e);class nR{constructor(){var e=this;this.logger=nc(["Dispatcher"]),this.subscribers={},this.dispatch=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",n=t.eventPayload.oneofKind;if(!n)return;let s=t.eventPayload[n];e.logger("debug","Dispatching ".concat(n,", tag=").concat(i),s);let a=e.subscribers[n];if(a)for(let t of a)try{t(s)}catch(t){e.logger("warn","Listener failed with error",t)}},this.on=(e,t)=>{var i,n;return(null!==(n=(i=this.subscribers)[e])&&void 0!==n?n:i[e]=[]).push(t),()=>{this.off(e,t)}},this.off=(e,t)=>{this.subscribers[e]=(this.subscribers[e]||[]).filter(e=>e!==t)},this.offAll=e=>{e?this.subscribers[e]=[]:this.subscribers={}}}}class nI{constructor(){this.subscriberCandidates=new Z.t,this.publisherCandidates=new Z.t,this.push=e=>{e.peerType===E.SUBSCRIBER?this.subscriberCandidates.next(e):e.peerType===E.PUBLISHER_UNSPECIFIED?this.publisherCandidates.next(e):nc(["sfu-client"])("warn","ICETrickle, Unknown peer type",e)}}}function nD(e){if(e.usernameFragment)return JSON.stringify(e.toJSON());{let t=e.candidate.split(" "),i=t.findIndex(e=>"ufrag"===e)+1,n=t[i];return JSON.stringify({...e,usernameFragment:n})}}let n_={bitrate:125e4,width:1280,height:720},nN={q:3e5,h:75e4,f:125e4},nP=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n_,i=arguments.length>2?arguments[2]:void 0,n=[],s=e.getSettings(),{width:a=0,height:r=0}=s,o=nU(t,a,r,i),l=1;return["f","h","q"].forEach(e=>{n.unshift({active:!0,rid:e,width:Math.round(a/l),height:Math.round(r/l),maxBitrate:Math.round(o/l)||nN[e],scaleResolutionDownBy:l,maxFramerate:30}),l*=2}),nO(s,n)},nU=(e,t,i,n)=>{let{width:s,height:a,bitrate:r}=e,o=n||r;return t<s||i<a?Math.round(t*i/(s*a)*o):o},nO=(e,t)=>{let i;let n=Math.max(e.width||0,e.height||0);i=n<=320?t.filter(e=>"f"===e.rid):n<=640?t.filter(e=>"h"!==e.rid):t;let s=["q","h","f"];return i.map((e,t)=>({...e,rid:s[t]}))},nA=function(e,t){var i,n;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e6,a=e.getSettings();return[{active:!0,rid:"q",width:a.width||0,height:a.height||0,scaleResolutionDownBy:1,maxBitrate:null!==(i=null==t?void 0:t.maxBitrate)&&void 0!==i?i:s,maxFramerate:null!==(n=null==t?void 0:t.maxFramerate)&&void 0!==n?n:30}]},nL=(e,t)=>{nc(["helpers"])("warn",t,e)},nB=e=>{switch(e){case D.SCREEN_SHARE:return"screenShareStream";case D.SCREEN_SHARE_AUDIO:return"screenShareAudioStream";case D.VIDEO:return"videoStream";case D.AUDIO:return"audioStream";case D.UNSPECIFIED:throw Error("Track type is unspecified");default:nL(e,"Unknown track type")}},nj=e=>{switch(e){case"audio":return D.AUDIO;case"video":return D.VIDEO;case"screenshare":return D.SCREEN_SHARE;case"screenshare_audio":return D.SCREEN_SHARE_AUDIO;default:nL(e,"Unknown mute type")}},nF=e=>{switch(e){case"TRACK_TYPE_AUDIO":return D.AUDIO;case"TRACK_TYPE_VIDEO":return D.VIDEO;case"TRACK_TYPE_SCREEN_SHARE":return D.SCREEN_SHARE;case"TRACK_TYPE_SCREEN_SHARE_AUDIO":return D.SCREEN_SHARE_AUDIO;default:return}},nW=nH(function(e,t){let i=!1;return{cb:()=>t().finally(()=>{i||nM.delete(e)}),onContinued:()=>i=!0}}),nV=nH(function(e,t){let i=new AbortController;return{cb:()=>i.signal.aborted?Promise.resolve("canceled"):t(i.signal).finally(()=>{i.signal.aborted||nM.delete(e)}),onContinued:()=>i.abort()}}),nM=new Map;async function nx(e){var t;await (null===(t=nM.get(e))||void 0===t?void 0:t.promise)}function nH(e){return function(t,i){let{cb:n,onContinued:s}=e(t,i),a=nM.get(t);null==a||a.onContinued();let r=a?a.promise.then(n,n):n();return nM.set(t,{promise:r,onContinued:s}),r}}let nz=e=>"function"==typeof e,nq=e=>{let t,i;if((0,ee.a)([e]).subscribe({next:e=>{let[i]=e;t=i},error:e=>{i=e}}).unsubscribe(),i)throw i;return t},nK=(e,t)=>{let i=nz(t)?t(nq(e)):t;return e.next(i),i},nJ=(e,t)=>{let i=e.subscribe(t);return()=>{i.unsubscribe()}},nG=(e,t)=>{let i=Symbol(),n=e.subscribe(e=>{nW(i,()=>t(e))});return()=>{n.unsubscribe()}};var n$=Object.freeze({__proto__:null,createSafeAsyncSubscription:nG,createSubscription:nJ,getCurrentValue:nq,setCurrentValue:nK});(T=F||(F={})).UNKNOWN="unknown",T.IDLE="idle",T.RINGING="ringing",T.JOINING="joining",T.JOINED="joined",T.LEFT="left",T.RECONNECTING="reconnecting",T.MIGRATING="migrating",T.RECONNECTING_FAILED="reconnecting-failed",T.OFFLINE="offline";class nQ{get connectedUser(){return nq(this.connectedUserSubject)}get calls(){return nq(this.callsSubject)}constructor(){this.connectedUserSubject=new et.X(void 0),this.callsSubject=new et.X([]),this.setConnectedUser=e=>nK(this.connectedUserSubject,e),this.setCalls=e=>nK(this.callsSubject,e),this.registerCall=e=>{this.calls.find(t=>t.cid===e.cid)||this.setCalls(t=>[...t,e])},this.unregisterCall=e=>this.setCalls(t=>t.filter(t=>t!==e)),this.findCall=(e,t)=>this.calls.find(i=>i.type===e&&i.id===t),this.connectedUserSubject.subscribe(async e=>{if(!e){let e=nc(["client-state"]);for(let t of this.calls)t.state.callingState!==F.LEFT&&(e("info","User disconnected, leaving call: ".concat(t.cid)),await t.leave({reason:"client.disconnectUser() called"}).catch(i=>{e("error","Error leaving call: ".concat(t.cid),i)}))}})}}class nX{get connectedUser(){return nq(this.connectedUser$)}get calls(){return nq(this.calls$)}constructor(e){this.getCurrentValue=nq,this.connectedUser$=e.connectedUserSubject.asObservable(),this.calls$=e.callsSubject.asObservable()}}let nY=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(e,i)=>{for(let n of t){let t=n(e,i);if(0!==t)return t}return 0}},nZ=e=>t=>(i,n)=>e(i,n)?t(i,n):0,n0=e=>e.publishedTracks.includes(D.VIDEO),n1=e=>e.publishedTracks.includes(D.AUDIO),n2=e=>e.publishedTracks.includes(D.SCREEN_SHARE),n3=e=>e.publishedTracks.includes(D.SCREEN_SHARE_AUDIO),n9=e=>!!e.pin&&(e.pin.isLocalPin||e.pin.pinnedAt>0),n4=(e,t)=>e.isDominantSpeaker&&!t.isDominantSpeaker?-1:!e.isDominantSpeaker&&t.isDominantSpeaker?1:0,n5=(e,t)=>e.isSpeaking&&!t.isSpeaking?-1:!e.isSpeaking&&t.isSpeaking?1:0,n6=(e,t)=>n2(e)&&!n2(t)?-1:!n2(e)&&n2(t)?1:0,n8=(e,t)=>n0(e)&&!n0(t)?-1:!n0(e)&&n0(t)?1:0,n7=(e,t)=>n1(e)&&!n1(t)?-1:!n1(e)&&n1(t)?1:0,se=(e,t)=>{if(e.pin&&t.pin){if(!e.pin.isLocalPin&&t.pin.isLocalPin)return -1;if(e.pin.isLocalPin&&!t.pin.isLocalPin)return 1;if(e.pin.pinnedAt>t.pin.pinnedAt)return -1;if(e.pin.pinnedAt<t.pin.pinnedAt)return 1}return e.pin&&!t.pin?-1:!e.pin&&t.pin?1:0},st=e=>(t,i)=>{var n,s,a,r;return(null===(n=t.reaction)||void 0===n?void 0:n.type)===e&&(null===(s=i.reaction)||void 0===s?void 0:s.type)!==e?-1:(null===(a=t.reaction)||void 0===a?void 0:a.type)!==e&&(null===(r=i.reaction)||void 0===r?void 0:r.type)===e?1:0},si=(e,t)=>e.name<t.name?-1:e.name>t.name?1:0,sn=(e,t)=>(e.roles||[]).some(e=>t.includes(e)),ss=nZ((e,t)=>{var i,n;return(null===(i=e.viewportVisibilityState)||void 0===i?void 0:i.videoTrack)===B.INVISIBLE||(null===(n=t.viewportVisibilityState)||void 0===n?void 0:n.videoTrack)===B.INVISIBLE}),sa=nZ((e,t)=>{var i,n,s,a;return(null===(i=e.viewportVisibilityState)||void 0===i?void 0:i.videoTrack)===B.INVISIBLE||(null===(n=e.viewportVisibilityState)||void 0===n?void 0:n.videoTrack)===B.UNKNOWN||(null===(s=t.viewportVisibilityState)||void 0===s?void 0:s.videoTrack)===B.INVISIBLE||(null===(a=t.viewportVisibilityState)||void 0===a?void 0:a.videoTrack)===B.UNKNOWN}),sr=nY(se,n6,ss(nY(n4,n5,st("raised-hand"),n8,n7))),so=nY(se,n6,n4,ss(nY(n5,st("raised-hand"),n8,n7))),sl=nY(se,sa(nY(n4,n5,st("raised-hand"),n8,n7))),sc=nY(ss(nY(n4,n5,st("raised-hand"),n8,n7)),function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(e,i)=>sn(e,t)&&!sn(i,t)?-1:!sn(e,t)&&sn(i,t)?1:0}("admin","host","speaker")),sd={broadcasting:!1,hls:{playlist_url:""},rtmps:[]};class sh{get participantCount(){return this.getCurrentValue(this.participantCount$)}get startedAt(){return this.getCurrentValue(this.startedAt$)}get anonymousParticipantCount(){return this.getCurrentValue(this.anonymousParticipantCount$)}get participants(){return this.getCurrentValue(this.participants$)}get localParticipant(){return this.getCurrentValue(this.localParticipant$)}get remoteParticipants(){return this.getCurrentValue(this.remoteParticipants$)}get dominantSpeaker(){return this.getCurrentValue(this.dominantSpeaker$)}get pinnedParticipants(){return this.getCurrentValue(this.pinnedParticipants$)}get hasOngoingScreenShare(){return this.getCurrentValue(this.hasOngoingScreenShare$)}get callingState(){return this.getCurrentValue(this.callingState$)}get callStatsReport(){return this.getCurrentValue(this.callStatsReport$)}get members(){return this.getCurrentValue(this.members$)}get ownCapabilities(){return this.getCurrentValue(this.ownCapabilities$)}get backstage(){return this.getCurrentValue(this.backstage$)}get blockedUserIds(){return this.getCurrentValue(this.blockedUserIds$)}get createdAt(){return this.getCurrentValue(this.createdAt$)}get endedAt(){return this.getCurrentValue(this.endedAt$)}get startsAt(){return this.getCurrentValue(this.startsAt$)}get updatedAt(){return this.getCurrentValue(this.updatedAt$)}get createdBy(){return this.getCurrentValue(this.createdBy$)}get custom(){return this.getCurrentValue(this.custom$)}get egress(){return this.getCurrentValue(this.egress$)}get ingress(){return this.getCurrentValue(this.ingress$)}get recording(){return this.getCurrentValue(this.recording$)}get session(){return this.getCurrentValue(this.session$)}get settings(){return this.getCurrentValue(this.settings$)}get transcribing(){return this.getCurrentValue(this.transcribing$)}get endedBy(){return this.getCurrentValue(this.endedBy$)}get thumbnails(){return this.getCurrentValue(this.thumbnails$)}constructor(){this.backstageSubject=new et.X(!0),this.blockedUserIdsSubject=new et.X([]),this.createdAtSubject=new et.X(new Date),this.endedAtSubject=new et.X(void 0),this.startsAtSubject=new et.X(void 0),this.updatedAtSubject=new et.X(new Date),this.createdBySubject=new et.X(void 0),this.customSubject=new et.X({}),this.egressSubject=new et.X(void 0),this.ingressSubject=new et.X(void 0),this.recordingSubject=new et.X(!1),this.sessionSubject=new et.X(void 0),this.settingsSubject=new et.X(void 0),this.transcribingSubject=new et.X(!1),this.endedBySubject=new et.X(void 0),this.thumbnailsSubject=new et.X(void 0),this.membersSubject=new et.X([]),this.ownCapabilitiesSubject=new et.X([]),this.callingStateSubject=new et.X(F.UNKNOWN),this.startedAtSubject=new et.X(void 0),this.participantCountSubject=new et.X(0),this.anonymousParticipantCountSubject=new et.X(0),this.participantsSubject=new et.X([]),this.callStatsReportSubject=new et.X(void 0),this.orphanedTracks=[],this.logger=nc(["CallState"]),this.sortParticipantsBy=sr,this.setSortParticipantsBy=e=>{this.sortParticipantsBy=e,this.setCurrentValue(this.participantsSubject,e=>e)},this.getCurrentValue=nq,this.setCurrentValue=nK,this.setParticipantCount=e=>this.setCurrentValue(this.participantCountSubject,e),this.setStartedAt=e=>this.setCurrentValue(this.startedAtSubject,e),this.setAnonymousParticipantCount=e=>this.setCurrentValue(this.anonymousParticipantCountSubject,e),this.setParticipants=e=>this.setCurrentValue(this.participantsSubject,e),this.setCallingState=e=>this.setCurrentValue(this.callingStateSubject,e),this.setCallStatsReport=e=>this.setCurrentValue(this.callStatsReportSubject,e),this.setMembers=e=>{this.setCurrentValue(this.membersSubject,e)},this.setOwnCapabilities=e=>this.setCurrentValue(this.ownCapabilitiesSubject,e),this.setEndedAt=e=>this.setCurrentValue(this.endedAtSubject,e),this.findParticipantBySessionId=e=>this.participants.find(t=>t.sessionId===e),this.getParticipantLookupBySessionId=()=>this.participants.reduce((e,t)=>(e[t.sessionId]=t,e),{}),this.updateParticipant=(e,t)=>{let i=this.findParticipantBySessionId(e);if(!i){this.logger("warn","Participant with sessionId ".concat(e," not found"));return}let n="function"==typeof t?t(i):t,s={...i,...n};return this.setParticipants(t=>t.map(t=>t.sessionId===e?s:t))},this.updateOrAddParticipant=(e,t)=>this.setParticipants(i=>{let n=!0,s=i.map(i=>i.sessionId===e?(n=!1,{...i,...t}):i);return n&&s.push(t),s}),this.updateParticipants=e=>0===Object.keys(e).length?this.participants:this.setParticipants(t=>t.map(t=>{let i=e[t.sessionId];return i?{...t,...i}:t})),this.updateFromEvent=e=>{let t=this.eventHandlers[e.type];t&&t(e)},this.setServerSidePins=e=>{let t=e.reduce((e,t)=>(e[t.sessionId]=Date.now(),e),{});return this.setParticipants(e=>e.map(e=>{let i=t[e.sessionId];return i?{...e,pin:{isLocalPin:!1,pinnedAt:i}}:e.pin&&!e.pin.isLocalPin?{...e,pin:void 0}:e}))},this.registerOrphanedTrack=e=>{this.orphanedTracks.push(e)},this.removeOrphanedTrack=e=>{this.orphanedTracks=this.orphanedTracks.filter(t=>t.id!==e)},this.takeOrphanedTracks=e=>{let t=this.orphanedTracks.filter(t=>t.trackLookupPrefix===e);return t.length>0&&(this.orphanedTracks=this.orphanedTracks.filter(t=>t.trackLookupPrefix!==e)),t},this.updateFromCallResponse=e=>{this.setCurrentValue(this.backstageSubject,e.backstage),this.setCurrentValue(this.blockedUserIdsSubject,e.blocked_user_ids),this.setCurrentValue(this.createdAtSubject,new Date(e.created_at)),this.setCurrentValue(this.updatedAtSubject,new Date(e.updated_at)),this.setCurrentValue(this.startsAtSubject,e.starts_at?new Date(e.starts_at):void 0),this.setEndedAt(e.ended_at?new Date(e.ended_at):void 0),this.setCurrentValue(this.createdBySubject,e.created_by),this.setCurrentValue(this.customSubject,e.custom),this.setCurrentValue(this.egressSubject,e.egress),this.setCurrentValue(this.ingressSubject,e.ingress),this.setCurrentValue(this.recordingSubject,e.recording);let t=this.setCurrentValue(this.sessionSubject,e.session);this.updateParticipantCountFromSession(t),this.setCurrentValue(this.settingsSubject,e.settings),this.setCurrentValue(this.transcribingSubject,e.transcribing),this.setCurrentValue(this.thumbnailsSubject,e.thumbnails)},this.updateFromSfuCallState=(e,t,i)=>{var n;let{participants:s,participantCount:a,startedAt:r,pins:o}=e,l=null!==(n=null==i?void 0:i.announcedTracks.map(e=>e.trackType))&&void 0!==n?n:[];this.setParticipants(()=>{let e=this.getParticipantLookupBySessionId();return s.map(i=>{var n;let s=e[i.sessionId],a=i.sessionId===t;return Object.assign({},s,i,{isLocalParticipant:a,publishedTracks:a?l:i.publishedTracks,viewportVisibilityState:null!==(n=null==s?void 0:s.viewportVisibilityState)&&void 0!==n?n:{videoTrack:B.UNKNOWN,screenShareTrack:B.UNKNOWN}})})}),this.setParticipantCount((null==a?void 0:a.total)||0),this.setAnonymousParticipantCount((null==a?void 0:a.anonymous)||0),this.setStartedAt(r?eU.toDate(r):new Date),this.setServerSidePins(o)},this.updateFromMemberRemoved=e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.membersSubject,t=>t.filter(t=>-1===e.members.indexOf(t.user_id)))},this.updateFromMemberAdded=e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.membersSubject,t=>[...t,...e.members])},this.updateFromHLSBroadcastStopped=()=>{this.setCurrentValue(this.egressSubject,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sd;return{...e,broadcasting:!1}})},this.updateFromHLSBroadcastingFailed=()=>{this.setCurrentValue(this.egressSubject,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sd;return{...e,broadcasting:!1}})},this.updateFromHLSBroadcastStarted=e=>{this.setCurrentValue(this.egressSubject,function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sd;return{...t,broadcasting:!0,hls:{...t.hls,playlist_url:e.hls_playlist_url}}})},this.updateParticipantCountFromSession=e=>{if(!e||this.callingState===F.JOINED)return;let t=Math.max(Object.values(e.participants_count_by_role).reduce((e,t)=>e+t,0),e.participants.length);this.setParticipantCount(t),this.setAnonymousParticipantCount(e.anonymous_participant_count||0)},this.updateFromSessionParticipantCountUpdate=e=>{let t=this.setCurrentValue(this.sessionSubject,t=>t?{...t,anonymous_participant_count:e.anonymous_participant_count,participants_count_by_role:e.participants_count_by_role}:t);this.updateParticipantCountFromSession(t)},this.updateFromSessionParticipantLeft=e=>{let t=this.setCurrentValue(this.sessionSubject,t=>{if(!t)return t;let{participants:i,participants_count_by_role:n}=t,{user:s,user_session_id:a}=e.participant;return{...t,participants:i.filter(e=>e.user_session_id!==a),participants_count_by_role:{...n,[s.role]:Math.max(0,(n[s.role]||0)-1)}}});this.updateParticipantCountFromSession(t)},this.updateFromSessionParticipantJoined=e=>{let t=this.setCurrentValue(this.sessionSubject,t=>{if(!t)return t;let{participants:i,participants_count_by_role:n}=t,{user:s,user_session_id:a}=e.participant,r=!0,o=i.map(t=>t.user_session_id===a?(r=!1,e.participant):t);r&&o.push(e.participant);let l=r?1:0;return{...t,participants:o,participants_count_by_role:{...n,[s.role]:(n[s.role]||0)+l}}});this.updateParticipantCountFromSession(t)},this.updateMembers=e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.membersSubject,t=>t.map(t=>e.members.find(e=>e.user_id===t.user_id)||t))},this.updateParticipantReaction=e=>{let{user:t,custom:i,type:n,emoji_code:s}=e.reaction;this.setParticipants(e=>e.map(e=>e.userId!==t.id?e:{...e,reaction:{type:n,emoji_code:s,custom:i}}))},this.unblockUser=e=>{this.setCurrentValue(this.blockedUserIdsSubject,t=>t?t.filter(t=>t!==e.user.id):t)},this.blockUser=e=>{this.setCurrentValue(this.blockedUserIdsSubject,t=>[...t||[],e.user.id])},this.updateOwnCapabilities=e=>{var t;e.user.id===(null===(t=this.localParticipant)||void 0===t?void 0:t.userId)&&this.setCurrentValue(this.ownCapabilitiesSubject,e.own_capabilities)},this.participants$=this.participantsSubject.asObservable().pipe((0,ei.U)(e=>e.sort(this.sortParticipantsBy)),(0,en.d)({bufferSize:1,refCount:!0})),this.localParticipant$=this.participants$.pipe((0,ei.U)(e=>e.find(e=>e.isLocalParticipant)),(0,en.d)({bufferSize:1,refCount:!0})),this.remoteParticipants$=this.participants$.pipe((0,ei.U)(e=>e.filter(e=>!e.isLocalParticipant)),(0,en.d)({bufferSize:1,refCount:!0})),this.pinnedParticipants$=this.participants$.pipe((0,ei.U)(e=>e.filter(e=>!!e.pin)),(0,en.d)({bufferSize:1,refCount:!0})),this.dominantSpeaker$=this.participants$.pipe((0,ei.U)(e=>e.find(e=>e.isDominantSpeaker)),(0,en.d)({bufferSize:1,refCount:!0})),this.hasOngoingScreenShare$=this.participants$.pipe((0,ei.U)(e=>e.some(e=>n2(e))),(0,es.x)(),(0,en.d)({bufferSize:1,refCount:!0})),this.createdAt$=this.createdAtSubject.asObservable(),this.endedAt$=this.endedAtSubject.asObservable(),this.startsAt$=this.startsAtSubject.asObservable(),this.startedAt$=this.startedAtSubject.asObservable(),this.updatedAt$=this.updatedAtSubject.asObservable(),this.callStatsReport$=this.callStatsReportSubject.asObservable(),this.members$=this.membersSubject.asObservable(),this.createdBy$=this.createdBySubject.asObservable(),this.custom$=this.customSubject.asObservable(),this.egress$=this.egressSubject.asObservable(),this.ingress$=this.ingressSubject.asObservable(),this.session$=this.sessionSubject.asObservable(),this.settings$=this.settingsSubject.asObservable(),this.endedBy$=this.endedBySubject.asObservable(),this.thumbnails$=this.thumbnailsSubject.asObservable();let e=(e,t)=>{if(e.length!==t.length)return!1;for(let i of e)if(!t.includes(i))return!1;for(let i of t)if(!e.includes(i))return!1;return!0},t=(e,t)=>e.asObservable().pipe((0,es.x)(t));this.anonymousParticipantCount$=t(this.anonymousParticipantCountSubject),this.blockedUserIds$=t(this.blockedUserIdsSubject,e),this.backstage$=t(this.backstageSubject),this.callingState$=t(this.callingStateSubject),this.ownCapabilities$=t(this.ownCapabilitiesSubject,e),this.participantCount$=t(this.participantCountSubject),this.recording$=t(this.recordingSubject),this.transcribing$=t(this.transcribingSubject),this.eventHandlers={"call.closed_caption":void 0,"call.deleted":void 0,"call.permission_request":void 0,"call.recording_ready":void 0,"call.transcription_ready":void 0,"call.user_muted":void 0,"connection.error":void 0,"connection.ok":void 0,"health.check":void 0,"user.banned":void 0,"user.deactivated":void 0,"user.deleted":void 0,"user.muted":void 0,"user.presence.changed":void 0,"user.reactivated":void 0,"user.unbanned":void 0,"user.updated":void 0,custom:void 0,"call.accepted":e=>this.updateFromCallResponse(e.call),"call.blocked_user":this.blockUser,"call.created":e=>this.updateFromCallResponse(e.call),"call.ended":e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.endedBySubject,e.user)},"call.hls_broadcasting_failed":this.updateFromHLSBroadcastingFailed,"call.hls_broadcasting_started":this.updateFromHLSBroadcastStarted,"call.hls_broadcasting_stopped":this.updateFromHLSBroadcastStopped,"call.live_started":e=>this.updateFromCallResponse(e.call),"call.member_added":this.updateFromMemberAdded,"call.member_removed":this.updateFromMemberRemoved,"call.member_updated_permission":this.updateMembers,"call.member_updated":this.updateMembers,"call.notification":e=>{this.updateFromCallResponse(e.call),this.setMembers(e.members)},"call.permissions_updated":this.updateOwnCapabilities,"call.reaction_new":this.updateParticipantReaction,"call.recording_started":()=>this.setCurrentValue(this.recordingSubject,!0),"call.recording_stopped":()=>this.setCurrentValue(this.recordingSubject,!1),"call.recording_failed":()=>this.setCurrentValue(this.recordingSubject,!1),"call.rejected":e=>this.updateFromCallResponse(e.call),"call.ring":e=>this.updateFromCallResponse(e.call),"call.missed":e=>this.updateFromCallResponse(e.call),"call.session_ended":e=>this.updateFromCallResponse(e.call),"call.session_participant_count_updated":this.updateFromSessionParticipantCountUpdate,"call.session_participant_joined":this.updateFromSessionParticipantJoined,"call.session_participant_left":this.updateFromSessionParticipantLeft,"call.session_started":e=>this.updateFromCallResponse(e.call),"call.transcription_started":()=>{this.setCurrentValue(this.transcribingSubject,!0)},"call.transcription_stopped":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.transcription_failed":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.unblocked_user":this.unblockUser,"call.updated":e=>this.updateFromCallResponse(e.call)}}}let su=e=>{let t=/^a=rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/.exec(e);if(t)return{original:t[0],payload:t[1],codec:t[2]}},sp=e=>{let t=/^a=fmtp:(\d*) (.*)/.exec(e);if(t)return{original:t[0],payload:t[1],config:t[2]}},sg=(e,t)=>{let i=new RegExp("(m=".concat(t," \\d+ [\\w/]+) ([\\d\\s]+)")).exec(e);if(i)return{original:i[0],mediaWithPorts:i[1],codecOrder:i[2]}},sm=(e,t)=>{let i;let n=[],s=[],a=!1;if(e.split(/(\r\n|\r|\n)/).forEach(e=>{if(!/^([a-z])=(.*)/.test(e))return;let r=e[0];if("m"===r){let n=sg(e,t);a=!!n,n&&(i=n)}else if(a&&"a"===r){let t=su(e),i=sp(e);t?n.push(t):i&&s.push(i)}}),i)return{media:i,rtpMap:n,fmtp:s}},sy=e=>{let t=sm(e,"audio"),i=null==t?void 0:t.rtpMap.find(e=>"opus"===e.codec.toLowerCase()),n=null==i?void 0:i.payload;if(n)return null==t?void 0:t.fmtp.find(e=>e.payload===n)},sf=(e,t)=>{let i=sy(e);if(i){let n=/usedtx=(\d)/.exec(i.config),s="usedtx=".concat(t?"1":"0");if(n){let t=i.original.replace(/usedtx=(\d)/,s);return e.replace(i.original,t)}{let t="".concat(i.original,";").concat(s);return e.replace(i.original,t)}}return e},sb=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:51e4;i=Math.max(Math.min(i,51e4),96e3);let n=eb.Qc(e),s=n.media.find(e=>"audio"===e.type&&String(e.mid)===t);if(!s)return e;let a=s.rtp.find(e=>"opus"===e.codec);if(!a)return e;let r=s.fmtp.find(e=>e.payload===a.payload);return r?(r.config.match(/stereo=(\d)/)?r.config=r.config.replace(/stereo=(\d)/,"stereo=1"):r.config="".concat(r.config,";stereo=1"),r.config.match(/maxaveragebitrate=(\d*)/)?r.config=r.config.replace(/maxaveragebitrate=(\d*)/,"maxaveragebitrate=".concat(i)):r.config="".concat(r.config,";maxaveragebitrate=").concat(i),eb.cW(n)):e};class sv{constructor({connectionConfig:e,sfuClient:t,dispatcher:i,state:n,isDtxEnabled:s,isRedEnabled:a,onUnrecoverableError:r,logTag:o}){var l=this;this.transceiverRegistry={[D.AUDIO]:void 0,[D.VIDEO]:void 0,[D.SCREEN_SHARE]:void 0,[D.SCREEN_SHARE_AUDIO]:void 0,[D.UNSPECIFIED]:void 0},this.publishOptionsPerTrackType=new Map,this.transceiverInitOrder=[],this.trackKindMapping={[D.AUDIO]:"audio",[D.VIDEO]:"video",[D.SCREEN_SHARE]:"video",[D.SCREEN_SHARE_AUDIO]:"audio",[D.UNSPECIFIED]:void 0},this.trackLayersCache={[D.AUDIO]:void 0,[D.VIDEO]:void 0,[D.SCREEN_SHARE]:void 0,[D.SCREEN_SHARE_AUDIO]:void 0,[D.UNSPECIFIED]:void 0},this.isIceRestarting=!1,this.createPeerConnection=e=>{let t=new RTCPeerConnection(e);return t.addEventListener("icecandidate",this.onIceCandidate),t.addEventListener("negotiationneeded",this.onNegotiationNeeded),t.addEventListener("icecandidateerror",this.onIceCandidateError),t.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),t.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),t.addEventListener("signalingstatechange",this.onSignalingStateChange),t},this.close=e=>{let{stopTracks:t}=e;t&&(this.stopPublishing(),Object.keys(this.transceiverRegistry).forEach(e=>{this.transceiverRegistry[e]=void 0}),Object.keys(this.trackLayersCache).forEach(e=>{this.trackLayersCache[e]=void 0})),this.detachEventHandlers(),this.pc.close()},this.detachEventHandlers=()=>{this.unsubscribeOnIceRestart(),this.pc.removeEventListener("icecandidate",this.onIceCandidate),this.pc.removeEventListener("negotiationneeded",this.onNegotiationNeeded),this.pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this.pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.pc.removeEventListener("signalingstatechange",this.onSignalingStateChange)},this.publishStream=async function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("ended"===t.readyState)throw Error("Can't publish a track that has ended already.");let s=l.pc.getTransceivers().find(e=>{var t;return e===l.transceiverRegistry[i]&&e.sender.track&&(null===(t=e.sender.track)||void 0===t?void 0:t.kind)===l.trackKindMapping[i]}),a=()=>{l.logger("info","Track ".concat(D[i]," has ended abruptly, notifying the SFU")),t.removeEventListener("ended",a),l.notifyTrackMuteStateChanged(e,i,!0).catch(e=>l.logger("warn","Couldn't notify track mute state",e))};if(s){let e=s.sender.track;e&&e!==t&&(e.stop(),e.removeEventListener("ended",a),t.addEventListener("ended",a)),t.enabled||(t.enabled=!0),await s.sender.replaceTrack(t)}else{var r;let{settings:o}=l.state,c=null==o?void 0:o.video.target_resolution,d=null==o?void 0:null===(r=o.screensharing.target_resolution)||void 0===r?void 0:r.bitrate,{preferredBitrate:h,preferredCodec:u,screenShareSettings:p}=n,g=i===D.VIDEO?nP(t,c,h):i===D.SCREEN_SHARE?nA(t,p,d):void 0;t.addEventListener("ended",a),t.enabled||(t.enabled=!0),s=l.pc.addTransceiver(t,{direction:"sendonly",streams:i===D.VIDEO||i===D.SCREEN_SHARE?[e]:void 0,sendEncodings:g}),l.logger("debug","Added ".concat(D[i]," transceiver")),l.transceiverInitOrder.push(i),l.transceiverRegistry[i]=s,l.publishOptionsPerTrackType.set(i,n);let m=ni()&&i===D.VIDEO&&!u?nS():u,y="setCodecPreferences"in s?l.getCodecPreferences(i,m):void 0;if(y){l.logger("info","Setting ".concat(D[i]," codec preferences"),y);try{s.setCodecPreferences(y)}catch(e){l.logger("warn","Couldn't set codec preferences",e)}}}await l.notifyTrackMuteStateChanged(e,i,!1)},this.unpublishStream=async(e,t)=>{let i=this.pc.getTransceivers().find(t=>t===this.transceiverRegistry[e]&&t.sender.track);if(i&&i.sender.track&&(t?"live"===i.sender.track.readyState:i.sender.track.enabled)){var n;t?i.sender.track.stop():i.sender.track.enabled=!1,(null===(n=this.state.localParticipant)||void 0===n?void 0:n.publishedTracks.includes(e))&&await this.notifyTrackMuteStateChanged(void 0,e,!0)}},this.isPublishing=e=>{let t=this.transceiverRegistry[e];if(!t||!t.sender)return!1;let i=t.sender.track;return!!i&&"live"===i.readyState&&i.enabled},this.notifyTrackMuteStateChanged=async(e,t,i)=>{await this.sfuClient.updateMuteState(t,i);let n=nB(t);n&&(i?this.state.updateParticipant(this.sfuClient.sessionId,e=>({publishedTracks:e.publishedTracks.filter(e=>e!==t),[n]:void 0})):this.state.updateParticipant(this.sfuClient.sessionId,i=>({publishedTracks:i.publishedTracks.includes(t)?i.publishedTracks:[...i.publishedTracks,t],[n]:e})))},this.stopPublishing=()=>{this.logger("debug","Stopping publishing all tracks"),this.pc.getSenders().forEach(e=>{var t;null===(t=e.track)||void 0===t||t.stop(),"closed"!==this.pc.signalingState&&this.pc.removeTrack(e)})},this.updateVideoPublishQuality=async e=>{var t;this.logger("info","Update publish quality, requested layers by SFU:",e);let i=null===(t=this.transceiverRegistry[D.VIDEO])||void 0===t?void 0:t.sender;if(!i){this.logger("warn","Update publish quality, no video sender found.");return}let n=i.getParameters();if(0===n.encodings.length){this.logger("warn","Update publish quality, No suitable video encoding quality found");return}let s=!1,a=e.filter(e=>e.active).map(e=>e.name);n.encodings.forEach(t=>{let i=a.includes(t.rid);if(i!==t.active&&(t.active=i,s=!0),i){let i=e.find(e=>e.name===t.rid);void 0!==i&&(i.scaleResolutionDownBy>=1&&i.scaleResolutionDownBy!==t.scaleResolutionDownBy&&(this.logger("debug","[dynascale]: setting scaleResolutionDownBy from server","layer",i.name,"scale-resolution-down-by",i.scaleResolutionDownBy),t.scaleResolutionDownBy=i.scaleResolutionDownBy,s=!0),i.maxBitrate>0&&i.maxBitrate!==t.maxBitrate&&(this.logger("debug","[dynascale] setting max-bitrate from the server","layer",i.name,"max-bitrate",i.maxBitrate),t.maxBitrate=i.maxBitrate,s=!0),i.maxFramerate>0&&i.maxFramerate!==t.maxFramerate&&(this.logger("debug","[dynascale]: setting maxFramerate from server","layer",i.name,"max-framerate",i.maxFramerate),t.maxFramerate=i.maxFramerate,s=!0))}});let r=n.encodings.filter(e=>e.active);s?(await i.setParameters(n),this.logger("info","Update publish quality, enabled rids: ",r)):this.logger("info","Update publish quality, no change: ",r)},this.getStats=e=>this.pc.getStats(e),this.getCodecPreferences=(e,t)=>{if(e===D.VIDEO)return nw("video",t||"vp8");if(e===D.AUDIO){let e=this.isRedEnabled?"red":"opus";return nw("audio",null!=t?t:e,this.isRedEnabled?void 0:"red")}},this.onIceCandidate=e=>{let{candidate:t}=e;if(!t){this.logger("debug","null ice candidate");return}this.sfuClient.iceTrickle({iceCandidate:nD(t),peerType:E.PUBLISHER_UNSPECIFIED}).catch(e=>{this.logger("warn","ICETrickle failed",e)})},this.setSfuClient=e=>{this.sfuClient=e},this.restartIce=async()=>{this.logger("debug","Restarting ICE connection");let e=this.pc.signalingState;if(this.isIceRestarting||"have-local-offer"===e){this.logger("debug","ICE restart is already in progress");return}await this.negotiate({iceRestart:!0})},this.onNegotiationNeeded=()=>{this.negotiate().catch(e=>{var t;this.logger("error","Negotiation failed.",e),null===(t=this.onUnrecoverableError)||void 0===t||t.call(this)})},this.negotiate=async e=>{var t;let i=await this.pc.createOffer(e),n=this.mungeCodecs(i.sdp);n&&this.isPublishing(D.SCREEN_SHARE_AUDIO)&&(n=this.enableHighQualityAudio(n)),i.sdp=n;let s=this.getAnnouncedTracks(i.sdp);if(0===s.length)throw Error("Can't negotiate without announcing any tracks");this.isIceRestarting=null!==(t=null==e?void 0:e.iceRestart)&&void 0!==t&&t,await this.pc.setLocalDescription(i);try{let{response:e}=await this.sfuClient.setPublisher({sdp:i.sdp||"",tracks:s});if(e.error)throw Error(e.error.message);await this.pc.setRemoteDescription({type:"answer",sdp:e.sdp})}finally{this.isIceRestarting=!1}this.sfuClient.iceTrickleBuffer.publisherCandidates.subscribe(async e=>{try{let t=JSON.parse(e.iceCandidate);await this.pc.addIceCandidate(t)}catch(t){this.logger("warn","ICE candidate error",t,e)}})},this.enableHighQualityAudio=e=>{let t=this.transceiverRegistry[D.SCREEN_SHARE_AUDIO];if(!t)return e;let i=this.extractMid(t,e,D.SCREEN_SHARE_AUDIO);return sb(e,i)},this.mungeCodecs=e=>(e&&(e=sf(e,this.isDtxEnabled)),e),this.extractMid=(e,t,i)=>{if(e.mid)return e.mid;if(!t)return this.logger("warn","No SDP found. Returning empty mid"),"";this.logger("debug","No 'mid' found for track. Trying to find it from the Offer SDP");let n=e.sender.track,s=eb.Qc(t).media.find(e=>{var t,i;return e.type===n.kind&&(null===(i=null===(t=e.msid)||void 0===t?void 0:t.includes(n.id))||void 0===i||i)});if(void 0===(null==s?void 0:s.mid)){this.logger("debug","No mid found in SDP for track type ".concat(n.kind," and id ").concat(n.id,". Attempting to find it heuristically"));let e=this.transceiverInitOrder.indexOf(i);return -1!==e?String(e):(this.logger("debug","No heuristic mid found. Returning empty mid"),"")}return String(s.mid)},this.getAnnouncedTracks=e=>{var t;e=e||(null===(t=this.pc.localDescription)||void 0===t?void 0:t.sdp);let{settings:i}=this.state,n=null==i?void 0:i.video.target_resolution;return this.pc.getTransceivers().filter(e=>"sendonly"===e.direction&&e.sender.track).map(t=>{let i;let s=Number(Object.keys(this.transceiverRegistry).find(e=>this.transceiverRegistry[e]===t)),a=t.sender.track,r="live"===a.readyState;if(r){let e=this.publishOptionsPerTrackType.get(s);i=s===D.VIDEO?nP(a,n,null==e?void 0:e.preferredBitrate):s===D.SCREEN_SHARE?nA(a,null==e?void 0:e.screenShareSettings):[],this.trackLayersCache[s]=i}else i=this.trackLayersCache[s]||[],this.logger("debug","Track ".concat(D[s]," is ended. Announcing last known optimal layers"),i);let o=i.map(e=>({rid:e.rid||"",bitrate:e.maxBitrate||0,fps:e.maxFramerate||0,quality:this.ridToVideoQuality(e.rid||""),videoDimension:{width:e.width,height:e.height}})),l=[D.AUDIO,D.SCREEN_SHARE_AUDIO].includes(s),c=a.getSettings(),d=l&&2===c.channelCount;return{trackId:a.id,layers:o,trackType:s,mid:this.extractMid(t,e,s),stereo:d,dtx:l&&this.isDtxEnabled,red:l&&this.isRedEnabled,muted:!r}})},this.onIceCandidateError=e=>{let t=e instanceof RTCPeerConnectionIceErrorEvent&&"".concat(e.errorCode,": ").concat(e.errorText),i=this.pc.iceConnectionState;this.logger("connected"===i||"checking"===i?"debug":"warn","ICE Candidate error",t)},this.onIceConnectionStateChange=()=>{let e=this.pc.iceConnectionState;this.logger("debug","ICE Connection state changed to",e),this.state.callingState!==F.RECONNECTING&&("failed"===e||"disconnected"===e)&&(this.logger("debug","Attempting to restart ICE"),this.restartIce().catch(e=>{var t;this.logger("error","ICE restart error",e),null===(t=this.onUnrecoverableError)||void 0===t||t.call(this)}))},this.onIceGatheringStateChange=()=>{this.logger("debug","ICE Gathering State",this.pc.iceGatheringState)},this.onSignalingStateChange=()=>{this.logger("debug","Signaling state changed",this.pc.signalingState)},this.ridToVideoQuality=e=>"q"===e?I.LOW_UNSPECIFIED:"h"===e?I.MID:I.HIGH,this.logger=nc(["Publisher",o]),this.pc=this.createPeerConnection(e),this.sfuClient=t,this.state=n,this.isDtxEnabled=s,this.isRedEnabled=a,this.onUnrecoverableError=r,this.unsubscribeOnIceRestart=i.on("iceRestart",e=>{e.peerType===E.PUBLISHER_UNSPECIFIED&&this.restartIce().catch(e=>{var t;this.logger("warn","ICERestart failed",e),null===(t=this.onUnrecoverableError)||void 0===t||t.call(this)})})}}class sk{constructor({sfuClient:e,dispatcher:t,state:i,connectionConfig:n,onUnrecoverableError:s,logTag:a}){this.isIceRestarting=!1,this.createPeerConnection=e=>{let t=new RTCPeerConnection(e);return t.addEventListener("icecandidate",this.onIceCandidate),t.addEventListener("track",this.handleOnTrack),t.addEventListener("icecandidateerror",this.onIceCandidateError),t.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),t.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),t},this.close=()=>{this.detachEventHandlers(),this.pc.close()},this.detachEventHandlers=()=>{this.unregisterOnSubscriberOffer(),this.unregisterOnIceRestart(),this.pc.removeEventListener("icecandidate",this.onIceCandidate),this.pc.removeEventListener("track",this.handleOnTrack),this.pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this.pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange)},this.getStats=e=>this.pc.getStats(e),this.setSfuClient=e=>{this.sfuClient=e},this.restartIce=async()=>{if(this.logger("debug","Restarting ICE connection"),"have-remote-offer"===this.pc.signalingState){this.logger("debug","ICE restart is already in progress");return}if("new"===this.pc.connectionState){this.logger("debug","ICE connection is not yet established, skipping restart.");return}let e=this.isIceRestarting;try{this.isIceRestarting=!0,await this.sfuClient.iceRestart({peerType:E.SUBSCRIBER})}catch(t){throw this.isIceRestarting=e,t}},this.handleOnTrack=e=>{let[t]=e.streams,[i,n]=t.id.split(":"),s=this.state.participants.find(e=>e.trackLookupPrefix===i);this.logger("debug","[onTrack]: Got remote ".concat(n," track for userId: ").concat(null==s?void 0:s.userId),e.track.id,e.track);let a="".concat(null==s?void 0:s.userId," ").concat(n,":").concat(i);e.track.addEventListener("mute",()=>{this.logger("info","[onTrack]: Track muted: ".concat(a))}),e.track.addEventListener("unmute",()=>{this.logger("info","[onTrack]: Track unmuted: ".concat(a))}),e.track.addEventListener("ended",()=>{this.logger("info","[onTrack]: Track ended: ".concat(a)),this.state.removeOrphanedTrack(t.id)});let r=nF(n);if(!r)return this.logger("error","Unknown track type: ".concat(n));if(!s){this.logger("warn","[onTrack]: Received track for unknown participant: ".concat(i),e),this.state.registerOrphanedTrack({id:t.id,trackLookupPrefix:i,track:t,trackType:r});return}let o=nB(r);if(!o){this.logger("error","Unknown track type: ".concat(n));return}let l=s[o];l&&(this.logger("info","[onTrack]: Cleaning up previous remote ".concat(e.track.kind," tracks for userId: ").concat(s.userId)),l.getTracks().forEach(e=>{e.stop(),l.removeTrack(e)})),this.state.updateParticipant(s.sessionId,{[o]:t})},this.onIceCandidate=e=>{let{candidate:t}=e;if(!t){this.logger("debug","null ice candidate");return}this.sfuClient.iceTrickle({iceCandidate:nD(t),peerType:E.SUBSCRIBER}).catch(e=>{this.logger("warn","ICETrickle failed",e)})},this.negotiate=async e=>{this.logger("info","Received subscriberOffer",e),await this.pc.setRemoteDescription({type:"offer",sdp:e.sdp}),this.sfuClient.iceTrickleBuffer.subscriberCandidates.subscribe(async e=>{try{let t=JSON.parse(e.iceCandidate);await this.pc.addIceCandidate(t)}catch(t){this.logger("warn","ICE candidate error",[t,e])}});let t=await this.pc.createAnswer();await this.pc.setLocalDescription(t),await this.sfuClient.sendAnswer({peerType:E.SUBSCRIBER,sdp:t.sdp||""}),this.isIceRestarting=!1},this.onIceConnectionStateChange=()=>{let e=this.pc.iceConnectionState;this.logger("debug","ICE connection state changed",e),this.state.callingState!==F.RECONNECTING&&(this.isIceRestarting||"failed"!==e&&"disconnected"!==e||(this.logger("debug","Attempting to restart ICE"),this.restartIce().catch(e=>{var t;this.logger("error","ICE restart failed",e),null===(t=this.onUnrecoverableError)||void 0===t||t.call(this)})))},this.onIceGatheringStateChange=()=>{this.logger("debug","ICE gathering state changed",this.pc.iceGatheringState)},this.onIceCandidateError=e=>{let t=e instanceof RTCPeerConnectionIceErrorEvent&&"".concat(e.errorCode,": ").concat(e.errorText),i=this.pc.iceConnectionState;this.logger("connected"===i||"checking"===i?"debug":"warn","ICE Candidate error",t)},this.logger=nc(["Subscriber",a]),this.sfuClient=e,this.state=i,this.onUnrecoverableError=s,this.pc=this.createPeerConnection(n);let r=Symbol("subscriberOffer");this.unregisterOnSubscriberOffer=t.on("subscriberOffer",e=>{nW(r,()=>this.negotiate(e)).catch(e=>{this.logger("error","Negotiation failed.",e)})});let o=Symbol("iceRestart");this.unregisterOnIceRestart=t.on("iceRestart",e=>{nW(o,async()=>{e.peerType===E.SUBSCRIBER&&await this.restartIce()}).catch(e=>{var t;this.logger("error","ICERestart failed",e),null===(t=this.onUnrecoverableError)||void 0===t||t.call(this)})})}}let sw=e=>{let{endpoint:t,onMessage:i,logTag:n}=e,s=nc(["SfuClientWS",n]),a=new WebSocket(t);return a.binaryType="arraybuffer",a.addEventListener("error",e=>{s("error","Signaling WS channel error",e)}),a.addEventListener("close",e=>{s("info","Signaling WS channel is closed",e)}),a.addEventListener("open",e=>{s("info","Signaling WS channel is open",e)}),a.addEventListener("message",e=>{try{let t=e.data instanceof ArrayBuffer?tK.fromBinary(new Uint8Array(e.data)):tK.fromJsonString(e.data.toString());i(t)}catch(t){s("error","Failed to decode a message. Check whether the Proto models match.",{event:e,error:t})}}),a},sT=()=>{let e,t;let i=new Promise((i,n)=>{e=i,t=n}),n=!1,s=!1;return{promise:i,resolve:t=>{e(t)},reject:e=>{t(e)},isResolved:!1,isRejected:!1}};class sS{get isHealthy(){return this.signalWs.readyState===WebSocket.OPEN}get joinTask(){return this.joinResponseTask.promise}constructor({dispatcher:e,credentials:t,sessionId:i,logTag:n,joinResponseTimeout:s=5e3,onSignalClose:a}){var r=this;this.iceTrickleBuffer=new nI,this.isLeaving=!1,this.pingIntervalInMs=1e4,this.unhealthyTimeoutInMs=this.pingIntervalInMs+5e3,this.restoreWebSocketConcurrencyTag=Symbol("recoverWebSocket"),this.joinResponseTask=sT(),this.abortController=new AbortController,this.createWebSocket=()=>{this.signalWs=sw({logTag:this.logTag,endpoint:"".concat(this.credentials.server.ws_endpoint,"?tag=").concat(this.logTag),onMessage:e=>{this.lastMessageTimestamp=new Date,this.scheduleConnectionCheck(),this.dispatcher.dispatch(e,this.logTag)}}),this.signalWs.addEventListener("close",this.handleWebSocketClose),this.signalWs.addEventListener("error",this.restoreWebSocket),this.signalReady=new Promise(e=>{let t=()=>{this.signalWs.removeEventListener("open",t),e(this.signalWs)};this.signalWs.addEventListener("open",t)})},this.cleanUpWebSocket=()=>{this.signalWs.removeEventListener("error",this.restoreWebSocket),this.signalWs.removeEventListener("close",this.handleWebSocketClose)},this.restoreWebSocket=()=>{nW(this.restoreWebSocketConcurrencyTag,async()=>{this.logger("debug","Restoring SFU WS connection"),this.cleanUpWebSocket(),await i3(500),this.createWebSocket()}).catch(e=>this.logger("debug","Can't restore WS connection",e))},this.handleWebSocketClose=()=>{var e;this.signalWs.removeEventListener("close",this.handleWebSocketClose),clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),null===(e=this.onSignalClose)||void 0===e||e.call(this)},this.close=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sS.NORMAL_CLOSURE,t=arguments.length>1?arguments[1]:void 0;r.signalWs.readyState===WebSocket.OPEN&&(r.logger("debug","Closing SFU WS connection: ".concat(e," - ").concat(t)),r.signalWs.close(e,"js-client: ".concat(t)),r.cleanUpWebSocket()),r.dispose()},this.dispose=()=>{var e;this.logger("debug","Disposing SFU client"),this.unsubscribeIceTrickle(),clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),clearTimeout(this.migrateAwayTimeout),this.abortController.abort(),null===(e=this.migrationTask)||void 0===e||e.resolve()},this.leaveAndClose=async e=>{await this.joinTask;try{this.isLeaving=!0,await this.notifyLeave(e)}catch(e){this.logger("debug","Error notifying SFU about leaving call",e)}this.close(sS.NORMAL_CLOSURE,e.substring(0,115))},this.updateSubscriptions=async e=>(await this.joinTask,nd(()=>this.rpc.updateSubscriptions({sessionId:this.sessionId,tracks:e}),this.abortController.signal)),this.setPublisher=async e=>(await this.joinTask,nd(()=>this.rpc.setPublisher({...e,sessionId:this.sessionId}),this.abortController.signal)),this.sendAnswer=async e=>(await this.joinTask,nd(()=>this.rpc.sendAnswer({...e,sessionId:this.sessionId}),this.abortController.signal)),this.iceTrickle=async e=>(await this.joinTask,nd(()=>this.rpc.iceTrickle({...e,sessionId:this.sessionId}),this.abortController.signal)),this.iceRestart=async e=>(await this.joinTask,nd(()=>this.rpc.iceRestart({...e,sessionId:this.sessionId}),this.abortController.signal)),this.updateMuteState=async(e,t)=>(await this.joinTask,this.updateMuteStates({muteStates:[{trackType:e,muted:t}]})),this.updateMuteStates=async e=>(await this.joinTask,nd(()=>this.rpc.updateMuteStates({...e,sessionId:this.sessionId}),this.abortController.signal)),this.sendStats=async e=>(await this.joinTask,nd(()=>this.rpc.sendStats({...e,sessionId:this.sessionId}),this.abortController.signal)),this.startNoiseCancellation=async()=>(await this.joinTask,nd(()=>this.rpc.startNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.stopNoiseCancellation=async()=>(await this.joinTask,nd(()=>this.rpc.stopNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.enterMigration=async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.isLeaving=!0;let{timeout:i=7e3}=t;null===(e=r.migrationTask)||void 0===e||e.reject(Error("Cancelled previous migration"));let n=r.migrationTask=sT(),s=r.dispatcher.on("participantMigrationComplete",()=>{s(),clearTimeout(r.migrateAwayTimeout),n.resolve()});return r.migrateAwayTimeout=setTimeout(()=>{s(),n.reject(Error("Migration (".concat(r.logTag,") failed to complete in ").concat(i,"ms")))},i),n.promise},this.join=async e=>{let t;await this.signalReady,(this.joinResponseTask.isResolved||this.joinResponseTask.isRejected)&&(this.joinResponseTask=sT());let i=this.joinResponseTask,n=this.dispatcher.on("joinResponse",e=>{this.logger("debug","Received joinResponse",e),clearTimeout(t),n(),this.keepAlive(),i.resolve(e)});return t=setTimeout(()=>{n(),i.reject(Error('Waiting for "joinResponse" has timed out'))},this.joinResponseTimeout),await this.send(t3.create({requestPayload:{oneofKind:"joinRequest",joinRequest:ir.create({...e,sessionId:this.sessionId,token:this.credentials.token})}})),i.promise},this.ping=async()=>this.send(t3.create({requestPayload:{oneofKind:"healthCheckRequest",healthCheckRequest:{}}})),this.notifyLeave=async e=>this.send(t3.create({requestPayload:{oneofKind:"leaveCallRequest",leaveCallRequest:{sessionId:this.sessionId,reason:e}}})),this.send=async e=>{await this.signalReady;let t=t3.toJson(e);if(this.signalWs.readyState!==WebSocket.OPEN){this.logger("debug","Signal WS is not open. Skipping message",t);return}this.logger("debug","Sending message to: ".concat(this.edgeName),t),this.signalWs.send(t3.toBinary(e))},this.keepAlive=()=>{clearInterval(this.keepAliveInterval),this.keepAliveInterval=setInterval(()=>{this.ping().catch(e=>{this.logger("error","Error sending healthCheckRequest to SFU",e)})},this.pingIntervalInMs)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeout),this.connectionCheckTimeout=setTimeout(()=>{this.lastMessageTimestamp&&new Date().getTime()-this.lastMessageTimestamp.getTime()>this.unhealthyTimeoutInMs&&this.close(sS.ERROR_CONNECTION_UNHEALTHY,"SFU connection unhealthy. Didn't receive any message for ".concat(this.unhealthyTimeoutInMs,"ms"))},this.unhealthyTimeoutInMs)},this.dispatcher=e,this.sessionId=i||i8(),this.onSignalClose=a,this.credentials=t;let{server:o,token:l}=t;this.edgeName=o.edge_name,this.joinResponseTimeout=s,this.logTag=n,this.logger=nc(["SfuClient",n]),this.rpc=i2({baseUrl:o.url,interceptors:[i0({Authorization:"Bearer ".concat(l)}),"trace"===nl()&&i1(this.logger,"trace")].filter(e=>!!e)}),this.unsubscribeIceTrickle=e.on("iceTrickle",e=>{this.iceTrickleBuffer.push(e)}),this.createWebSocket()}}sS.NORMAL_CLOSURE=1e3,sS.ERROR_CONNECTION_UNHEALTHY=4001,sS.DISPOSE_OLD_SOCKET=4002;let sC=e=>({iceServers:e.map(e=>({urls:e.urls,username:e.username,credential:e.password}))}),sE=e=>async function(t){if(t.user.id===e.currentUserId)return;let{state:i}=e;t.call.created_by.id===e.currentUserId&&i.callingState===F.RINGING&&await e.join()},sR=e=>async function(t){if(t.user.id===e.currentUserId)return;let{call:i}=t,{session:n}=i;if(!n){e.logger("warn","No call session provided. Ignoring call.rejected event.",t);return}let s=n.rejected_by,{members:a,callingState:r}=e.state;if(r!==F.RINGING){e.logger("info","Call is not in ringing mode (it is either accepted or rejected already). Ignoring call.rejected event.",t);return}e.isCreatedByMe?a.filter(t=>t.user_id!==e.currentUserId).every(e=>s[e.user_id])&&(e.logger("info","everyone rejected, leaving the call"),await e.leave({reason:"ring: everyone rejected"})):s[i.created_by.id]&&(e.logger("info","call creator rejected, leaving call"),await e.leave({reason:"ring: creator rejected"}))},sI=e=>function(){let{callingState:t}=e.state;(t===F.RINGING||t===F.JOINED||t===F.JOINING)&&e.leave({reason:"call.ended event received"}).catch(t=>{e.logger("error","Failed to leave call after call.ended ",t)})},sD=e=>e.on("callEnded",async t=>{if(e.state.callingState!==F.LEFT)try{e.state.setEndedAt(new Date);let i=O[t.reason];await e.leave({reason:"callEnded received: ".concat(i)})}catch(t){e.logger("error","Failed to leave call after being ended by the SFU",t)}}),s_=e=>function(t){let{currentGrants:i}=t;if(i){let{canPublishAudio:t,canPublishVideo:n,canScreenshare:s}=i,a={[eS.SEND_AUDIO]:t,[eS.SEND_VIDEO]:n,[eS.SCREENSHARE]:s},r=e.ownCapabilities.filter(e=>!1!==a[e]);Object.entries(a).forEach(e=>{let[t,i]=e;i&&!r.includes(t)&&r.push(t)}),e.setOwnCapabilities(r)}},sN=(e,t)=>e.on("changePublishQuality",e=>{let{videoSenders:i}=e;i.forEach(e=>{let{layers:i}=e;t.updatePublishQuality(i.filter(e=>e.active))})}),sP=(e,t)=>e.on("connectionQualityChanged",e=>{let{connectionQualityUpdates:i}=e;i&&t.updateParticipants(i.reduce((e,t)=>{let{sessionId:i,connectionQuality:n}=t;return e[i]={connectionQuality:n},e},{}))}),sU=(e,t)=>e.on("healthCheckResponse",e=>{let{participantCount:i}=e;i&&(t.setParticipantCount(i.total),t.setAnonymousParticipantCount(i.anonymous))}),sO=(e,t)=>e.on("error",e=>{e.error&&e.error.code!==_.LIVE_ENDED||t.permissionsContext.hasPermission(eS.JOIN_BACKSTAGE)||t.leave({reason:"live ended"}).catch(e=>{t.logger("error","Failed to leave call after live ended",e)})}),sA=e=>e.on("error",e=>{if(!e.error)return;let t=nc(["SfuClient"]),{error:i,reconnectStrategy:n}=e;t("error","SFU reported error",{code:_[i.code],reconnectStrategy:A[n],message:i.message,shouldRetry:i.shouldRetry})}),sL=e=>function(t){let{pins:i}=t;e.setServerSidePins(i)},sB=e=>e.on("trackUnpublished",async t=>{let{cause:i,type:n,sessionId:s}=t,{localParticipant:a}=e.state;if(i===P.MODERATION&&s===(null==a?void 0:a.sessionId)){let t=e.logger;t("info","Local participant's ".concat(D[n]," track is muted remotely"));try{n===D.VIDEO?await e.camera.disable():n===D.AUDIO?await e.microphone.disable():n===D.SCREEN_SHARE||n===D.SCREEN_SHARE_AUDIO?await e.screenShare.disable():t("warn","Unsupported track type to soft mute",D[n])}catch(e){t("error","Failed to stop publishing",e)}}}),sj=e=>function(t){let{participant:i}=t;if(!i)return;let n=sH(e,i);e.updateOrAddParticipant(i.sessionId,Object.assign(i,n,{viewportVisibilityState:{videoTrack:B.UNKNOWN,screenShareTrack:B.UNKNOWN}}))},sF=e=>function(t){let{participant:i}=t;i&&e.setParticipants(e=>e.filter(e=>e.sessionId!==i.sessionId))},sW=e=>function(t){let{participant:i}=t;i&&e.updateParticipant(i.sessionId,i)},sV=e=>function(t){let{type:i,sessionId:n}=t;if(t.participant){let i=sH(e,t.participant),s=Object.assign(t.participant,i);e.updateOrAddParticipant(n,s)}else e.updateParticipant(n,e=>({publishedTracks:[...e.publishedTracks,i].filter(sx)}))},sM=e=>function(t){let{type:i,sessionId:n}=t;if(t.participant){let i=sH(e,t.participant),s=Object.assign(t.participant,i);e.updateOrAddParticipant(n,s)}else e.updateParticipant(n,e=>({publishedTracks:e.publishedTracks.filter(e=>e!==i)}))},sx=(e,t,i)=>i.indexOf(e)===t,sH=(e,t)=>{let i=e.takeOrphanedTracks(t.trackLookupPrefix);if(!i.length)return;let n={};for(let e of i){let t=nB(e.trackType);t&&(n[t]=e.track)}return n},sz=(e,t)=>e.on("dominantSpeakerChanged",e=>{var i;let{sessionId:n}=e;n!==(null===(i=t.dominantSpeaker)||void 0===i?void 0:i.sessionId)&&t.setParticipants(e=>e.map(e=>e.sessionId===n?{...e,isDominantSpeaker:!0}:e.isDominantSpeaker?{...e,isDominantSpeaker:!1}:e))}),sq=(e,t)=>e.on("audioLevelChanged",e=>{let{audioLevels:i}=e;t.updateParticipants(i.reduce((e,t)=>(e[t.sessionId]={audioLevel:t.level,isSpeaking:t.isSpeaking},e),{}))}),sK=(e,t)=>{let i=e.state,n=[e.on("call.ended",sI(e)),sD(e),sO(t,e),sA(t),sN(t,e),sP(t,i),sU(t,i),e.on("participantJoined",sj(i)),e.on("participantLeft",sF(i)),e.on("participantUpdated",sW(i)),e.on("trackPublished",sV(i)),e.on("trackUnpublished",sM(i)),sq(t,i),sz(t,i),e.on("callGrantsUpdated",s_(i)),e.on("pinsUpdated",sL(i)),sB(e)];return e.ringing&&n.push(sJ(e)),()=>{n.forEach(e=>e())}},sJ=e=>{let t={"call.accepted":sE(e),"call.rejected":sR(e)},i=Object.keys(t).map(i=>e.on(i,t[i]));return()=>{i.forEach(e=>e())}},sG=e=>{let t=[];return e.forEach(e=>{t.push(e)}),t},s$=e=>{let{sdk:t,...i}=e;return{sdkName:sQ(t),sdkVersion:sX(t),...i}},sQ=e=>e&&e.type===N.REACT?"stream-react":e&&e.type===N.REACT_NATIVE?"stream-react-native":"stream-js",sX=e=>e?"".concat(e.major,".").concat(e.minor,".").concat(e.patch):"0.0.0-development",sY=e=>{let t,{subscriber:i,publisher:n,state:s,datacenter:a,pollingIntervalInMs:r=2e3}=e,o=nc(["stats"]),l=async(e,t)=>"subscriber"===e&&i?i.getStats(t):"publisher"===e&&n?n.getStats(t):void 0,c=async(e,t)=>{let s="subscriber"===e?i:n;if(!s)return[];let a=[];for(let i of t.getTracks()){let t=sZ(await s.getStats(i),{trackKind:i.kind,kind:e});a.push(t)}return a},d=new Set,h=async()=>{let e={},t=new Set(d);if(t.size>0)for(let i of s.participants){if(!t.has(i.sessionId))continue;let n=i.isLocalParticipant?"publisher":"subscriber";try{var r,h;let t=new MediaStream([...(null===(r=i.videoStream)||void 0===r?void 0:r.getVideoTracks())||[],...(null===(h=i.audioStream)||void 0===h?void 0:h.getAudioTracks())||[]]);e[i.sessionId]=await c(n,t),t.getTracks().forEach(e=>{t.removeTrack(e)})}catch(e){o("error","Failed to collect stats for ".concat(n," of ").concat(i.userId),e)}}let[u,p]=await Promise.all([i.getStats().then(e=>sZ(e,{kind:"subscriber",trackKind:"video"})).then(s1),n?n.getStats().then(e=>sZ(e,{kind:"publisher",trackKind:"video"})).then(s1):s0()]),[g,m]=await Promise.all([l("subscriber"),n?l("publisher"):void 0]);s.setCallStatsReport({datacenter:a,publisherStats:p,subscriberStats:u,subscriberRawStats:g,publisherRawStats:m,participants:e,timestamp:Date.now()})};if(r>0){let e=async()=>{await h().catch(e=>{o("debug","Failed to collect stats",e)}),t=setTimeout(e,r)};e()}return{getRawStatsForTrack:l,getStatsForStream:c,startReportingStatsFor:e=>{d.add(e),h()},stopReportingStatsFor:e=>{d.delete(e),h()},stop:()=>{t&&clearTimeout(t)}}},sZ=(e,t)=>{let{trackKind:i,kind:n}=t,s="subscriber"===n?"inbound-rtp":"outbound-rtp",a=sG(e);return{rawStats:e,streams:a.filter(e=>e.type===s&&e.kind===i).map(e=>{let t;let i=a.find(t=>"codec"===t.type&&t.id===e.codecId),n=a.find(t=>"transport"===t.type&&t.id===e.transportId);if(n&&"connected"===n.dtlsState){let e=a.find(e=>"candidate-pair"===e.type&&e.id===n.selectedCandidatePairId);t=null==e?void 0:e.currentRoundTripTime}return{bytesSent:e.bytesSent,bytesReceived:e.bytesReceived,codec:null==i?void 0:i.mimeType,currentRoundTripTime:t,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,jitter:e.jitter,kind:e.kind,qualityLimitationReason:e.qualityLimitationReason,rid:e.rid,ssrc:e.ssrc}}),timestamp:Date.now()}},s0=e=>({rawReport:null!=e?e:{streams:[],timestamp:Date.now()},totalBytesSent:0,totalBytesReceived:0,averageJitterInMs:0,averageRoundTripTimeInMs:0,qualityLimitationReasons:"none",highestFrameWidth:0,highestFrameHeight:0,highestFramesPerSecond:0,timestamp:Date.now()}),s1=e=>{let t=s0(e),i=-1,n=(e,t)=>e*t,s=new Set,a=e.streams,r=a.reduce((e,t)=>{e.totalBytesSent+=t.bytesSent||0,e.totalBytesReceived+=t.bytesReceived||0,e.averageJitterInMs+=t.jitter||0,e.averageRoundTripTimeInMs+=t.currentRoundTripTime||0;let a=n(t.frameWidth||0,t.frameHeight||0);return a>i&&(e.highestFrameWidth=t.frameWidth||0,e.highestFrameHeight=t.frameHeight||0,e.highestFramesPerSecond=t.framesPerSecond||0,i=a),s.add(t.qualityLimitationReason||""),e},t);a.length>0&&(r.averageJitterInMs=Math.round(r.averageJitterInMs/a.length*1e3),r.averageRoundTripTimeInMs=Math.round(r.averageRoundTripTimeInMs/a.length*1e3));let o=[s.has("cpu")&&"cpu",s.has("bandwidth")&&"bandwidth",s.has("other")&&"other"].filter(Boolean).join(", ");return o&&(r.qualityLimitationReasons=o),r};class s2{constructor(e,{options:t,clientDetails:i,subscriber:n,publisher:s}){this.logger=nc(["SfuStatsReporter"]),this.run=async()=>{var e,t;let[i,n]=await Promise.all([this.subscriber.getStats().then(sG).then(JSON.stringify),null!==(t=null===(e=this.publisher)||void 0===e?void 0:e.getStats().then(sG).then(JSON.stringify))&&void 0!==t?t:"[]"]);await this.sfuClient.sendStats({sdk:this.sdkName,sdkVersion:this.sdkVersion,webrtcVersion:this.webRTCVersion,subscriberStats:i,publisherStats:n})},this.start=()=>{this.options.reporting_interval_ms<=0||(clearInterval(this.intervalId),this.intervalId=setInterval(()=>{this.run().catch(e=>{this.logger("warn","Failed to report stats",e)})},this.options.reporting_interval_ms))},this.stop=()=>{clearInterval(this.intervalId),this.intervalId=void 0},this.sfuClient=e,this.options=t,this.subscriber=n,this.publisher=s;let a=nv(),{sdk:r,browser:o}=i;this.sdkName=sQ(r),this.sdkVersion=sX(r),this.webRTCVersion=(null==a?void 0:a.version)||"".concat((null==o?void 0:o.name)||"","-").concat((null==o?void 0:o.version)||"")||"N/A"}}class s3{constructor(){this.elementHandlerMap=new Map,this.observer=null,this.queueSet=new Set,this.setViewport=(e,t)=>{var i;return this.observer=new IntersectionObserver(e=>{e.forEach(e=>{let t=this.elementHandlerMap.get(e.target);null==t||t(e)})},{root:e,...t,threshold:null!==(i=null==t?void 0:t.threshold)&&void 0!==i?i:.35}),this.queueSet.size&&(this.queueSet.forEach(t=>{let[i,n]=t;e.contains(i)&&(this.observer.observe(i),this.elementHandlerMap.set(i,n))}),this.queueSet.clear()),()=>{var e;null===(e=this.observer)||void 0===e||e.disconnect(),this.observer=null,this.elementHandlerMap.clear()}},this.observe=(e,t)=>{let i=[e,t];return this.elementHandlerMap.has(e)||(this.observer?this.observer.root.contains(e)&&(this.elementHandlerMap.set(e,t),this.observer.observe(e)):this.queueSet.add(i)),()=>{var t;this.elementHandlerMap.delete(e),null===(t=this.observer)||void 0===t||t.unobserve(e),this.queueSet.delete(i)}}}}let s9=()=>"undefined"!=typeof navigator&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent||""),s4=()=>{var e;return"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Firefox"))};var s5=Object.freeze({__proto__:null,isChrome:()=>{var e;return"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Chrome"))},isFirefox:s4,isSafari:s9});let s6={videoTrack:B.UNKNOWN,screenShareTrack:B.UNKNOWN};class s8{constructor(e){this.viewportTracker=new s3,this.logger=nc(["DynascaleManager"]),this.trackElementVisibility=(e,t,i)=>{let n=this.viewportTracker.observe(e,n=>{this.call.state.updateParticipant(t,t=>{var s;let a=null!==(s=t.viewportVisibilityState)&&void 0!==s?s:s6,r=n.isIntersecting||document.fullscreenElement===e?B.VISIBLE:B.INVISIBLE;return{...t,viewportVisibilityState:{...a,[i]:r}}})});return()=>{n(),this.call.state.updateParticipant(t,e=>{var t;let n=null!==(t=e.viewportVisibilityState)&&void 0!==t?t:s6;return{...e,viewportVisibilityState:{...n,[i]:B.UNKNOWN}}})}},this.setViewport=e=>this.viewportTracker.setViewport(e),this.bindVideoElement=(e,t,i)=>{let n,s;let a=this.call.state.findParticipantBySessionId(t);if(!a)return;let r=(e,n)=>{n&&(0===n.width||0===n.height)&&(this.logger("debug","Ignoring 0x0 dimension",a),n=void 0),this.call.updateSubscriptionsPartial(i,{[t]:{dimension:n}},e)},o=this.call.state.participants$.pipe((0,ei.U)(e=>e.find(e=>e.sessionId===t)),(0,ea.o)(e=>!!e),(0,es.x)(),(0,en.d)({bufferSize:1,refCount:!0})),l=a.isLocalParticipant?null:o.pipe((0,ei.U)(e=>{var t;return null===(t=e.viewportVisibilityState)||void 0===t?void 0:t[i]}),(0,es.x)()).subscribe(t=>{if(!n){n=null!=t?t:B.UNKNOWN;return}if(n=null!=t?t:B.UNKNOWN,t===B.INVISIBLE)return r(j.MEDIUM,void 0);r(j.MEDIUM,{width:e.clientWidth,height:e.clientHeight})}),c=a.isLocalParticipant?null:new ResizeObserver(()=>{let t="".concat(e.clientWidth,",").concat(e.clientHeight);if(!s){s=t;return}s!==t&&n!==B.INVISIBLE&&(r(j.SLOW,{width:e.clientWidth,height:e.clientHeight}),s=t)});null==c||c.observe(e);let d=a.isLocalParticipant?null:o.pipe((0,er.g)("publishedTracks"),(0,ei.U)(e=>"videoTrack"===i?n0(e):n2(e)),(0,es.x)()).subscribe(t=>{t?r(j.FAST,{width:e.clientWidth,height:e.clientHeight}):r(j.FAST,void 0)});e.autoplay=!0,e.playsInline=!0,e.muted=!0;let h=o.pipe((0,er.g)("videoTrack"===i?"videoStream":"screenShareStream")).subscribe(t=>{let n="videoTrack"===i?t.videoStream:t.screenShareStream;e.srcObject!==n&&(e.srcObject=null!=n?n:null,(s9()||s4())&&setTimeout(()=>{e.srcObject=null!=n?n:null,e.play().catch(e=>{this.logger("warn","Failed to play stream",e)})},25))});return()=>{r(j.FAST,void 0),null==l||l.unsubscribe(),null==d||d.unsubscribe(),h.unsubscribe(),null==c||c.disconnect()}},this.bindAudioElement=(e,t,i)=>{let n=this.call.state.findParticipantBySessionId(t);if(!n||n.isLocalParticipant)return;let s=this.call.state.participants$.pipe((0,ei.U)(e=>e.find(e=>e.sessionId===t)),(0,ea.o)(e=>!!e),(0,es.x)(),(0,en.d)({bufferSize:1,refCount:!0})),a=s.pipe((0,er.g)("screenShareAudioTrack"===i?"screenShareAudioStream":"audioStream")).subscribe(t=>{let n="screenShareAudioTrack"===i?t.screenShareAudioStream:t.audioStream;e.srcObject!==n&&setTimeout(()=>{if(e.srcObject=null!=n?n:null,e.srcObject){e.play().catch(e=>{this.logger("warn","Failed to play stream",e)});let{selectedDevice:t}=this.call.speaker.state;t&&"setSinkId"in e&&e.setSinkId(t)}})}),r="setSinkId"in e?this.call.speaker.state.selectedDevice$.subscribe(t=>{t&&e.setSinkId(t)}):null,o=(0,ee.a)([this.call.speaker.state.volume$,s.pipe((0,er.g)("audioVolume"))]).subscribe(t=>{var i;let[n,s]=t;e.volume=null!==(i=s.audioVolume)&&void 0!==i?i:n});return e.autoplay=!0,()=>{null==r||r.unsubscribe(),o.unsubscribe(),a.unsubscribe()}},this.call=e}}class s7{constructor(){var e=this;this.permissions=[],this.setPermissions=e=>{this.permissions=e||[]},this.setCallSettings=e=>{this.settings=e},this.hasPermission=e=>this.permissions.includes(e),this.canRequest=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.settings;if(!i)return!1;let{audio:n,video:s,screensharing:a}=i;switch(t){case eS.SEND_AUDIO:return n.access_request_enabled;case eS.SEND_VIDEO:return s.access_request_enabled;case eS.SCREENSHARE:return a.access_request_enabled;default:return!1}}}}class ae{constructor(e,t={sortParticipantsBy:sr}){this.name=e,this.options=t}}class at{constructor(e){this.register=e=>{this.callTypes[e.name]=e},this.unregister=e=>{delete this.callTypes[e]},this.get=e=>(this.callTypes[e]||this.register(new ae(e)),this.callTypes[e]),this.callTypes=e.reduce((e,t)=>(e[t.name]=t,e),{})}}let ai=new at([new ae("default",{sortParticipantsBy:sr}),new ae("development",{sortParticipantsBy:sr}),new ae("livestream",{sortParticipantsBy:sc}),new ae("audio_room",{sortParticipantsBy:sc})]);class an{dispose(){this.state=void 0,this.disposeController.abort()}async getState(){if(await this.ready,!this.state)throw Error("BrowserPermission instance possibly disposed");return this.state}async prompt(){let{forcePrompt:e=!1,throwOnNotAllowed:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await nW("permission-prompt-".concat(this.permission.queryName),async()=>{if(await this.getState()!=="prompt"||this.wasPrompted&&!e){let e="granted"===this.state;if(!e&&t)throw new DOMException("Permission was not granted previously, and prompting again is not allowed","NotAllowedError");return e}try{this.wasPrompted=!0;let e=await navigator.mediaDevices.getUserMedia(this.permission.constraints);return aw(e),!0}catch(e){if(e instanceof DOMException&&"NotAllowedError"===e.name){if(this.logger("info","Browser permission was not granted",{permission:this.permission}),t)throw e;return!1}throw this.logger("error","Failed to getUserMedia",{error:e,permission:this.permission}),e}})}listen(e){return this.listeners.add(e),this.state&&e(this.state),()=>this.listeners.delete(e)}asObservable(){return(0,eo.R)(e=>this.listen(e),(e,t)=>t()).pipe((0,ei.U)(e=>"denied"!==e))}setState(e){this.state!==e&&(this.state=e,this.listeners.forEach(t=>t(e)))}constructor(e){this.permission=e,this.disposeController=new AbortController,this.wasPrompted=!1,this.listeners=new Set,this.logger=nc(["permissions"]);let t=this.disposeController.signal;this.ready=(async()=>{var i;let n=e=>{this.setState("granted")};if(!(!ni()&&"undefined"!=typeof navigator&&(null===(i=navigator.permissions)||void 0===i?void 0:i.query)))return n();try{let i=await navigator.permissions.query({name:e.queryName});t.aborted||(this.setState(i.state),i.addEventListener("change",()=>this.setState(i.state),{signal:t}))}catch(e){n()}})()}}let as=Symbol("uninitialized");function aa(e){let t=as;return()=>(t===as&&(t=e()),t)}let ar=(e,t)=>(0,el.D)((async()=>{let i=await navigator.mediaDevices.enumerateDevices();return i.some(e=>e.kind===t&&""===e.label)&&(await e.prompt({throwOnNotAllowed:!0}),i=await navigator.mediaDevices.enumerateDevices()),i.filter(e=>e.kind===t)})()),ao=()=>"undefined"!=typeof document&&"setSinkId"in document.createElement("audio"),al={audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0}},ac={video:{width:1280,height:720}},ad=aa(()=>new an({constraints:al,queryName:"microphone"})),ah=aa(()=>new an({constraints:ac,queryName:"camera"})),au=aa(()=>navigator.mediaDevices.addEventListener?(0,ec.R)(navigator.mediaDevices,"devicechange").pipe((0,ei.U)(()=>void 0),(0,ed.b)(500)):(0,el.D)([])),ap=aa(()=>(0,eh.T)(au(),ad().asObservable()).pipe((0,eu.O)(void 0),(0,ep.b)(()=>ar(ad(),"audioinput")),(0,en.d)(1))),ag=()=>(0,eh.T)(au(),ah().asObservable()).pipe((0,eu.O)(void 0),(0,ep.b)(()=>ar(ah(),"videoinput")),(0,en.d)(1)),am=()=>(0,eh.T)(au(),ad().asObservable()).pipe((0,eu.O)(void 0),(0,ep.b)(()=>ar(ad(),"audiooutput")),(0,en.d)(1)),ay=async e=>await navigator.mediaDevices.getUserMedia(e),af=async e=>{let t={audio:{...al.audio,...e}};try{return await ad().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),ay(t)}catch(e){throw nc(["devices"])("error","Failed to get audio stream",{error:e,constraints:t}),e}},ab=async e=>{let t={video:{...ac.video,...e}};try{return await ah().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),ay(t)}catch(e){throw nc(["devices"])("error","Failed to get video stream",{error:e,constraints:t}),e}},av=async e=>{try{return await navigator.mediaDevices.getDisplayMedia({video:!0,audio:{channelCount:{ideal:2},echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},systemAudio:"include",...e})}catch(e){throw nc(["devices"])("error","Failed to get screen share stream",e),e}},ak="undefined"!=typeof navigator&&void 0!==navigator.mediaDevices?au().pipe((0,eu.O)(void 0),(0,ep.b)(()=>navigator.mediaDevices.enumerateDevices()),(0,en.d)(1)):void 0,aw=e=>{e.active&&(e.getTracks().forEach(t=>{t.stop(),e.removeTrack(t)}),"function"==typeof e.release&&e.release())};class aT{listDevices(){return this.getDevices()}get enabled(){return"enabled"===this.state.status}async enable(){"enabled"!==this.state.optimisticStatus&&(this.state.setPendingStatus("enabled"),await nV(this.statusChangeConcurrencyTag,async e=>{try{await this.unmuteStream(),this.state.setStatus("enabled")}finally{e.aborted||this.state.setPendingStatus(this.state.status)}}))}async disable(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state.prevStatus=this.state.status,(e||"disabled"!==this.state.optimisticStatus)&&(this.state.setPendingStatus("disabled"),await nV(this.statusChangeConcurrencyTag,async t=>{try{let t=e||"stop-tracks"===this.state.disableMode;await this.muteStream(t),this.state.setStatus("disabled")}finally{t.aborted||this.state.setPendingStatus(this.state.status)}}))}async statusChangeSettled(){await nx(this.statusChangeConcurrencyTag)}async resume(){"enabled"===this.state.prevStatus&&"disabled"===this.state.status&&await this.enable()}async toggle(){return"enabled"===this.state.optimisticStatus?await this.disable():await this.enable()}registerFilter(e){let t={start:e,stop:void 0};return{registered:nW(this.filterRegistrationConcurrencyTag,async()=>{this.filters.push(t),await this.applySettingsToStream()}),unregister:()=>nW(this.filterRegistrationConcurrencyTag,async()=>{var e;null===(e=t.stop)||void 0===e||e.call(t),this.filters=this.filters.filter(e=>e!==t),await this.applySettingsToStream()})}}setDefaultConstraints(e){this.state.setDefaultConstraints(e)}async select(e){if(ni())throw Error("This method is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for reference.");e!==this.state.selectedDevice&&(this.state.setDevice(e),await this.applySettingsToStream())}async applySettingsToStream(){this.enabled&&(await this.muteStream(),await this.unmuteStream())}getTracks(){var e,t;return null!==(t=null===(e=this.state.mediaStream)||void 0===e?void 0:e.getTracks())&&void 0!==t?t:[]}async muteStream(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.state.mediaStream&&(this.logger("debug","".concat(e?"Stopping":"Disabling"," stream")),this.call.state.callingState===F.JOINED&&await this.stopPublishStream(e),this.muteLocalStream(e),this.getTracks().every(e=>"ended"===e.readyState)&&(this.state.mediaStream&&"function"==typeof this.state.mediaStream.release&&this.state.mediaStream.release(),this.state.setMediaStream(void 0,void 0),this.filters.forEach(e=>{var t;return null===(t=e.stop)||void 0===t?void 0:t.call(e)})))}muteTracks(){this.getTracks().forEach(e=>{e.enabled&&(e.enabled=!1)})}unmuteTracks(){this.getTracks().forEach(e=>{e.enabled||(e.enabled=!0)})}stopTracks(){this.getTracks().forEach(e=>{"live"===e.readyState&&e.stop()})}muteLocalStream(e){this.state.mediaStream&&(e?this.stopTracks():this.muteTracks())}async unmuteStream(){let e,t;if(this.logger("debug","Starting stream"),this.state.mediaStream&&this.getTracks().every(e=>"live"===e.readyState))e=this.state.mediaStream,this.unmuteTracks();else{let i={...this.state.defaultConstraints,deviceId:this.state.selectedDevice},n=e=>async t=>{if(!e)return t;let i=await e;return t.getTracks().forEach(e=>{let t=e.stop;e.stop=function(){t.call(e),i.getTracks().forEach(t=>{t.kind===e.kind&&t.stop()})}}),i.getTracks().forEach(e=>{let i=()=>{t.getTracks().forEach(t=>{e.kind===t.kind&&(t.stop(),t.dispatchEvent(new Event("ended")))})};e.addEventListener("ended",i),this.subscriptions.push(()=>{e.removeEventListener("ended",i)})}),t};t=this.getStream(i),e=await this.filters.reduce((e,t)=>e.then(e=>{let{stop:i,output:n}=t.start(e);return t.stop=i,n}).then(n(e),t=>(this.logger("warn","Filter failed to start and will be ignored",t),e)),t)}this.call.state.callingState===F.JOINED&&await this.publishStream(e),this.state.mediaStream!==e&&(this.state.setMediaStream(e,await t),this.getTracks().forEach(e=>{e.addEventListener("ended",async()=>{await this.statusChangeSettled(),this.enabled&&(this.isTrackStoppedDueToTrackEnd=!0,setTimeout(()=>{this.isTrackStoppedDueToTrackEnd=!1},2e3),await this.disable())})}))}get mediaDeviceKind(){return this.trackType===D.AUDIO?"audioinput":this.trackType===D.VIDEO?"videoinput":""}handleDisconnectedOrReplacedDevices(){this.subscriptions.push(nJ((0,ee.a)([ak.pipe((0,eg.G)()),this.state.selectedDevice$]),async e=>{let[[t,i],n]=e;try{if(!n)return;await this.statusChangeSettled();let e=!1,s=!1,a=this.findDeviceInList(i,n),r=this.findDeviceInList(t,n);!a&&r?e=!0:a&&r&&a.deviceId===r.deviceId&&a.groupId!==r.groupId&&(s=!0),e&&(await this.disable(),await this.select(void 0)),s&&(this.isTrackStoppedDueToTrackEnd&&"disabled"===this.state.status?(await this.enable(),this.isTrackStoppedDueToTrackEnd=!1):await this.applySettingsToStream())}catch(e){this.logger("warn","Unexpected error while handling disconnected or replaced device",e)}}))}findDeviceInList(e,t){return e.find(e=>e.deviceId===t&&e.kind===this.mediaDeviceKind)}constructor(e,t,i){this.call=e,this.state=t,this.trackType=i,this.stopOnLeave=!0,this.subscriptions=[],this.isTrackStoppedDueToTrackEnd=!1,this.filters=[],this.statusChangeConcurrencyTag=Symbol("statusChangeConcurrencyTag"),this.filterRegistrationConcurrencyTag=Symbol("filterRegistrationConcurrencyTag"),this.dispose=()=>{this.subscriptions.forEach(e=>e())},this.logger=nc(["".concat(D[i].toLowerCase()," manager")]),ak&&!ni()&&(this.trackType===D.AUDIO||this.trackType===D.VIDEO)&&this.handleDisconnectedOrReplacedDevices()}}class aS{get status(){return this.getCurrentValue(this.status$)}get optimisticStatus(){return this.getCurrentValue(this.optimisticStatus$)}get selectedDevice(){return this.getCurrentValue(this.selectedDevice$)}get mediaStream(){return this.getCurrentValue(this.mediaStream$)}setStatus(e){this.setCurrentValue(this.statusSubject,e)}setPendingStatus(e){this.setCurrentValue(this.optimisticStatusSubject,e)}setMediaStream(e,t){this.setCurrentValue(this.mediaStreamSubject,e),t&&this.setDevice(this.getDeviceIdFromStream(t))}setDevice(e){this.setCurrentValue(this.selectedDeviceSubject,e)}get defaultConstraints(){return this.getCurrentValue(this.defaultConstraints$)}setDefaultConstraints(e){this.setCurrentValue(this.defaultConstraintsSubject,e)}constructor(e="stop-tracks",t){this.disableMode=e,this.statusSubject=new et.X(void 0),this.optimisticStatusSubject=new et.X(void 0),this.mediaStreamSubject=new et.X(void 0),this.selectedDeviceSubject=new et.X(void 0),this.defaultConstraintsSubject=new et.X(void 0),this.mediaStream$=this.mediaStreamSubject.asObservable(),this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe((0,es.x)()),this.status$=this.statusSubject.asObservable().pipe((0,es.x)()),this.optimisticStatus$=this.optimisticStatusSubject.asObservable().pipe((0,es.x)()),this.defaultConstraints$=this.defaultConstraintsSubject.asObservable(),this.getCurrentValue=nq,this.setCurrentValue=nK,this.hasBrowserPermission$=t?t.asObservable().pipe((0,en.d)(1)):(0,em.of)(!0)}}class aC extends aS{get direction(){return this.getCurrentValue(this.direction$)}setDirection(e){this.setCurrentValue(this.directionSubject,e)}setMediaStream(e,t){if(super.setMediaStream(e,t),e){var i;let t=ni()?this.direction:(null===(i=e.getVideoTracks()[0])||void 0===i?void 0:i.getSettings().facingMode)==="environment"?"back":"front";this.setDirection(t)}}getDeviceIdFromStream(e){let[t]=e.getVideoTracks();return null==t?void 0:t.getSettings().deviceId}constructor(){super("stop-tracks",ah()),this.directionSubject=new et.X(void 0),this.direction$=this.directionSubject.asObservable().pipe((0,es.x)())}}class aE extends aT{get publishOptions(){return{preferredCodec:this.preferredCodec,preferredBitrate:this.preferredBitrate}}async selectDirection(e){this.state.setDirection(e),this.state.setDevice(void 0),await this.applySettingsToStream()}async flip(){let e="front"===this.state.direction?"back":"front";await this.selectDirection(e)}async selectTargetResolution(e){if(this.targetResolution.height=e.height,this.targetResolution.width=e.width,"enabled"===this.state.optimisticStatus)try{await this.statusChangeSettled()}catch(e){this.logger("warn","could not apply target resolution",e)}if(this.enabled){var t;let{width:e,height:i}=null===(t=this.state.mediaStream.getVideoTracks()[0])||void 0===t?void 0:t.getSettings();(e!==this.targetResolution.width||i!==this.targetResolution.height)&&(await this.applySettingsToStream(),this.logger("debug","".concat(e,"x").concat(i," target resolution applied to media stream")))}}setPreferredCodec(e){this.preferredCodec=e}setPreferredBitrate(e){this.preferredBitrate=e}getDevices(){return ag()}getStream(e){return e.width=this.targetResolution.width,e.height=this.targetResolution.height,!e.deviceId&&this.state.direction&&(e.facingMode="front"===this.state.direction?"user":"environment"),ab(e)}publishStream(e){return this.call.publishVideoStream(e,this.publishOptions)}stopPublishStream(e){return this.call.stopPublish(D.VIDEO,e)}constructor(e){super(e,new aC,D.VIDEO),this.targetResolution={width:1280,height:720}}}class aR extends aS{get speakingWhileMuted(){return this.getCurrentValue(this.speakingWhileMuted$)}setSpeakingWhileMuted(e){this.setCurrentValue(this.speakingWhileMutedSubject,e)}getDeviceIdFromStream(e){let[t]=e.getAudioTracks();return null==t?void 0:t.getSettings().deviceId}constructor(e){super(e,ad()),this.speakingWhileMutedSubject=new et.X(!1),this.speakingWhileMuted$=this.speakingWhileMutedSubject.asObservable().pipe((0,es.x)())}}let aI=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{detectionFrequencyInMs:n=500,audioLevelThreshold:s=150,fftSize:a=128,destroyStreamOnStop:r=!0}=i,o=new AudioContext,l=o.createAnalyser();l.fftSize=a;let c=o.createMediaStreamSource(e);c.connect(l);let d=setInterval(()=>{var i;let n=new Uint8Array(l.frequencyBinCount);l.getByteFrequencyData(n);let a=n.some(e=>e>=s),r=n.reduce((e,t)=>e+t,0)/n.length;(null===(i=e.getAudioTracks()[0])||void 0===i?void 0:i.enabled)?t({isSoundDetected:a,audioLevel:r>s?100:Math.round(r/s*100)}):t({isSoundDetected:!1,audioLevel:0})},n);return async function(){clearInterval(d),c.disconnect(),l.disconnect(),"closed"!==o.state&&await o.close(),r&&e.getTracks().forEach(t=>{t.stop(),e.removeTrack(t)})}};class aD{async start(){try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc1.addEventListener("icecandidate",async e=>{await this.pc2.addIceCandidate(e.candidate)}),this.pc2.addEventListener("icecandidate",async e=>{await this.pc1.addIceCandidate(e.candidate)}),e.getTracks().forEach(t=>this.pc1.addTrack(t,e));let t=await this.pc1.createOffer({});await this.pc2.setRemoteDescription(t),await this.pc1.setLocalDescription(t);let i=await this.pc2.createAnswer();await this.pc1.setRemoteDescription(i),await this.pc2.setLocalDescription(i),e.getAudioTracks().forEach(e=>e.enabled=!1)}catch(e){console.error("Error connecting and negotiating between PeerConnections:",e)}}stop(){this.pc1.close(),this.pc2.close(),this.intervalId&&clearInterval(this.intervalId)}onSpeakingDetectedStateChange(e){return this.intervalId=setInterval(async()=>{let t=sG(await this.pc1.getStats()).find(e=>"media-source"===e.type&&"audio"===e.kind);if(t){let{audioLevel:i}=t;i&&(i>=.2?e({isSoundDetected:!0,audioLevel:i}):e({isSoundDetected:!1,audioLevel:0}))}},1e3),()=>{clearInterval(this.intervalId)}}constructor(){this.pc1=new RTCPeerConnection({}),this.pc2=new RTCPeerConnection({})}}class a_ extends aT{async enableNoiseCancellation(e){if(ni())throw Error("Noise cancellation is not supported in React Native");let{ownCapabilities:t,settings:i}=this.call.state;if(!t.includes(eS.ENABLE_NOISE_CANCELLATION))throw Error("Noise cancellation is not available.");let n=null==i?void 0:i.audio.noise_cancellation;if(!n||n.mode===eT.DISABLED)throw Error("Noise cancellation is disabled for this call type.");try{this.noiseCancellation=e,this.noiseCancellationChangeUnsubscribe=this.noiseCancellation.on("change",e=>{e?this.call.notifyNoiseCancellationStarting().catch(e=>{this.logger("warn","notifyNoiseCancellationStart failed",e)}):this.call.notifyNoiseCancellationStopped().catch(e=>{this.logger("warn","notifyNoiseCancellationStop failed",e)})});let t=this.registerFilter(e.toFilter());this.noiseCancellationRegistration=t.registered,this.unregisterNoiseCancellation=t.unregister,await this.noiseCancellationRegistration,n.mode===eT.AUTO_ON&&this.call.state.callingState===F.JOINED&&e.enable()}catch(e){this.logger("warn","Failed to enable noise cancellation",e),await this.disableNoiseCancellation().catch(e=>{this.logger("warn","Failed to disable noise cancellation",e)})}}async disableNoiseCancellation(){var e,t;if(ni())throw Error("Noise cancellation is not supported in React Native");await (null!==(t=null===(e=this.unregisterNoiseCancellation)||void 0===e?void 0:e.call(this))&&void 0!==t?t:Promise.resolve()).then(()=>{var e;return null===(e=this.noiseCancellation)||void 0===e?void 0:e.disable()}).then(()=>{var e;return null===(e=this.noiseCancellationChangeUnsubscribe)||void 0===e?void 0:e.call(this)}).catch(e=>{this.logger("warn","Failed to unregister noise cancellation",e)}),await this.call.notifyNoiseCancellationStopped()}async enableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!0,"disabled"===this.state.status&&await this.startSpeakingWhileMutedDetection(this.state.selectedDevice)}async disableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!1,await this.stopSpeakingWhileMutedDetection()}getDevices(){return ap()}getStream(e){return af(e)}publishStream(e){return this.call.publishAudioStream(e)}stopPublishStream(e){return this.call.stopPublish(D.AUDIO,e)}async startSpeakingWhileMutedDetection(e){await nW(this.soundDetectorConcurrencyTag,async()=>{if(await this.stopSpeakingWhileMutedDetection(),ni()){var t;this.rnSpeechDetector=new aD,await this.rnSpeechDetector.start();let e=null===(t=this.rnSpeechDetector)||void 0===t?void 0:t.onSpeakingDetectedStateChange(e=>{this.state.setSpeakingWhileMuted(e.isSoundDetected)});this.soundDetectorCleanup=()=>{var t;e(),null===(t=this.rnSpeechDetector)||void 0===t||t.stop(),this.rnSpeechDetector=void 0}}else{let t=await this.getStream({deviceId:e});this.soundDetectorCleanup=aI(t,e=>{this.state.setSpeakingWhileMuted(e.isSoundDetected)})}})}async stopSpeakingWhileMutedDetection(){await nW(this.soundDetectorConcurrencyTag,async()=>{if(!this.soundDetectorCleanup)return;let e=this.soundDetectorCleanup;this.soundDetectorCleanup=void 0,this.state.setSpeakingWhileMuted(!1),await e()})}constructor(e,t=ni()?"disable-tracks":"stop-tracks"){super(e,new aR(t),D.AUDIO),this.speakingWhileMutedNotificationEnabled=!0,this.soundDetectorConcurrencyTag=Symbol("soundDetectorConcurrencyTag"),this.subscriptions.push(nJ((0,ee.a)([this.call.state.callingState$,this.call.state.ownCapabilities$,this.state.selectedDevice$,this.state.status$]),async e=>{let[t,i,n,s]=e;try{if(t===F.LEFT&&await this.stopSpeakingWhileMutedDetection(),t!==F.JOINED||!this.speakingWhileMutedNotificationEnabled)return;i.includes(eS.SEND_AUDIO)&&"disabled"===s?await this.startSpeakingWhileMutedDetection(n):await this.stopSpeakingWhileMutedDetection()}catch(e){this.logger("warn","Could not enable speaking while muted",e)}})),this.subscriptions.push(nJ(this.call.state.callingState$,e=>{var t,i;this.noiseCancellationRegistration&&this.noiseCancellation&&((null===(i=this.call.state.settings)||void 0===i?void 0:null===(t=i.audio.noise_cancellation)||void 0===t?void 0:t.mode)===eT.AUTO_ON&&e===F.JOINED?this.noiseCancellationRegistration.then(()=>{var e;return null===(e=this.noiseCancellation)||void 0===e?void 0:e.enable()}).catch(e=>(this.logger("warn","Failed to enable noise cancellation",e),this.call.notifyNoiseCancellationStopped())):e===F.LEFT&&this.noiseCancellationRegistration.then(()=>{var e;return null===(e=this.noiseCancellation)||void 0===e?void 0:e.disable()}).catch(e=>{this.logger("warn","Failed to disable noise cancellation",e)}))}))}}class aN extends aS{get audioEnabled(){return this.getCurrentValue(this.audioEnabled$)}setAudioEnabled(e){this.setCurrentValue(this.audioEnabledSubject,e)}get settings(){return this.getCurrentValue(this.settings$)}setSettings(e){this.setCurrentValue(this.settingsSubject,e)}constructor(){super(...arguments),this.audioEnabledSubject=new et.X(!0),this.settingsSubject=new et.X(void 0),this.audioEnabled$=this.audioEnabledSubject.asObservable().pipe((0,es.x)()),this.settings$=this.settingsSubject.asObservable(),this.getDeviceIdFromStream=e=>{let[t]=e.getTracks();return null==t?void 0:t.getSettings().deviceId}}}class aP extends aT{enableScreenShareAudio(){this.state.setAudioEnabled(!0)}async disableScreenShareAudio(){var e;this.state.setAudioEnabled(!1),(null===(e=this.call.publisher)||void 0===e?void 0:e.isPublishing(D.SCREEN_SHARE_AUDIO))&&await this.call.stopPublish(D.SCREEN_SHARE_AUDIO,!0)}getSettings(){return this.state.settings}setSettings(e){this.state.setSettings(e)}getDevices(){return(0,em.of)([])}getStream(e){return this.state.audioEnabled||(e.audio=!1),av(e)}publishStream(e){return this.call.publishScreenShareStream(e,{screenShareSettings:this.state.settings})}async stopPublishStream(e){await this.call.stopPublish(D.SCREEN_SHARE,e),await this.call.stopPublish(D.SCREEN_SHARE_AUDIO,e)}async select(e){throw Error("This method is not supported in for Screen Share")}constructor(e){super(e,new aN,D.SCREEN_SHARE),this.subscriptions.push(nJ(e.state.settings$,e=>{let t=null==e?void 0:e.screensharing.target_resolution;t&&this.setDefaultConstraints({video:{width:t.width,height:t.height}})}))}}class aU{get selectedDevice(){return this.getCurrentValue(this.selectedDevice$)}get volume(){return this.getCurrentValue(this.volume$)}setDevice(e){this.setCurrentValue(this.selectedDeviceSubject,e)}setVolume(e){this.setCurrentValue(this.volumeSubject,e)}constructor(){this.selectedDeviceSubject=new et.X(""),this.volumeSubject=new et.X(1),this.isDeviceSelectionSupported=ao(),this.getCurrentValue=nq,this.setCurrentValue=nK,this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe((0,es.x)()),this.volume$=this.volumeSubject.asObservable().pipe((0,es.x)())}}class aO{listDevices(){if(ni())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");return am()}select(e){if(ni())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");this.state.setDevice(e)}setVolume(e){if(ni())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(e&&(e<0||e>1))throw Error("Volume must be between 0 and 1");this.state.setVolume(e)}setParticipantVolume(e,t){if(ni())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(t&&(t<0||t>1))throw Error("Volume must be between 0 and 1, or undefined");this.call.state.updateParticipant(e,{audioVolume:t})}constructor(e){this.state=new aU,this.subscriptions=[],this.dispose=()=>{this.subscriptions.forEach(e=>e.unsubscribe())},this.call=e,ak&&!ni()&&this.subscriptions.push((0,ee.a)([ak,this.state.selectedDevice$]).subscribe(e=>{let[t,i]=e;i&&(t.find(e=>e.deviceId===i&&"audiooutput"===e.kind)||this.select(""))}))}}class aA{async setup(){await nW(this.joinLeaveConcurrencyTag,async()=>{this.initialized||(this.leaveCallHooks.add(this.on("all",e=>{this.state.updateFromEvent(e)})),this.leaveCallHooks.add(sK(this,this.dispatcher)),this.registerEffects(),this.registerReconnectHandlers(),this.leaveCallHooks.add(nJ(this.trackSubscriptionsSubject.pipe((0,ey.D)(e=>(0,ef.H)(e.type)),(0,ei.U)(e=>e.data)),e=>{var t;return null===(t=this.sfuClient)||void 0===t?void 0:t.updateSubscriptions(e).catch(e=>{this.logger("debug","Failed to update track subscriptions",e)})})),this.state.callingState===F.LEFT&&this.state.setCallingState(F.IDLE),this.initialized=!0)})}registerEffects(){this.leaveCallHooks.add(nJ(this.state.settings$,e=>{e&&this.permissionsContext.setCallSettings(e)})),this.leaveCallHooks.add(nG(this.state.ownCapabilities$,this.handleOwnCapabilitiesUpdated)),this.leaveCallHooks.add(nJ(this.state.blockedUserIds$,async e=>{if(!e||0===e.length)return;let t=this.currentUserId;t&&e.includes(t)&&(this.logger("info","Leaving call because of being blocked"),await this.leave({reason:"user blocked"}).catch(e=>{this.logger("error","Error leaving call after being blocked",e)}))})),this.leaveCallHooks.add(nJ(this.state.callingState$,e=>{this.ringing&&(e===F.JOINED||e===F.JOINING||e===F.LEFT)&&(clearTimeout(this.dropTimeout),this.dropTimeout=void 0)})),this.leaveCallHooks.add(nJ(this.ringingSubject,e=>{var t,i;if(!e)return;let n=this.state.session,s=null===(t=this.clientStore.connectedUser)||void 0===t?void 0:t.id,a=null==n?void 0:n.ended_at,r=null===(i=this.state.createdBy)||void 0===i?void 0:i.id,o=null==n?void 0:n.rejected_by,l=null==n?void 0:n.accepted_by,c=!1;a?c=!0:r&&o?o[r]&&(c=!0):s&&o?o[s]&&(c=!0):s&&l&&l[s]&&(c=!0),c?this.state.callingState!==F.IDLE&&this.state.setCallingState(F.IDLE):(this.state.callingState===F.IDLE&&this.state.setCallingState(F.RINGING),this.scheduleAutoDrop(),this.leaveCallHooks.add(sJ(this)))}))}get ringing(){return nq(this.ringingSubject)}get currentUserId(){var e;return null===(e=this.clientStore.connectedUser)||void 0===e?void 0:e.id}get isCreatedByMe(){var e;return(null===(e=this.state.createdBy)||void 0===e?void 0:e.id)===this.currentUserId}constructor({type:e,id:t,streamClient:i,members:n,ownCapabilities:s,sortParticipantsBy:a,clientStore:r,ringing:o=!1,watching:l=!1}){var c=this;this.state=new sh,this.dynascaleManager=new s8(this),this.permissionsContext=new s7,this.dispatcher=new nR,this.trackSubscriptionsSubject=new et.X({type:j.MEDIUM,data:[]}),this.sfuClientTag=0,this.reconnectConcurrencyTag=Symbol("reconnectConcurrencyTag"),this.reconnectAttempts=0,this.reconnectStrategy=A.UNSPECIFIED,this.fastReconnectDeadlineSeconds=0,this.lastOfflineTimestamp=0,this.trackPublishOrder=[],this.hasJoinedOnce=!1,this.deviceSettingsAppliedOnce=!1,this.initialized=!1,this.joinLeaveConcurrencyTag=Symbol("joinLeaveConcurrencyTag"),this.leaveCallHooks=new Set,this.streamClientEventHandlers=new Map,this.handleOwnCapabilitiesUpdated=async e=>{if(this.permissionsContext.setPermissions(e),this.publisher){for(let[e,t]of Object.entries({[eS.SEND_AUDIO]:D.AUDIO,[eS.SEND_VIDEO]:D.VIDEO,[eS.SCREENSHARE]:D.SCREEN_SHARE}))if(!this.permissionsContext.hasPermission(e))try{switch(t){case D.AUDIO:this.microphone.enabled&&await this.microphone.disable();break;case D.VIDEO:this.camera.enabled&&await this.camera.disable();break;case D.SCREEN_SHARE:this.screenShare.enabled&&await this.screenShare.disable()}}catch(e){this.logger("error","Can't disable mic/camera/screenshare after revoked permissions",e)}}},this.on=(e,t)=>{if(nE(e))return this.dispatcher.on(e,t);let i=this.streamClient.on(e,e=>{e.call_cid&&e.call_cid===this.cid&&t(e)});return this.streamClientEventHandlers.set(t,i),()=>{this.off(e,t)}},this.off=(e,t)=>{if(nE(e))return this.dispatcher.off(e,t);let i=this.streamClientEventHandlers.get(t);i&&i()},this.leave=async function(){let{reject:e=!1,reason:t="user is leaving the call"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await nW(c.joinLeaveConcurrencyTag,async()=>{var i,n,s,a,r;let o=c.state.callingState;if(o===F.LEFT)throw Error("Cannot leave call that has already been left.");if(o===F.JOINING&&await new Promise(e=>{c.state.callingState$.pipe((0,ea.o)(e=>e!==F.JOINED,!0)).subscribe(()=>e())}),c.ringing){let t=c.state.remoteParticipants.length>0;c.isCreatedByMe&&!t&&o===F.RINGING?await c.reject():e&&o===F.RINGING&&await c.reject()}null===(i=c.statsReporter)||void 0===i||i.stop(),c.statsReporter=void 0,null===(n=c.sfuStatsReporter)||void 0===n||n.stop(),c.sfuStatsReporter=void 0,null===(s=c.subscriber)||void 0===s||s.close(),c.subscriber=void 0,null===(a=c.publisher)||void 0===a||a.close({stopTracks:!0}),c.publisher=void 0,await (null===(r=c.sfuClient)||void 0===r?void 0:r.leaveAndClose(t)),c.sfuClient=void 0,c.state.setCallingState(F.LEFT),c.leaveCallHooks.forEach(e=>e()),c.initialized=!1,c.hasJoinedOnce=!1,c.clientStore.unregisterCall(c),c.camera.dispose(),c.microphone.dispose(),c.screenShare.dispose(),c.speaker.dispose();let l=[];c.camera.stopOnLeave&&l.push(c.camera.disable(!0)),c.microphone.stopOnLeave&&l.push(c.microphone.disable(!0)),c.screenShare.stopOnLeave&&l.push(c.screenShare.disable(!0)),await Promise.all(l)})},this.get=async e=>{await this.setup();let t=await this.streamClient.get(this.streamClientBasePath,e);return this.state.updateFromCallResponse(t.call),this.state.setMembers(t.members),this.state.setOwnCapabilities(t.own_capabilities),((null==e?void 0:e.ring)||this.ringing)&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(!1),t},this.getOrCreate=async e=>{await this.setup();let t=await this.streamClient.post(this.streamClientBasePath,e);return this.state.updateFromCallResponse(t.call),this.state.setMembers(t.members),this.state.setOwnCapabilities(t.own_capabilities),((null==e?void 0:e.ring)||this.ringing)&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(!1),t},this.create=async e=>this.getOrCreate(e),this.ring=async()=>await this.get({ring:!0}),this.notify=async()=>await this.get({notify:!0}),this.accept=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/accept")),this.reject=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/reject"),{reason:e}),this.join=async e=>{var t,i,n;await this.setup();let s=this.state.callingState;if([F.JOINED,F.JOINING].includes(s))throw Error("Illegal State: call.join() shall be called only once");this.joinCallData=e,this.logger("debug","Starting join flow"),this.state.setCallingState(F.JOINING);let a=this.reconnectStrategy===A.MIGRATE,r=this.reconnectStrategy===A.REJOIN,o=this.reconnectStrategy===A.FAST,l=null===(t=this.sfuStatsReporter)||void 0===t?void 0:t.options;if(!this.credentials||!l||r||a)try{let t=await this.doJoinRequest(e);this.credentials=t.credentials,l=t.stats_options}catch(e){throw this.state.setCallingState(s),e}let c=this.sfuClient,d=null==c?void 0:c.sessionId,h=!!(null==c?void 0:c.isHealthy),u=r||a||!h?new sS({logTag:String(this.sfuClientTag++),dispatcher:this.dispatcher,credentials:this.credentials,sessionId:r?void 0:d,onSignalClose:()=>this.handleSfuSignalClose(u)}):c;this.sfuClient=u;let p=nk();if(c!==u){let t=await nT("recvonly"),i=this.reconnectStrategy!==A.UNSPECIFIED?this.getReconnectDetails(null==e?void 0:e.migrating_from,d):void 0,{callState:n,fastReconnectDeadlineSeconds:s}=await u.join({subscriberSdp:t,clientDetails:p,fastReconnect:o,reconnectDetails:i});this.fastReconnectDeadlineSeconds=s,n&&this.state.updateFromSfuCallState(n,u.sessionId,i)}if(a||this.state.setCallingState(F.JOINED),this.hasJoinedOnce=!0,o)await this.restoreICE(u,{includeSubscriber:!1});else{let e=sC(this.credentials.ice_servers);this.initPublisherAndSubscriber({sfuClient:u,connectionConfig:e,clientDetails:p,statsOptions:l,closePreviousInstances:!a})}if(r){let e=A[this.reconnectStrategy];await (null==c?void 0:c.leaveAndClose("Closing previous WS after reconnect with strategy: ".concat(e)))}else h||null==c||c.close(sS.DISPOSE_OLD_SOCKET,"Closing unhealthy WS after reconnect");this.deviceSettingsAppliedOnce||(await this.applyDeviceConfig(!0),this.deviceSettingsAppliedOnce=!0),null===(i=this.joinCallData)||void 0===i||delete i.ring,null===(n=this.joinCallData)||void 0===n||delete n.notify,this.logger("info","Joined call ".concat(this.cid))},this.getReconnectDetails=(e,t)=>{var i;let n=this.reconnectStrategy,s=n===A.REJOIN;return{strategy:n,announcedTracks:(null===(i=this.publisher)||void 0===i?void 0:i.getAnnouncedTracks())||[],subscriptions:nq(this.trackSubscriptionsSubject).data||[],reconnectAttempt:this.reconnectAttempts,fromSfuId:e||"",previousSessionId:s&&t||""}},this.restoreICE=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{includeSubscriber:i=!0,includePublisher:n=!0}=t;c.subscriber&&(c.subscriber.setSfuClient(e),i&&await c.subscriber.restartIce()),c.publisher&&(c.publisher.setSfuClient(e),n&&await c.publisher.restartIce())},this.initPublisherAndSubscriber=e=>{var t,i,n,s;let{sfuClient:a,connectionConfig:r,clientDetails:o,statsOptions:l,closePreviousInstances:c}=e;if(c&&this.subscriber&&this.subscriber.close(),this.subscriber=new sk({sfuClient:a,dispatcher:this.dispatcher,state:this.state,connectionConfig:r,logTag:String(this.sfuClientTag),onUnrecoverableError:()=>{this.reconnect(A.REJOIN).catch(e=>{this.logger("warn","[Reconnect] Error reconnecting after a subscriber error",e)})}}),(null===(t=this.streamClient.user)||void 0===t?void 0:t.type)!=="anonymous"){c&&this.publisher&&this.publisher.close({stopTracks:!1});let e=null===(s=this.state.settings)||void 0===s?void 0:s.audio,t=!!(null==e?void 0:e.opus_dtx_enabled),i=!!(null==e?void 0:e.redundant_coding_enabled);this.publisher=new sv({sfuClient:a,dispatcher:this.dispatcher,state:this.state,connectionConfig:r,isDtxEnabled:t,isRedEnabled:i,logTag:String(this.sfuClientTag),onUnrecoverableError:()=>{this.reconnect(A.REJOIN).catch(e=>{this.logger("warn","[Reconnect] Error reconnecting after a publisher error",e)})}})}null===(i=this.statsReporter)||void 0===i||i.stop(),this.statsReporter=sY({subscriber:this.subscriber,publisher:this.publisher,state:this.state,datacenter:a.edgeName}),null===(n=this.sfuStatsReporter)||void 0===n||n.stop(),(null==l?void 0:l.reporting_interval_ms)>0&&(this.sfuStatsReporter=new s2(a,{clientDetails:o,options:l,subscriber:this.subscriber,publisher:this.publisher}),this.sfuStatsReporter.start())},this.doJoinRequest=async e=>{let t=await this.streamClient.getLocationHint(),i={...e,location:t},n=await this.streamClient.post("".concat(this.streamClientBasePath,"/join"),i);return this.state.updateFromCallResponse(n.call),this.state.setMembers(n.members),this.state.setOwnCapabilities(n.own_capabilities),(null==e?void 0:e.ring)&&!this.ringing&&this.ringingSubject.next(!0),this.ringing&&!this.isCreatedByMe&&await this.accept(),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),n},this.handleSfuSignalClose=e=>{this.logger("debug","[Reconnect] SFU signal connection closed"),e.isLeaving||this.reconnect(A.REJOIN).catch(e=>{this.logger("warn","[Reconnect] Error reconnecting",e)})},this.reconnect=async e=>nW(this.reconnectConcurrencyTag,async()=>{this.logger("info","[Reconnect] Reconnecting with strategy ".concat(A[e])),this.reconnectStrategy=e;do{this.reconnectStrategy!==A.FAST&&this.reconnectAttempts++;let e=A[this.reconnectStrategy];try{var t;switch(await (null===(t=this.networkAvailableTask)||void 0===t?void 0:t.promise),this.reconnectStrategy){case A.UNSPECIFIED:case A.DISCONNECT:this.logger("debug","[Reconnect] No-op strategy ".concat(e));break;case A.FAST:await this.reconnectFast();break;case A.REJOIN:await this.reconnectRejoin();break;case A.MIGRATE:await this.reconnectMigrate();break;default:nL(this.reconnectStrategy,"Unknown reconnection strategy")}break}catch(t){if(t instanceof eC&&t.unrecoverable){this.logger("warn","[Reconnect] Can't reconnect due to coordinator unrecoverable error",t),this.state.setCallingState(F.RECONNECTING_FAILED);return}this.logger("warn","[Reconnect] ".concat(e," (").concat(this.reconnectAttempts,") failed. Attempting with REJOIN"),t),await i3(500),this.reconnectStrategy=A.REJOIN}}while(this.state.callingState!==F.JOINED&&this.state.callingState!==F.RECONNECTING_FAILED&&this.state.callingState!==F.LEFT)}),this.reconnectFast=async()=>(this.reconnectStrategy=A.FAST,this.state.setCallingState(F.RECONNECTING),this.join(this.joinCallData)),this.reconnectRejoin=async()=>{this.reconnectStrategy=A.REJOIN,this.state.setCallingState(F.RECONNECTING),await this.join(this.joinCallData),await this.restorePublishedTracks(),this.restoreSubscribedTracks()},this.reconnectMigrate=async()=>{let e=this.sfuClient;if(!e)throw Error("Cannot migrate without an active SFU client");this.reconnectStrategy=A.MIGRATE,this.state.setCallingState(F.MIGRATING);let t=this.subscriber,i=this.publisher;null==t||t.detachEventHandlers(),null==i||i.detachEventHandlers();let n=e.enterMigration();try{let t=e.edgeName;await this.join({...this.joinCallData,migrating_from:t})}finally{var s;null===(s=this.joinCallData)||void 0===s||delete s.migrating_from}await this.restorePublishedTracks(),this.restoreSubscribedTracks();try{await n,this.state.setCallingState(F.JOINED)}finally{null==t||t.close(),null==i||i.close({stopTracks:!1}),e.close()}},this.registerReconnectHandlers=()=>{let e=this.on("goAway",()=>{this.reconnect(A.MIGRATE).catch(e=>{this.logger("warn","[Reconnect] Error reconnecting",e)})}),t=this.on("error",e=>{let{reconnectStrategy:t}=e;t!==A.UNSPECIFIED&&(t===A.DISCONNECT?this.leave({reason:"SFU instructed to disconnect"}).catch(e=>{this.logger("warn","Can't leave call after disconnect request",e)}):this.reconnect(t).catch(e=>{this.logger("warn","[Reconnect] Error reconnecting",e)}))}),i=this.streamClient.on("network.changed",e=>{var t,i,n,s;if(e.online)this.logger("debug","[Reconnect] Going online"),null===(i=this.sfuClient)||void 0===i||i.close(sS.DISPOSE_OLD_SOCKET,"Closing WS to reconnect after going online"),null===(n=this.networkAvailableTask)||void 0===n||n.resolve(),this.networkAvailableTask=void 0,null===(s=this.sfuStatsReporter)||void 0===s||s.start();else{if(this.logger("debug","[Reconnect] Going offline"),!this.hasJoinedOnce)return;this.lastOfflineTimestamp=Date.now();let e=sT();e.promise.then(()=>{let e=A.FAST;this.lastOfflineTimestamp&&(Date.now()-this.lastOfflineTimestamp)/1e3>this.fastReconnectDeadlineSeconds&&(e=A.REJOIN),this.reconnect(e).catch(e=>{this.logger("warn","[Reconnect] Error reconnecting after going online",e)})}),this.networkAvailableTask=e,null===(t=this.sfuStatsReporter)||void 0===t||t.stop(),this.state.setCallingState(F.OFFLINE)}});this.leaveCallHooks.add(e),this.leaveCallHooks.add(t),this.leaveCallHooks.add(i)},this.restorePublishedTracks=async()=>{for(let e of this.trackPublishOrder)switch(e){case D.AUDIO:let t=this.microphone.state.mediaStream;t&&await this.publishAudioStream(t);break;case D.VIDEO:let i=this.camera.state.mediaStream;i&&await this.publishVideoStream(i,this.camera.publishOptions);break;case D.SCREEN_SHARE:let n=this.screenShare.state.mediaStream;n&&await this.publishScreenShareStream(n,{screenShareSettings:this.screenShare.getSettings()});break;case D.SCREEN_SHARE_AUDIO:case D.UNSPECIFIED:break;default:nL(e,"Unknown track type")}},this.restoreSubscribedTracks=()=>{let{remoteParticipants:e}=this.state;e.length<=0||this.updateSubscriptions(e,j.FAST)},this.publishVideoStream=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!c.sfuClient)throw Error("Call not joined yet.");if(await c.sfuClient.joinTask,!c.permissionsContext.hasPermission(eS.SEND_VIDEO))throw Error("No permission to publish video");if(!c.publisher)throw Error("Publisher is not initialized");let[i]=e.getVideoTracks();if(!i)throw Error("There is no video track in the stream");c.trackPublishOrder.includes(D.VIDEO)||c.trackPublishOrder.push(D.VIDEO),await c.publisher.publishStream(e,i,D.VIDEO,t)},this.publishAudioStream=async e=>{if(!this.sfuClient)throw Error("Call not joined yet.");if(await this.sfuClient.joinTask,!this.permissionsContext.hasPermission(eS.SEND_AUDIO))throw Error("No permission to publish audio");if(!this.publisher)throw Error("Publisher is not initialized");let[t]=e.getAudioTracks();if(!t)throw Error("There is no audio track in the stream");this.trackPublishOrder.includes(D.AUDIO)||this.trackPublishOrder.push(D.AUDIO),await this.publisher.publishStream(e,t,D.AUDIO)},this.publishScreenShareStream=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!c.sfuClient)throw Error("Call not joined yet.");if(await c.sfuClient.joinTask,!c.permissionsContext.hasPermission(eS.SCREENSHARE))throw Error("No permission to publish screen share");if(!c.publisher)throw Error("Publisher is not initialized");let[i]=e.getVideoTracks();if(!i)throw Error("There is no screen share track in the stream");c.trackPublishOrder.includes(D.SCREEN_SHARE)||c.trackPublishOrder.push(D.SCREEN_SHARE),await c.publisher.publishStream(e,i,D.SCREEN_SHARE,t);let[n]=e.getAudioTracks();n&&(c.trackPublishOrder.includes(D.SCREEN_SHARE_AUDIO)||c.trackPublishOrder.push(D.SCREEN_SHARE_AUDIO),await c.publisher.publishStream(e,n,D.SCREEN_SHARE_AUDIO,t))},this.stopPublish=async function(e){var t;let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];c.logger("info","stopPublish ".concat(D[e],", stop tracks: ").concat(i)),await (null===(t=c.publisher)||void 0===t?void 0:t.unpublishStream(e,i))},this.notifyNoiseCancellationStarting=async()=>{var e;return null===(e=this.sfuClient)||void 0===e?void 0:e.startNoiseCancellation().catch(e=>{this.logger("warn","Failed to notify start of noise cancellation",e)})},this.notifyNoiseCancellationStopped=async()=>{var e;return null===(e=this.sfuClient)||void 0===e?void 0:e.stopNoiseCancellation().catch(e=>{this.logger("warn","Failed to notify stop of noise cancellation",e)})},this.updateSubscriptionsPartial=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.SLOW,n=c.state.updateParticipants(Object.entries(t).reduce((t,i)=>{let[n,s]=i;s.dimension&&(s.dimension.height=Math.ceil(s.dimension.height),s.dimension.width=Math.ceil(s.dimension.width));let a="videoTrack"===e?"videoDimension":"screenShareTrack"===e?"screenShareDimension":void 0;return a&&(t[n]={[a]:s.dimension}),t},{}));c.updateSubscriptions(n,i)},this.updateSubscriptions=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.SLOW,i=[];for(let t of e)!t.isLocalParticipant&&(t.videoDimension&&n0(t)&&i.push({userId:t.userId,sessionId:t.sessionId,trackType:D.VIDEO,dimension:t.videoDimension}),t.screenShareDimension&&n2(t)&&i.push({userId:t.userId,sessionId:t.sessionId,trackType:D.SCREEN_SHARE,dimension:t.screenShareDimension}),n3(t)&&i.push({userId:t.userId,sessionId:t.sessionId,trackType:D.SCREEN_SHARE_AUDIO}));c.trackSubscriptionsSubject.next({type:t,data:i})},this.startReportingStatsFor=e=>{var t;return null===(t=this.statsReporter)||void 0===t?void 0:t.startReportingStatsFor(e)},this.stopReportingStatsFor=e=>{var t;return null===(t=this.statsReporter)||void 0===t?void 0:t.stopReportingStatsFor(e)},this.resetReaction=e=>{this.state.updateParticipant(e,{reaction:void 0})},this.setSortParticipantsBy=e=>this.state.setSortParticipantsBy(e),this.updatePublishQuality=async e=>{var t;return null===(t=this.publisher)||void 0===t?void 0:t.updateVideoPublishQuality(e)},this.sendReaction=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/reaction"),e),this.blockUser=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/block"),{user_id:e}),this.unblockUser=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/unblock"),{user_id:e}),this.muteSelf=e=>{let t=this.currentUserId;if(t)return this.muteUser(t,e)},this.muteOthers=e=>{let t=nj(e);if(!t)return;let i=[];for(let e of this.state.remoteParticipants)e.publishedTracks.includes(t)&&i.push(e.userId);if(i.length>0)return this.muteUser(i,e)},this.muteUser=(e,t)=>this.streamClient.post("".concat(this.streamClientBasePath,"/mute_users"),{user_ids:Array.isArray(e)?e:[e],[t]:!0}),this.muteAllUsers=e=>this.streamClient.post("".concat(this.streamClientBasePath,"/mute_users"),{mute_all_users:!0,[e]:!0}),this.startRecording=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/start_recording"),e||{}),this.stopRecording=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/stop_recording"),{}),this.startTranscription=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/start_transcription"),e),this.stopTranscription=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/stop_transcription")),this.requestPermissions=async e=>{let{permissions:t}=e;if(!t.every(e=>this.permissionsContext.canRequest(e)))throw Error("You are not allowed to request permissions: ".concat(t.join(", ")));return this.streamClient.post("".concat(this.streamClientBasePath,"/request_permission"),e)},this.grantPermissions=async(e,t)=>this.updateUserPermissions({user_id:e,grant_permissions:t}),this.revokePermissions=async(e,t)=>this.updateUserPermissions({user_id:e,revoke_permissions:t}),this.updateUserPermissions=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/user_permissions"),e),this.goLive=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return c.streamClient.post("".concat(c.streamClientBasePath,"/go_live"),e,t)},this.stopLive=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/stop_live"),{}),this.startHLS=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/start_broadcasting"),{}),this.stopHLS=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/stop_broadcasting"),{}),this.update=async e=>{let t=await this.streamClient.patch("".concat(this.streamClientBasePath),e),{call:i,members:n,own_capabilities:s}=t;return this.state.updateFromCallResponse(i),this.state.setMembers(n),this.state.setOwnCapabilities(s),t},this.endCall=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/mark_ended")),this.pin=e=>{this.state.updateParticipant(e,{pin:{isLocalPin:!0,pinnedAt:Date.now()}})},this.unpin=e=>{this.state.updateParticipant(e,{pin:void 0})},this.pinForEveryone=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/pin"),e),this.unpinForEveryone=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/unpin"),e),this.queryMembers=e=>this.streamClient.post("/call/members",{...e||{},id:this.id,type:this.type}),this.updateCallMembers=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/members"),e),this.scheduleAutoDrop=()=>{clearTimeout(this.dropTimeout),this.leaveCallHooks.add(nJ(this.state.settings$,e=>{if(!e||this.state.callingState!==F.RINGING)return;let t=e.ring.auto_cancel_timeout_ms;t<=0||(clearTimeout(this.dropTimeout),this.dropTimeout=setTimeout(()=>{this.leave({reason:"ring: timeout"}).catch(e=>{this.logger("error","Failed to drop call",e)})},t))}))},this.queryRecordings=async e=>{let t=this.streamClientBasePath;return e&&(t="".concat(t,"/").concat(e)),this.streamClient.get("".concat(t,"/recordings"))},this.queryTranscriptions=async()=>this.streamClient.get("".concat(this.streamClientBasePath,"/transcriptions")),this.getCallStats=async e=>{let t="".concat(this.streamClientBasePath,"/stats/").concat(e);return this.streamClient.get(t)},this.submitFeedback=async function(e){var t,i,n;let{reason:s,custom:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e<1||e>5)throw Error("Rating must be between 1 and 5");let r=null===(t=c.state.session)||void 0===t?void 0:t.id;if(!r)throw Error("Feedback can be submitted only in the context of a call session");let{sdkName:o,sdkVersion:l,...d}=s$(nk()),h=null!==(n=null===(i=c.sfuClient)||void 0===i?void 0:i.sessionId)&&void 0!==n?n:"N/A",u="".concat(c.streamClientBasePath,"/feedback/").concat(r);return c.streamClient.post(u,{rating:e,reason:s,user_session_id:h,sdk:o,sdk_version:l,custom:{...a,"x-stream-platform-data":d}})},this.sendCustomEvent=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/event"),{custom:e}),this.applyDeviceConfig=async e=>{await this.initCamera({setStatus:e}).catch(e=>{this.logger("warn","Camera init failed",e)}),await this.initMic({setStatus:e}).catch(e=>{this.logger("warn","Mic init failed",e)})},this.initCamera=async e=>{var t,i,n,s,a;if(await this.camera.statusChangeSettled(),(null===(t=this.state.localParticipant)||void 0===t?void 0:t.videoStream)||!this.permissionsContext.hasPermission("send-video"))return;if(!this.camera.state.direction&&!this.camera.state.selectedDevice){let e="front",t=null===(n=this.state.settings)||void 0===n?void 0:n.video.camera_facing;t&&(e="front"===t?"front":"back"),this.camera.state.setDirection(e)}let r=null===(i=this.state.settings)||void 0===i?void 0:i.video.target_resolution;r&&await this.camera.selectTargetResolution(r),e.setStatus&&(this.camera.enabled&&this.camera.state.mediaStream&&!(null===(s=this.publisher)||void 0===s?void 0:s.isPublishing(D.VIDEO))&&await this.publishVideoStream(this.camera.state.mediaStream,this.camera.publishOptions),void 0===this.camera.state.status&&(null===(a=this.state.settings)||void 0===a?void 0:a.video.camera_default_on)&&await this.camera.enable())},this.initMic=async e=>{var t,i,n;await this.microphone.statusChangeSettled(),(null===(t=this.state.localParticipant)||void 0===t||!t.audioStream)&&this.permissionsContext.hasPermission("send-audio")&&e.setStatus&&(this.microphone.enabled&&this.microphone.state.mediaStream&&!(null===(i=this.publisher)||void 0===i?void 0:i.isPublishing(D.AUDIO))&&await this.publishAudioStream(this.microphone.state.mediaStream),void 0===this.microphone.state.status&&(null===(n=this.state.settings)||void 0===n?void 0:n.audio.mic_default_on)&&await this.microphone.enable())},this.trackElementVisibility=(e,t,i)=>this.dynascaleManager.trackElementVisibility(e,t,i),this.setViewport=e=>this.dynascaleManager.setViewport(e),this.bindVideoElement=(e,t,i)=>{let n=this.dynascaleManager.bindVideoElement(e,t,i);if(n)return this.leaveCallHooks.add(n),()=>{this.leaveCallHooks.delete(n),n()}},this.bindAudioElement=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"audioTrack",n=c.dynascaleManager.bindAudioElement(e,t,i);if(n)return c.leaveCallHooks.add(n),()=>{c.leaveCallHooks.delete(n),n()}},this.bindCallThumbnailElement=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=()=>{e.src=t.fallbackImageSource||"https://getstream.io/random_svg/?name=x&id=x"},n=nJ(c.state.thumbnails$,t=>{if(!t)return;e.addEventListener("error",i);let n=new URL(t.image_url);n.searchParams.set("w",String(e.clientWidth)),n.searchParams.set("h",String(e.clientHeight)),e.src=n.toString()});return()=>{n(),e.removeEventListener("error",i)}},this.type=e,this.id=t,this.cid="".concat(e,":").concat(t),this.ringingSubject=new et.X(o),this.watching=l,this.streamClient=i,this.clientStore=r,this.streamClientBasePath="/call/".concat(this.type,"/").concat(this.id),this.logger=nc(["Call"]);let d=ai.get(e),h=a||d.options.sortParticipantsBy;h&&this.state.setSortParticipantsBy(h),this.state.setMembers(n||[]),this.state.setOwnCapabilities(s||[]),this.state.setCallingState(o?F.RINGING:F.IDLE),this.camera=new aE(this),this.microphone=new a_(this),this.speaker=new aO(this),this.screenShare=new aP(this)}}class aL{constructor(){this.connectionStartTimestamp=null,this.wsTotalFailures=0,this.wsConsecutiveFailures=0,this.instanceClientId=i8()}}let aB=async(e,t)=>{for(let i=0;i<3;i++){try{await G.default.post("https://chat-insights.getstream.io/insights/".concat(e),t)}catch(e){await i3((i+1)*3e3);continue}break}};function aj(e){var t,i,n;let{client:s}=e;return{ready_state:null===(t=e.ws)||void 0===t?void 0:t.readyState,url:e._buildUrl(),api_key:s.key,start_ts:s.insightMetrics.connectionStartTimestamp,end_ts:new Date().getTime(),auth_type:s.getAuthType(),token:s.tokenManager.token,user_id:s.userID,user_details:s._user,device:"browser",client_id:e.connectionID,ws_details:e.ws,ws_consecutive_failures:s.insightMetrics.wsConsecutiveFailures,ws_total_failures:s.insightMetrics.wsTotalFailures,request_id:e.requestID,online:"undefined"!=typeof navigator?null===(i=navigator)||void 0===i?void 0:i.onLine:null,user_agent:"undefined"!=typeof navigator?null===(n=navigator)||void 0===n?void 0:n.userAgent:null,instance_client_id:s.insightMetrics.instanceClientId}}let aF=e=>void 0!==e.code,aW=e=>void 0!==e.error;class aV{async connect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;if(this.isConnecting)throw Error("You've called connect twice, can only attempt 1 connection at the time");this.isDisconnected=!1;try{let e=await this._connect();this.consecutiveFailures=0,this._log("connect() - Established ws connection with healthcheck: ".concat(e))}catch(e){if(this.isHealthy=!1,this.consecutiveFailures+=1,e.code!==i4.TOKEN_EXPIRED||this.client.tokenManager.isStatic()){if(!e.isWSFailure)throw Error(JSON.stringify({code:e.code,StatusCode:e.StatusCode,message:e.message,isWSFailure:e.isWSFailure}))}else this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0})}return await this._waitForHealthy(e)}async _waitForHealthy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;return Promise.race([(async()=>{for(let t=0;t<=e;t+=50)try{return await this.connectionOpen}catch(i){if(t===e)throw Error(JSON.stringify({code:i.code,StatusCode:i.StatusCode,message:i.message,isWSFailure:i.isWSFailure}));await i3(50)}})(),(async()=>{throw await i3(e),this.isConnecting=!1,Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}))})()])}disconnect(e){let t;this._log("disconnect() - Closing the websocket connection for wsID ".concat(this.wsID)),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),nt(this.onlineStatusChanged),this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();let{ws:i}=this;return i&&i.close&&i.readyState===i.OPEN?(t=new Promise(t=>{let n=e=>{this._log("disconnect() - resolving isClosedPromise ".concat(e?"with":"without"," close frame"),{event:e}),t()};i.onclose=n,setTimeout(n,null!=e?e:1e3)}),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),i.close(i4.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),t=Promise.resolve()),delete this.ws,t}async _connect(){var e,t,i,n;if(this.isConnecting||this.isDisconnected&&this.client.options.enableWSFallback)return;this.isConnecting=!0,this.requestID=i8(),this.client.insightMetrics.connectionStartTimestamp=new Date().getTime();let s=!1;try{this._log("_connect() - waiting for token"),await this.client.tokenManager.tokenReady(),s=!0}catch(e){}try{s||(this._log("_connect() - tokenProvider failed before, so going to retry"),await this.client.tokenManager.loadToken()),this._setupConnectionPromise();let i=this._buildUrl();this._log("_connect() - Connecting to ".concat(i),{wsURL:i,requestID:this.requestID}),this.ws=new ev.Z(i),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID);let n=await this.connectionOpen;if(this.isConnecting=!1,n)return this.connectionID=n.connection_id,null===(e=(t=this.client).resolveConnectionId)||void 0===e||e.call(t,this.connectionID),this.client.insightMetrics.wsConsecutiveFailures>0&&this.client.options.enableInsights&&(aB("ws_success_after_failure",aj(this)),this.client.insightMetrics.wsConsecutiveFailures=0),n}catch(e){if(this.isConnecting=!1,this._log("_connect() - Error - ",e),this.client.options.enableInsights){this.client.insightMetrics.wsConsecutiveFailures++,this.client.insightMetrics.wsTotalFailures++;let t={...function(e){let t={};if(!e)return t;try{Object.getOwnPropertyNames(e).forEach(i=>{t[i]=Object.getOwnPropertyDescriptor(e,i)})}catch(e){return{error:"failed to serialize the error"}}return t}(e),...aj(this)};null==aB||aB("ws_fatal",t)}throw null===(i=(n=this.client).rejectConnectionId)||void 0===i||i.call(n,e),e}}async _reconnect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._log("_reconnect() - Initiating the reconnect"),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (1) since already connecting or healthy");return}let t=e.interval;if(t||(t=i5(this.consecutiveFailures)),await i3(t),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (2) since already connecting or healthy");return}if(this.isDisconnected&&this.client.options.enableWSFallback){this._log("_reconnect() - Abort (3) since disconnect() is called");return}this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),e.refreshToken&&await this.client.tokenManager.loadToken();try{await this._connect(),this._log("_reconnect() - Waiting for recoverCallBack"),this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0}catch(e){if(this.isHealthy=!1,this.consecutiveFailures+=1,e.code===i4.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});e.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect())}this._log("_reconnect() - == END ==")}_destroyCurrentWSConnection(){this.wsID+=1;try{var e,t;null===this||void 0===this||null===(e=this.ws)||void 0===e||e.removeAllListeners(),null===this||void 0===this||null===(t=this.ws)||void 0===t||t.close()}catch(e){}}constructor(e){var t=this;this._log=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";t.client.logger(n,"connection:"+e,{...i})},this.setClient=e=>{this.client=e},this._buildUrl=()=>{let e=new URLSearchParams;return e.set("api_key",this.client.key),e.set("stream-auth-type",this.client.getAuthType()),e.set("X-Stream-Client",this.client.getUserAgent()),"".concat(this.client.wsBaseURL,"/connect?").concat(e.toString())},this.onlineStatusChanged=e=>{"offline"===e.type?(this._log("onlineStatusChanged() - Status changing to offline"),this._setHealth(!1,!0)):"online"!==e.type||(this._log("onlineStatusChanged() - Status changing to online. isHealthy: ".concat(this.isHealthy)),this.isHealthy||this._reconnect({interval:10}))},this.onopen=e=>{var t;if(this.wsID!==e)return;let i=this.client.user;if(!i){this.client.logger("error","User not set, can't connect to WS");return}let n=this.client._getToken();if(!n){this.client.logger("error","Token not set, can't connect authenticate");return}let s={token:n,user_details:{id:i.id,name:i.name,image:i.image,custom:i.custom}};this.authenticationSent=!0,null===(t=this.ws)||void 0===t||t.send(JSON.stringify(s)),this._log("onopen() - onopen callback",{wsID:e})},this.onmessage=(e,t)=>{var i,n;if(this.wsID!==e)return;this._log("onmessage() - onmessage callback",{event:t,wsID:e});let s="string"==typeof t.data?JSON.parse(t.data):null;if(!this.isResolved&&s&&"connection.error"===s.type&&(this.isResolved=!0,s.error)){null===(i=this.rejectPromise)||void 0===i||i.call(this,this._errorFromWSEvent(s,!1));return}if(this.lastEvent=new Date,s&&("health.check"===s.type||"connection.ok"===s.type)&&this.scheduleNextPing(),s&&"connection.ok"===s.type&&(null===(n=this.resolvePromise)||void 0===n||n.call(this,s),this._setHealth(!0)),s&&"connection.error"===s.type&&s.error){let{code:e}=s.error;this.isHealthy=!1,this.isConnecting=!1,this.consecutiveFailures+=1,e!==i4.TOKEN_EXPIRED||this.client.tokenManager.isStatic()||(clearTimeout(this.connectionCheckTimeoutRef),this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}))}s&&(s.received_at=new Date,this.client.dispatchEvent(s)),this.scheduleConnectionCheck()},this.onclose=(e,t)=>{var i,n;if(this.wsID===e){if(this._log("onclose() - onclose callback - "+t.code,{event:t,wsID:e}),t.code===i4.WS_CLOSED_SUCCESS){let e=Error("WS connection reject with error ".concat(t.reason));e.reason=t.reason,e.code=t.code,e.wasClean=t.wasClean,e.target=t.target,null===(i=this.rejectPromise)||void 0===i||i.call(this,e),this._log("onclose() - WS connection reject with error ".concat(t.reason),{event:t})}else this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,null===(n=this.rejectPromise)||void 0===n||n.call(this,this._errorFromWSEvent(t)),this._log("onclose() - WS connection closed. Calling reconnect ...",{event:t}),this._reconnect()}},this.onerror=(e,t)=>{var i;this.wsID===e&&(this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,null===(i=this.rejectPromise)||void 0===i||i.call(this,this._errorFromWSEvent(t)),this._log("onerror() - WS connection resulted into error",{event:t}),this._reconnect())},this._setHealth=function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e!==t.isHealthy){if(t.isHealthy=e,t.isHealthy||i){t.client.dispatchEvent({type:"connection.changed",online:t.isHealthy});return}setTimeout(()=>{t.isHealthy||t.client.dispatchEvent({type:"connection.changed",online:t.isHealthy})},5e3)}},this._errorFromWSEvent=function(e){let i,n,s,a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];aF(e)&&(i=e.code,n="unknown",s=e.reason),aW(e)&&(i=e.error.code,n=e.error.StatusCode,s=e.error.message),t._log("_errorFromWSEvent() - WS failed with code ".concat(i),{event:e},"warn");let r=Error("WS failed with code ".concat(i," and reason - ").concat(s));return r.code=i,r.StatusCode=n,r.isWSFailure=a,r},this._setupConnectionPromise=()=>{this.isResolved=!1,this.connectionOpen=new Promise((e,t)=>{this.resolvePromise=e,this.rejectPromise=t})},this.scheduleNextPing=()=>{this.healthCheckTimeoutRef&&clearTimeout(this.healthCheckTimeoutRef),this.healthCheckTimeoutRef=setTimeout(()=>{let e=[{type:"health.check",client_id:this.client.clientID}];try{var t;null===(t=this.ws)||void 0===t||t.send(JSON.stringify(e))}catch(e){}},this.pingInterval)},this.scheduleConnectionCheck=()=>{this.connectionCheckTimeoutRef&&clearTimeout(this.connectionCheckTimeoutRef),this.connectionCheckTimeoutRef=setTimeout(()=>{let e=new Date;this.lastEvent&&e.getTime()-this.lastEvent.getTime()>this.connectionCheckTimeout&&(this._log("scheduleConnectionCheck - going to reconnect"),this._setHealth(!1),this._reconnect())},this.connectionCheckTimeout)},this.client=e,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.authenticationSent=!1,this.isDisconnected=!1,this.isResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25e3,this.connectionCheckTimeout=this.pingInterval+1e4,ne(this.onlineStatusChanged)}}function aM(e){return"string"==typeof e}let ax=e=>(0,ek.JQ)(new Uint8Array(function(e,t){let i=[];if(aM(e)&&t&&aM(e)){for(let n=0,s=e.length;n<s;n++)if(e.charAt(n)){let s=t(e.charAt(n),n,e);i[n]=s}}else if(!aM(e)&&!(t&&aM(e))){for(let n=0,s=e.length;n<s;n++)if(n in e){let s=t(e[n],n,e);i[n]=s}}return i}(e,e=>e.charCodeAt(0)))),aH=e=>{let t={},i=String.fromCharCode,n=e.length,s,a=0,r,o=0,l,c="";for(s=0;s<64;s++)t["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(s)]=s;for(r=0;r<n;r++)for(a=(a<<6)+t[e.charAt(r)],o+=6;o>=8;)((l=a>>>(o-=8)&255)||r<n-2)&&(c+=i(l));return c};class az{constructor(e){this.setTokenOrProvider=async(e,t,i)=>{this.validateToken(e,t,i),this.user=t,i9(e)&&(this.tokenProvider=e,this.type="provider"),"string"==typeof e&&(this.token=e,this.type="static"),await this.loadToken()},this.reset=()=>{this.token=void 0,this.user=void 0,this.loadTokenPromise=null},this.validateToken=(e,t,i)=>{if(!t||!i||e){if(!this.secret&&!e)throw Error("UserWithId token can not be empty");if(e&&"string"!=typeof e&&!i9(e))throw Error("user token should either be a string or a function");if("string"==typeof e){if(i&&""===e)return;let n=function(e){let t=e.split(".");return 3!==t.length?"":JSON.parse(aH(t[1])).user_id}(e);if(null!=e&&(null==n||""===n||!i&&n!==t.id))throw Error("userToken does not have a user_id or is not matching with user.id")}}},this.tokenReady=()=>this.loadTokenPromise,this.loadToken=()=>(this.loadTokenPromise=new Promise(async(e,t)=>{if("static"===this.type)return e(this.token);if(this.tokenProvider&&"string"!=typeof this.tokenProvider){try{this.token=await this.tokenProvider()}catch(e){return t(Error("Call to tokenProvider failed with message: ".concat(e)))}e(this.token)}}),this.loadTokenPromise),this.getToken=()=>{if(this.token||this.user&&!this.token)return this.token;throw Error("User token is not set. Either client.connectUser wasn't called or client.disconnect was called")},this.isStatic=()=>"static"===this.type,this.loadTokenPromise=null,e&&(this.secret=e),this.type="static"}}let aq={"-1":{name:"InternalSystemError",retryable:!0},2:{name:"AccessKeyError",retryable:!1},3:{name:"AuthenticationFailedError",retryable:!0},4:{name:"InputError",retryable:!1},6:{name:"DuplicateUsernameError",retryable:!1},9:{name:"RateLimitError",retryable:!0},16:{name:"DoesNotExistError",retryable:!1},17:{name:"NotAllowedError",retryable:!1},18:{name:"EventNotSupportedError",retryable:!1},19:{name:"ChannelFeatureNotSupportedError",retryable:!1},20:{name:"MessageTooLongError",retryable:!1},21:{name:"MultipleNestingLevelError",retryable:!1},22:{name:"PayloadTooBigError",retryable:!1},23:{name:"RequestTimeoutError",retryable:!0},24:{name:"MaxHeaderSizeExceededError",retryable:!1},40:{name:"AuthErrorTokenExpired",retryable:!1},41:{name:"AuthErrorTokenNotValidYet",retryable:!1},42:{name:"AuthErrorTokenUsedBeforeIssuedAt",retryable:!1},43:{name:"AuthErrorTokenSignatureInvalid",retryable:!1},44:{name:"CustomCommandEndpointMissingError",retryable:!1},45:{name:"CustomCommandEndpointCallError",retryable:!0},46:{name:"ConnectionIDNotFoundError",retryable:!1},60:{name:"CoolDownError",retryable:!0},69:{name:"ErrWrongRegion",retryable:!1},70:{name:"ErrQueryChannelPermissions",retryable:!1},71:{name:"ErrTooManyConnections",retryable:!0},99:{name:"AppSuspendedError",retryable:!1}};function aK(e){if(!e.code)return!1;let t=aq["".concat(e.code)];return!!t&&t.retryable}(S=W||(W={})).Closed="CLOSED",S.Connected="CONNECTED",S.Connecting="CONNECTING",S.Disconnected="DISCONNECTED",S.Init="INIT";class aJ{_log(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(i,"WSConnectionFallback:"+e,{...t})}_setState(e){this._log("_setState() - ".concat(e)),this.state===W.Connecting&&e===W.Connected&&this.client.dispatchEvent({type:"connection.changed",online:!0}),(e===W.Closed||e===W.Disconnected)&&this.client.dispatchEvent({type:"connection.changed",online:!1}),this.state=e}constructor(e){var t=this;this._onlineStatusChanged=e=>{if(this._log("_onlineStatusChanged() - ".concat(e.type)),"offline"===e.type){var t;this._setState(W.Closed),null===(t=this.cancelToken)||void 0===t||t.cancel("disconnect() is called"),this.cancelToken=void 0;return}"online"===e.type&&this.state===W.Closed&&this.connect(!0)},this._req=async(e,t,i)=>{this.cancelToken||e.close||(this.cancelToken=G.default.CancelToken.source());try{var n;let i=await this.client.doAxiosRequest("get",this.client.baseURL.replace(":3030",":8900")+"/longpoll",void 0,{config:{...t,cancelToken:null===(n=this.cancelToken)||void 0===n?void 0:n.token},params:e,publicEndpoint:!0});return this.consecutiveFailures=0,i}catch(n){if(this.consecutiveFailures+=1,i&&aK(n))return this._log("_req() - Retryable error, retrying request"),await i3(i5(this.consecutiveFailures)),this._req(e,t,i);throw n}},this._poll=async()=>{for(;this.state===W.Connected;)try{var e;let t=await this._req({},{timeout:3e4},!0);if(null===(e=t.events)||void 0===e?void 0:e.length)for(let e=0;e<t.events.length;e++)this.client.dispatchEvent(t.events[e])}catch(e){if(G.default.isCancel(e)){this._log("_poll() - axios canceled request");return}if(46===e.code){this._log("_poll() - ConnectionID error, connecting without ID..."),this._setState(W.Disconnected),this.connect(!0);return}if(void 0!==e.code&&!aK(e)){this._setState(W.Closed);return}await i3(i5(this.consecutiveFailures))}},this.connect=async function(){var e,i,n,s;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t.state===W.Connecting){t._log("connect() - connecting already in progress",{reconnect:a},"warn");return}if(t.state===W.Connected){t._log("connect() - already connected and polling",{reconnect:a},"warn");return}t._setState(W.Connecting),t.connectionID=void 0;try{let{event:n}=await t._req({json:t.client._buildWSPayload()},{timeout:8e3},a);return t._setState(W.Connected),t.connectionID=n.connection_id,null===(e=(i=t.client).resolveConnectionId)||void 0===e||e.call(i),t.client.dispatchEvent(n),t._poll(),n}catch(e){throw t._setState(W.Closed),null===(n=(s=t.client).rejectConnectionId)||void 0===n||n.call(s),e}},this.isHealthy=()=>!!this.connectionID&&this.state===W.Connected,this.disconnect=async function(){var e;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;nt(t._onlineStatusChanged),t._setState(W.Disconnected),null===(e=t.cancelToken)||void 0===e||e.cancel("disconnect() is called"),t.cancelToken=void 0;let n=t.connectionID;t.connectionID=void 0;try{await t._req({close:!0,connection_id:n},{timeout:i},!1),t._log("disconnect() - Closed connectionID")}catch(e){t._log("disconnect() - Failed",{err:e},"error")}},this.client=e,this.state=W.Init,this.consecutiveFailures=0,ne(this._onlineStatusChanged)}}let aG=nc(["location"]),a$=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://hint.stream-io-video.com/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,i=new AbortController,n=setTimeout(()=>i.abort(),t);try{let t=(await fetch(e,{method:"HEAD",signal:i.signal})).headers.get("x-amz-cf-pop")||"ERR";return aG("debug","Location header: ".concat(t)),t.substring(0,3)}catch(t){return aG("warn","Failed to get location hint from ".concat(e),t),"ERR"}finally{clearTimeout(n)}};class aQ{constructor(e,t){var i,n=this;this.listeners={},this.devToken=e=>["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",ax(JSON.stringify({user_id:e})),"devtoken"].join("."),this.getAuthType=()=>this.anonymous?"anonymous":"jwt",this.setBaseURL=e=>{this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")},this.getLocationHint=async(e,t)=>{let i=await this.locationHint;return i&&"ERR"!==i?i:(this.locationHint=a$(null!=e?e:this.options.locationHintUrl,null!=t?t:this.options.locationHintTimeout),this.locationHint)},this._getConnectionID=()=>{var e,t;return(null===(e=this.wsConnection)||void 0===e?void 0:e.connectionID)||(null===(t=this.wsFallback)||void 0===t?void 0:t.connectionID)},this._hasConnectionID=()=>!!this._getConnectionID(),this.connectUser=async(e,t)=>{if(!e.id)throw Error('The "id" field on the user is missing');if(this.userID===e.id&&this.setUserPromise)return this.logger("warn","Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),this.setUserPromise;if(this.userID)throw Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");(this._isUsingServerAuth()||this.node)&&!this.options.allowServerSideConnect&&this.logger("warn",'Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),this.userID=e.id,this.anonymous=!1;let i=this._setToken(e,t,this.anonymous);this._setUser(e);let n=this.openConnection();this.setUserPromise=Promise.all([i,n]).then(e=>e[1]);try{return ne(this.updateNetworkConnectionStatus),await this.setUserPromise}catch(e){throw this.persistUserOnConnectionFailure?this.closeConnection():this.disconnectUser(),e}},this._setToken=(e,t,i)=>this.tokenManager.setTokenOrProvider(t,e,i),this._setUser=e=>{this.user=e,this.userID=e.id,this._user={...e}},this.closeConnection=async e=>{var t,i;return null!=this.cleaningIntervalRef&&(clearInterval(this.cleaningIntervalRef),this.cleaningIntervalRef=void 0),await Promise.all([null===(t=this.wsConnection)||void 0===t?void 0:t.disconnect(e),null===(i=this.wsFallback)||void 0===i?void 0:i.disconnect(e)]),Promise.resolve()},this.openConnection=async()=>{var e,t,i;if(!this.userID)throw Error("UserWithId is not set on client, use client.connectUser or client.connectAnonymousUser instead");return(null===(e=this.wsConnection)||void 0===e?void 0:e.isConnecting)&&this.wsPromise?(this.logger("info","client:openConnection() - connection already in progress"),this.wsPromise):((null===(t=this.wsConnection)||void 0===t?void 0:t.isHealthy)||(null===(i=this.wsFallback)||void 0===i?void 0:i.isHealthy()))&&this._hasConnectionID()?(this.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists"),Promise.resolve()):(this.connectionIdPromise=new Promise((e,t)=>{this.resolveConnectionId=e,this.rejectConnectionId=t}),this.clientID="".concat(this.userID,"--").concat(i8()),this.wsPromise=this.connect(),this.wsPromise)},this.disconnectUser=async e=>{this.logger("info","client:disconnect() - Disconnecting the client"),delete this.user,delete this._user,delete this.userID,this.anonymous=!1,await this.closeConnection(e),nt(this.updateNetworkConnectionStatus),this.tokenManager.reset(),this.connectionIdPromise=void 0,this.rejectConnectionId=void 0,this.resolveConnectionId=void 0},this.connectGuestUser=async e=>{this.guestUserCreatePromise=this.doAxiosRequest("post","/guest",{user:{...e}},{publicEndpoint:!0});let t=await this.guestUserCreatePromise;return this.guestUserCreatePromise.finally(()=>this.guestUserCreatePromise=void 0),this.connectUser(t.user,t.access_token)},this.connectAnonymousUser=async(e,t)=>{var i;ne(this.updateNetworkConnectionStatus),this.connectionIdPromise=new Promise((e,t)=>{this.resolveConnectionId=e,this.rejectConnectionId=t}),this.anonymous=!0,await this._setToken(e,t,this.anonymous),this._setUser(e),null===(i=this.resolveConnectionId)||void 0===i||i.call(this)},this.on=(e,t)=>{var i;return this.listeners[e]||(this.listeners[e]=[]),this.logger("debug","Adding listener for ".concat(e," event")),null===(i=this.listeners[e])||void 0===i||i.push(t),()=>{this.off(e,t)}},this.off=(e,t)=>{var i;this.listeners[e]||(this.listeners[e]=[]),this.logger("debug","Removing listener for ".concat(e," event")),this.listeners[e]=null===(i=this.listeners[e])||void 0===i?void 0:i.filter(e=>e!==t)},this._logApiRequest=(e,t,i,n)=>{this.logger("trace","client: ".concat(e," - Request - ").concat(t),{payload:i,config:n})},this._logApiResponse=(e,t,i)=>{this.logger("trace","client:".concat(e," - Response - url: ").concat(t," > status ").concat(i.status),{response:i})},this._logApiError=(e,t,i)=>{this.logger("error","client:".concat(e," - Error - url: ").concat(t),{url:t,error:i})},this.doAxiosRequest=async function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};s.publicEndpoint||await Promise.all([n.tokenManager.tokenReady(),n.guestUserCreatePromise,n.connectionIdPromise]);let a=n._enrichAxiosOptions(s);try{let s;switch(n._logApiRequest(e,t,i,a),e){case"get":s=await n.axiosInstance.get(t,a);break;case"delete":s=await n.axiosInstance.delete(t,a);break;case"post":s=await n.axiosInstance.post(t,i,a);break;case"put":s=await n.axiosInstance.put(t,i,a);break;case"patch":s=await n.axiosInstance.patch(t,i,a);break;case"options":s=await n.axiosInstance.options(t,a);break;default:throw Error("Invalid request type")}return n._logApiResponse(e,t,s),n.consecutiveFailures=0,n.handleResponse(s)}catch(o){var r;if(o.client_request_id=null===(r=a.headers)||void 0===r?void 0:r["x-client-request-id"],n.consecutiveFailures+=1,o.response){if(n._logApiError(e,t,o.response),o.response.data.code===i4.TOKEN_EXPIRED&&!n.tokenManager.isStatic())return n.consecutiveFailures>1&&await i3(i5(n.consecutiveFailures)),await n.tokenManager.loadToken(),await n.doAxiosRequest(e,t,i,s);return n.handleResponse(o.response)}throw n._logApiError(e,t,o),o}},this.get=(e,t)=>this.doAxiosRequest("get",e,null,{params:t}),this.put=(e,t,i)=>this.doAxiosRequest("put",e,t,{params:i}),this.post=(e,t,i)=>this.doAxiosRequest("post",e,t,{params:i}),this.patch=(e,t,i)=>this.doAxiosRequest("patch",e,t,{params:i}),this.delete=(e,t)=>this.doAxiosRequest("delete",e,null,{params:t}),this.errorFromResponse=e=>{let{data:t,status:i}=e,n=new eC;return n.message="Stream error code ".concat(t.code,": ").concat(t.message),n.code=t.code,n.unrecoverable=t.unrecoverable,n.response=e,n.status=i,n},this.handleResponse=e=>{let t=e.data;if(!e.status||e.status<200||300<=e.status)throw this.errorFromResponse(e);return t},this.dispatchEvent=e=>{if(this.logger("debug","Dispatching event: ".concat(e.type),e),this.listeners){for(let t of this.listeners.all||[])t(e);for(let t of this.listeners[e.type]||[])t(e)}},this.connect=async()=>{if(!this.userID||!this._user)throw Error("Call connectUser or connectAnonymousUser before starting the connection");if(!this.wsBaseURL)throw Error("Websocket base url not set");if(!this.clientID)throw Error("clientID is not set");!this.wsConnection&&(this.options.warmUp||this.options.enableInsights)&&this._sayHi(),this.options.wsConnection&&this.node?(this.options.wsConnection.setClient(this),this.wsConnection=this.options.wsConnection):this.wsConnection=new aV(this);try{if(this.wsFallback)return await this.wsFallback.connect();return this.logger("info","StreamClient.connect: this.wsConnection.connect()"),await this.wsConnection.connect(this.options.enableWSFallback?this.defaultWSTimeoutWithFallback:this.defaultWSTimeout)}catch(e){if(this.options.enableWSFallback&&function(e){if("boolean"==typeof e.isWSFailure)return e.isWSFailure;try{return JSON.parse(e.message).isWSFailure}catch(e){return!1}}(e)&&function(e){let t="undefined"!=typeof navigator?navigator:"undefined"!=typeof window&&window.navigator?window.navigator:void 0;return t?"boolean"!=typeof t.onLine||t.onLine:(e("warn","isOnline failed to access window.navigator and assume browser is online"),!0)}(this.logger))return this.logger("warn","client:connect() - WS failed, fallback to longpoll"),this.dispatchEvent({type:"transport.changed",mode:"longpoll"}),this.wsConnection._destroyCurrentWSConnection(),this.wsConnection.disconnect().then(),this.wsFallback=new aJ(this),await this.wsFallback.connect();throw e}},this._sayHi=()=>{let e=i8(),t={headers:$.uu.from({"x-client-request-id":e})};this.doAxiosRequest("get",this.baseURL+"/hi",null,t).catch(t=>{this.options.enableInsights&&aB("http_hi_failed",{api_key:this.key,err:t,client_request_id:e})})},this.getUserAgent=()=>this.userAgent||"stream-video-javascript-client-".concat(this.node?"node":"browser","-").concat("1.6.4"),this.setUserAgent=e=>{this.userAgent=e},this._isUsingServerAuth=()=>!!this.secret,this._enrichAxiosOptions=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{},headers:{},config:{}},i=t.publicEndpoint&&!n.user?void 0:n._getToken();return(null===(e=t.headers)||void 0===e?void 0:e["x-client-request-id"])||(t.headers={...t.headers,"x-client-request-id":i8()}),{params:{user_id:n.userID,connection_id:n._getConnectionID(),api_key:n.key,...t.params},headers:{...i?{Authorization:i}:void 0,"stream-auth-type":t.publicEndpoint&&!n.user?"anonymous":n.getAuthType(),"X-Stream-Client":n.getUserAgent(),...t.headers},...t.config,...n.options.axiosRequestConfig}},this._getToken=()=>this.tokenManager?this.tokenManager.getToken():null,this._buildWSPayload=e=>JSON.stringify({user_id:this.userID,user_details:this._user,client_request_id:e}),this.updateNetworkConnectionStatus=e=>{"offline"===e.type?(this.logger("debug","device went offline"),this.dispatchEvent({type:"network.changed",online:!1})):"online"===e.type&&(this.logger("debug","device went online"),this.dispatchEvent({type:"network.changed",online:!0}))},this.key=e,this.secret=null==t?void 0:t.secret;let s=t||{browser:"undefined"!=typeof window};this.browser=s.browser||"undefined"!=typeof window,this.node=!this.browser,this.browser&&(this.locationHint=a$(null==t?void 0:t.locationHintUrl,null==t?void 0:t.locationHintTimeout)),this.options={timeout:5e3,withCredentials:!1,warmUp:!1,...s},this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new null.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.setBaseURL(this.options.baseURL||"https://video.stream-io-api.com/video"),void 0!==ew&&"env"in ew&&ew.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030/video"),void 0!==ew&&"env"in ew&&ew.env.STREAM_LOCAL_TEST_HOST&&this.setBaseURL("http://".concat(ew.env.STREAM_LOCAL_TEST_HOST,"/video")),this.axiosInstance=G.default.create({...this.options,baseURL:this.baseURL}),this.wsConnection=null,this.wsPromise=null,this.setUserPromise=null,this.anonymous=!1,this.persistUserOnConnectionFailure=null===(i=this.options)||void 0===i?void 0:i.persistUserOnConnectionFailure,this.tokenManager=new az(this.secret),this.consecutiveFailures=0,this.insightMetrics=new aL,this.defaultWSTimeoutWithFallback=6e3,this.defaultWSTimeout=15e3,this.logger=i9(s.logger)?s.logger:()=>null}}class aX{static getOrCreateInstance(e){let t=e.user;if(!t.id){if("anonymous"===e.user.type)t.id="!anon";else throw Error("User ID is required for a non-anonymous user")}if(!e.token&&!e.tokenProvider&&"anonymous"!==e.user.type&&"guest"!==e.user.type)throw Error("TokenProvider or token is required for a user that is not a guest or anonymous");let i=aX._instanceMap.get(e.apiKey+t.id);return i||(i=new aX({...e,user:t})),i}get state(){return this.readOnlyStateStore}constructor(e,t){var i,n,s=this;this.logLevel="warn",this.eventHandlersToUnregister=[],this.connectUser=async(e,t)=>{var i;if("anonymous"===e.type)return e.id="!anon",this.connectAnonymousUser(e,t);let n=()=>this.streamClient.connectUser(e,t);"guest"===e.type&&(n=async()=>this.streamClient.connectGuestUser(e)),this.connectionPromise=this.disconnectionPromise?this.disconnectionPromise.then(()=>n()):n(),null===(i=this.connectionPromise)||void 0===i||i.finally(()=>this.connectionPromise=void 0);let s=await this.connectionPromise;return(null==s?void 0:s.me)&&this.writeableStateStore.setConnectedUser(s.me),this.eventHandlersToUnregister.push(this.on("connection.changed",e=>{if(e.online){let e=this.writeableStateStore.calls.filter(e=>e.watching).map(e=>e.cid);this.logger("info","Rewatching calls after connection changed ".concat(e.join(", "))),e.length>0&&this.queryCalls({watch:!0,filter_conditions:{cid:{$in:e}},sort:[{field:"cid",direction:1}]}).catch(e=>{this.logger("error","Failed to re-watch calls",e)})}})),this.eventHandlersToUnregister.push(this.on("call.created",t=>{let{call:i,members:n}=t;if(e.id===i.created_by.id){this.logger("warn","Received `call.created` sent by the current user");return}this.logger("info","New call created and registered: ".concat(i.cid));let s=new aA({streamClient:this.streamClient,type:i.type,id:i.id,members:n,clientStore:this.writeableStateStore});s.state.updateFromCallResponse(i),this.writeableStateStore.registerCall(s)})),this.eventHandlersToUnregister.push(this.on("call.ring",async t=>{let{call:i,members:n}=t;if(e.id===i.created_by.id){this.logger("debug","Received `call.ring` sent by the current user so ignoring the event");return}let s=this.writeableStateStore.findCall(i.type,i.id);await (null==s?void 0:s.leave({reason:"cleaning-up in call.ring"}));let a=new aA({streamClient:this.streamClient,type:i.type,id:i.id,members:n,clientStore:this.writeableStateStore,ringing:!0});a.state.updateFromCallResponse(i),await a.get(),this.writeableStateStore.registerCall(a)})),s},this.disconnectUser=async e=>{var t;if(!this.streamClient.user&&!this.connectionPromise)return;let i=null===(t=this.streamClient.user)||void 0===t?void 0:t.id,n=this.streamClient.key,s=()=>this.streamClient.disconnectUser(e);this.disconnectionPromise=this.connectionPromise?this.connectionPromise.then(()=>s()):s(),this.disconnectionPromise.finally(()=>this.disconnectionPromise=void 0),await this.disconnectionPromise,i&&aX._instanceMap.delete(n+i),this.eventHandlersToUnregister.forEach(e=>e()),this.eventHandlersToUnregister=[],this.writeableStateStore.setConnectedUser(void 0)},this.on=(e,t)=>this.streamClient.on(e,t),this.off=(e,t)=>this.streamClient.off(e,t),this.call=(e,t)=>new aA({streamClient:this.streamClient,id:t,type:e,clientStore:this.writeableStateStore}),this.createGuestUser=async e=>this.streamClient.doAxiosRequest("post","/guest",e,{publicEndpoint:!0}),this.queryCalls=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await s.streamClient.post("/calls",e),i=[];for(let n of t.calls){let t=new aA({streamClient:s.streamClient,id:n.call.id,type:n.call.type,members:n.members,ownCapabilities:n.own_capabilities,watching:e.watch,clientStore:s.writeableStateStore});t.state.updateFromCallResponse(n.call),await t.applyDeviceConfig(!1),e.watch&&s.writeableStateStore.registerCall(t),i.push(t)}return{...t,calls:i}},this.queryCallStats=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.streamClient.post("/call/stats",e)},this.edges=async()=>this.streamClient.get("/edges"),this.addDevice=async(e,t,i,n,s)=>await this.streamClient.post("/devices",{id:e,push_provider:t,voip_token:s,...null!=n?{user_id:n}:{},...null!=i?{push_provider_name:i}:{}}),this.addVoipDevice=async(e,t,i,n)=>await this.addDevice(e,t,i,n,!0),this.getDevices=async e=>await this.streamClient.get("/devices",e?{user_id:e}:{}),this.removeDevice=async(e,t)=>await this.streamClient.delete("/devices",{id:e,...t?{user_id:t}:{}}),this.onRingingCall=async e=>{let t=this.state.calls.find(t=>t.cid===e&&t.ringing);if(!t){let[i,n]=e.split(":");t=new aA({streamClient:this.streamClient,type:i,id:n,clientStore:this.writeableStateStore,ringing:!0}),await t.get()}return t},this.connectAnonymousUser=async(e,t)=>{let i=()=>this.streamClient.connectAnonymousUser(e,t);return this.connectionPromise=this.disconnectionPromise?this.disconnectionPromise.then(()=>i()):i(),this.connectionPromise.finally(()=>this.connectionPromise=void 0),this.connectionPromise};let a=na,r="warn";"string"==typeof e?(r=(null==t?void 0:t.logLevel)||r,a=(null==t?void 0:t.logger)||a):(r=(null===(i=e.options)||void 0===i?void 0:i.logLevel)||r,a=(null===(n=e.options)||void 0===n?void 0:n.logger)||a),nr(a,r),this.logger=nc(["client"]);let o=nc(["coordinator"]);if("string"==typeof e)this.streamClient=new aQ(e,{persistUserOnConnectionFailure:!0,...t,logLevel:r,logger:o});else{this.streamClient=new aQ(e.apiKey,{persistUserOnConnectionFailure:!0,...e.options,logLevel:r,logger:o});let t=ny();if(t){let e=N[t.type].toLowerCase(),i="".concat(t.major,".").concat(t.minor,".").concat(t.patch),n=this.streamClient.getUserAgent();this.streamClient.setUserAgent("".concat(n,"-video-").concat(e,"-sdk-").concat(i))}}if(this.writeableStateStore=new nQ,this.readOnlyStateStore=new nX(this.writeableStateStore),"string"!=typeof e){let t=e.user,i=e.token||e.tokenProvider;if(t){let n=t.id;"anonymous"===t.type&&(n="!anon"),n&&(aX._instanceMap.has(e.apiKey+n)&&this.logger("warn","A StreamVideoClient already exists for ".concat("anonymous"===t.type?"an anonymous user":n,"; Prefer using getOrCreateInstance method")),t.id=n,aX._instanceMap.set(e.apiKey+n,this)),this.connectUser(t,i).catch(e=>{this.logger("error","Failed to connect",e)})}}}}aX._instanceMap=new Map}}]);